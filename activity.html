<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>League Activity - Mountainside Aces</title>
<meta name="theme-color" content="#2d5016">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<link rel="stylesheet" href="mobile-enhancements.css">
<link rel="stylesheet" href="nav-styles.css">

<style>
  :root {
    --primary-color: #2d5016;
    --secondary-color: #1a6b4a;
    --accent-color: #ffd700;
    --card-bg: #ffffff;
    --text-dark: #2d3748;
    --text-light: #718096;
    --border-color: #e2e8f0;
    --shadow-sm: 0 2px 8px rgba(0,0,0,0.08);
    --shadow-md: 0 4px 16px rgba(0,0,0,0.12);
    --shadow-lg: 0 12px 32px rgba(0,0,0,0.16);
  }

  body {
    font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
    margin: 0;
    padding: 0;
    background: linear-gradient(135deg, #f7fafc 0%, #edf2f7 100%);
    min-height: 100vh;
    line-height: 1.6;
    color: var(--text-dark);
  }
  
  .page-container {
    max-width: 800px;
    margin: 0 auto;
    padding: 2rem;
  }
  
  /* Loading Spinner */
  .loading-overlay {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(255,255,255,0.95);
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 9999;
    transition: opacity 0.5s ease;
  }

  .loading-overlay.hidden {
    opacity: 0;
    pointer-events: none;
  }

  .softball-spinner::before {
    content: '‚öæ';
    font-size: 80px;
    animation: spin 1.5s ease-in-out infinite;
  }

  @keyframes spin {
    0%, 100% { transform: rotate(0deg) scale(1); }
    50% { transform: rotate(180deg) scale(1.1); }
  }
  
  /* Page Header */
  .page-header {
    background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
    color: white;
    text-align: center;
    padding: 3rem 2rem;
    border-radius: 16px;
    margin-bottom: 2rem;
    box-shadow: var(--shadow-lg);
    position: relative;
    overflow: hidden;
  }

  .page-header::before {
    content: "";
    position: absolute;
    top: -50%;
    right: -10%;
    width: 400px;
    height: 400px;
    background: radial-gradient(circle, rgba(255,255,255,0.15) 0%, transparent 70%);
    border-radius: 50%;
  }

  .page-header::after {
    content: 'üì∞';
    position: absolute;
    bottom: -30px;
    left: -30px;
    font-size: 150px;
    opacity: 0.08;
    transform: rotate(-15deg);
  }
  
  .page-header h1 {
    margin: 0;
    font-size: 2.5rem;
    font-weight: 800;
    text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
    position: relative;
    z-index: 1;
  }
  
  .page-header p {
    margin: 0.75rem 0 0 0;
    font-size: 1.1rem;
    opacity: 0.95;
    font-weight: 500;
    position: relative;
    z-index: 1;
  }

  /* Filters */
  .filters-bar {
    background: var(--card-bg);
    padding: 1rem 1.5rem;
    border-radius: 12px;
    margin-bottom: 1.5rem;
    box-shadow: var(--shadow-sm);
    border: 1px solid var(--border-color);
    display: flex;
    flex-wrap: wrap;
    gap: 1rem;
    align-items: center;
  }

  .filter-group {
    display: flex;
    align-items: center;
    gap: 0.5rem;
  }

  .filter-group label {
    font-weight: 600;
    font-size: 0.9rem;
    color: var(--text-light);
  }

  .filter-select {
    padding: 0.5rem 1rem;
    border: 2px solid var(--border-color);
    border-radius: 8px;
    font-size: 0.95rem;
    font-weight: 500;
    background: white;
    color: var(--text-dark);
    cursor: pointer;
    transition: all 0.2s ease;
  }

  .filter-select:focus {
    outline: none;
    border-color: var(--primary-color);
  }

  /* Date Group */
  .date-group {
    margin-bottom: 1.5rem;
  }

  .date-label {
    font-size: 0.85rem;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    color: var(--text-light);
    margin-bottom: 0.75rem;
    padding-left: 0.5rem;
  }

  /* Activity Item */
  .activity-item {
    background: var(--card-bg);
    border-radius: 12px;
    padding: 1.25rem;
    margin-bottom: 0.75rem;
    box-shadow: var(--shadow-sm);
    border: 1px solid var(--border-color);
    display: flex;
    align-items: flex-start;
    gap: 1rem;
    transition: all 0.3s ease;
    position: relative;
  }

  .activity-item:hover {
    transform: translateX(4px);
    box-shadow: var(--shadow-md);
    border-color: var(--primary-color);
  }

  .activity-icon {
    font-size: 2rem;
    flex-shrink: 0;
    width: 50px;
    height: 50px;
    display: flex;
    align-items: center;
    justify-content: center;
    background: linear-gradient(135deg, #f7fafc 0%, #edf2f7 100%);
    border-radius: 12px;
  }

  .activity-content {
    flex: 1;
    min-width: 0;
  }

  .activity-title {
    font-weight: 700;
    font-size: 1rem;
    color: var(--text-dark);
    margin-bottom: 0.25rem;
  }

  .activity-title a {
    color: var(--primary-color);
    text-decoration: none;
  }

  .activity-title a:hover {
    text-decoration: underline;
  }

  .activity-description {
    font-size: 0.9rem;
    color: var(--text-light);
    margin-bottom: 0.5rem;
  }

  .activity-meta {
    display: flex;
    align-items: center;
    gap: 1rem;
    font-size: 0.8rem;
    color: var(--text-light);
  }

  .activity-type {
    background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
    color: white;
    padding: 0.2rem 0.6rem;
    border-radius: 4px;
    font-weight: 600;
    font-size: 0.7rem;
    text-transform: uppercase;
    letter-spacing: 0.3px;
  }

  .activity-type.milestone { background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%); }
  .activity-type.badge { background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%); }
  .activity-type.game { background: linear-gradient(135deg, #10b981 0%, #059669 100%); }
  .activity-type.career_high { background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%); }
  .activity-type.photo { background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%); }
  .activity-type.standings { background: linear-gradient(135deg, #ec4899 0%, #db2777 100%); }
  .activity-type.streak { background: linear-gradient(135deg, #f97316 0%, #ea580c 100%); }

  /* Share Button */
  .share-btn {
    position: absolute;
    top: 1rem;
    right: 1rem;
    background: white;
    border: 2px solid var(--border-color);
    border-radius: 8px;
    padding: 0.5rem 0.75rem;
    font-size: 0.85rem;
    font-weight: 600;
    color: var(--text-light);
    cursor: pointer;
    transition: all 0.2s ease;
    display: flex;
    align-items: center;
    gap: 0.4rem;
  }

  .share-btn:hover {
    border-color: var(--primary-color);
    color: var(--primary-color);
    background: #f7fafc;
  }

  /* Share Modal */
  .share-modal-overlay {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(0,0,0,0.5);
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 10000;
    opacity: 0;
    visibility: hidden;
    transition: all 0.3s ease;
  }

  .share-modal-overlay.active {
    opacity: 1;
    visibility: visible;
  }

  .share-modal {
    background: white;
    border-radius: 16px;
    padding: 2rem;
    max-width: 400px;
    width: 90%;
    box-shadow: var(--shadow-lg);
    transform: translateY(20px);
    transition: transform 0.3s ease;
  }

  .share-modal-overlay.active .share-modal {
    transform: translateY(0);
  }

  .share-modal h3 {
    margin: 0 0 1.5rem 0;
    font-size: 1.25rem;
    font-weight: 700;
    text-align: center;
  }

  .share-preview {
    background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
    color: white;
    padding: 1.5rem;
    border-radius: 12px;
    text-align: center;
    margin-bottom: 1.5rem;
  }

  .share-preview-type {
    font-size: 0.75rem;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 1px;
    opacity: 0.9;
    margin-bottom: 0.5rem;
  }

  .share-preview-headline {
    font-size: 1.1rem;
    font-weight: 700;
    margin-bottom: 0.25rem;
  }

  .share-preview-subheadline {
    font-size: 1.5rem;
    font-weight: 800;
  }

  .share-preview-footer {
    font-size: 0.7rem;
    opacity: 0.8;
    margin-top: 1rem;
  }

  .share-options {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 0.75rem;
  }

  .share-option {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    padding: 0.875rem 1rem;
    border: 2px solid var(--border-color);
    border-radius: 10px;
    background: white;
    cursor: pointer;
    transition: all 0.2s ease;
    font-weight: 600;
    font-size: 0.9rem;
    color: var(--text-dark);
  }

  .share-option:hover {
    border-color: var(--primary-color);
    background: #f7fafc;
  }

  .share-option span:first-child {
    font-size: 1.25rem;
  }

  .share-close {
    display: block;
    width: 100%;
    margin-top: 1rem;
    padding: 0.75rem;
    border: none;
    background: var(--border-color);
    border-radius: 8px;
    font-weight: 600;
    cursor: pointer;
    transition: background 0.2s ease;
  }

  .share-close:hover {
    background: #cbd5e0;
  }

  /* Empty State */
  .empty-state {
    text-align: center;
    padding: 4rem 2rem;
    background: var(--card-bg);
    border-radius: 16px;
    box-shadow: var(--shadow-sm);
    border: 1px solid var(--border-color);
  }

  .empty-state-icon {
    font-size: 4rem;
    margin-bottom: 1rem;
  }

  .empty-state h3 {
    margin: 0 0 0.5rem 0;
    font-size: 1.25rem;
    color: var(--text-dark);
  }

  .empty-state p {
    margin: 0;
    color: var(--text-light);
  }

  /* Toast Notification */
  .toast {
    position: fixed;
    bottom: 2rem;
    left: 50%;
    transform: translateX(-50%) translateY(100px);
    background: var(--text-dark);
    color: white;
    padding: 1rem 1.5rem;
    border-radius: 8px;
    font-weight: 600;
    box-shadow: var(--shadow-lg);
    z-index: 10001;
    opacity: 0;
    transition: all 0.3s ease;
  }

  .toast.show {
    transform: translateX(-50%) translateY(0);
    opacity: 1;
  }

  /* Loading state for activity container */
  .activity-container.loading {
    text-align: center;
    padding: 3rem;
    color: var(--text-light);
  }

  /* Responsive */
  @media (max-width: 600px) {
    .page-container {
      padding: 1rem;
    }

    .page-header {
      padding: 2rem 1.5rem;
    }

    .page-header h1 {
      font-size: 2rem;
    }

    .filters-bar {
      flex-direction: column;
      align-items: stretch;
    }

    .filter-group {
      justify-content: space-between;
    }

    .filter-select {
      flex: 1;
    }

    .activity-item {
      flex-direction: column;
      padding-right: 1rem;
    }

    .activity-icon {
      width: 40px;
      height: 40px;
      font-size: 1.5rem;
    }

    .share-btn {
      position: relative;
      top: 0;
      right: 0;
      width: 100%;
      justify-content: center;
      margin-top: 0.75rem;
    }

    .share-options {
      grid-template-columns: 1fr;
    }
  }
</style>
</head>
<body>

<div id="loadingOverlay" class="loading-overlay">
  <div class="softball-spinner"></div>
</div>

<div class="page-container">
  <header class="page-header">
    <h1>üì∞ League Activity</h1>
    <p>Milestones, badges, games, and more</p>
  </header>

  <div class="filters-bar">
    <div class="filter-group">
      <label for="typeFilter">Type:</label>
      <select id="typeFilter" class="filter-select">
        <option value="all">All Activity</option>
        <option value="milestone">üéØ Milestones</option>
        <option value="badge">üèÖ Badges</option>
        <option value="game">‚öæ Games</option>
        <option value="career_high">üìà Career Highs</option>
        <option value="streak">üî• Streaks</option>
        <option value="standings">üìä Standings</option>
        <option value="photo">üì∏ Photos</option>
      </select>
    </div>
    <div class="filter-group">
      <label for="timeFilter">Time:</label>
      <select id="timeFilter" class="filter-select">
        <option value="week">This Week</option>
        <option value="month">This Month</option>
        <option value="season">This Season</option>
        <option value="all">All Time</option>
      </select>
    </div>
  </div>

  <div id="activityContainer" class="activity-container loading">
    Loading activity...
  </div>
</div>

<!-- Share Modal -->
<div id="shareModal" class="share-modal-overlay">
  <div class="share-modal">
    <h3>Share this moment</h3>
    <div id="sharePreview" class="share-preview">
      <div class="share-preview-type">MILESTONE</div>
      <div class="share-preview-headline">John Smith</div>
      <div class="share-preview-subheadline">100 CAREER HITS</div>
      <div class="share-preview-footer">‚öæ Mountainside Aces</div>
    </div>
    <div class="share-options">
      <button class="share-option" data-action="copy">
        <span>üìã</span> Copy Link
      </button>
      <button class="share-option" data-action="text">
        <span>üí¨</span> Text
      </button>
      <button class="share-option" data-action="whatsapp">
        <span>üì≤</span> WhatsApp
      </button>
      <button class="share-option" data-action="twitter">
        <span>üê¶</span> Twitter/X
      </button>
      <button class="share-option" data-action="facebook">
        <span>üìò</span> Facebook
      </button>
      <button class="share-option" data-action="download">
        <span>üì•</span> Save Image
      </button>
    </div>
    <button class="share-close" id="shareClose">Close</button>
  </div>
</div>

<!-- Toast -->
<div id="toast" class="toast"></div>

<!-- Hidden canvas for image generation -->
<canvas id="shareCanvas" width="600" height="400" style="display: none;"></canvas>

<script type="module">
import { db } from './firebase-config.js';
import { collection, query, where, orderBy, limit, getDocs, Timestamp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';

// Hide loading overlay
window.addEventListener('load', function() {
  setTimeout(function() {
    document.getElementById('loadingOverlay').classList.add('hidden');
  }, 800);
});

// State
let allActivities = [];
let currentActivity = null;

// DOM Elements
const activityContainer = document.getElementById('activityContainer');
const typeFilter = document.getElementById('typeFilter');
const timeFilter = document.getElementById('timeFilter');
const shareModal = document.getElementById('shareModal');
const sharePreview = document.getElementById('sharePreview');
const shareClose = document.getElementById('shareClose');
const toast = document.getElementById('toast');
const shareCanvas = document.getElementById('shareCanvas');

// Initialize
async function init() {
  await loadActivities();
  setupEventListeners();
}

// Load activities from Firestore
async function loadActivities() {
  try {
    const activitiesRef = collection(db, 'activity');
    const timeRange = getTimeRange(timeFilter.value);
    
    let q = query(
      activitiesRef,
      where('timestamp', '>=', timeRange.start),
      orderBy('timestamp', 'desc'),
      limit(100)
    );

    const snapshot = await getDocs(q);
    
    if (snapshot.empty) {
      // Use demo data if no activities exist yet
      allActivities = getDemoActivities();
    } else {
      allActivities = snapshot.docs.map(doc => ({
        id: doc.id,
        ...doc.data(),
        timestamp: doc.data().timestamp?.toDate() || new Date()
      }));
    }
    
    renderActivities();
  } catch (error) {
    console.error('Error loading activities:', error);
    // Fall back to demo data
    allActivities = getDemoActivities();
    renderActivities();
  }
}

// Get time range based on filter
function getTimeRange(filter) {
  const now = new Date();
  let start;
  
  switch (filter) {
    case 'week':
      start = new Date(now);
      start.setDate(start.getDate() - 7);
      break;
    case 'month':
      start = new Date(now);
      start.setMonth(start.getMonth() - 1);
      break;
    case 'season':
      start = new Date(now);
      start.setMonth(start.getMonth() - 4);
      break;
    case 'all':
    default:
      start = new Date('2020-01-01');
  }
  
  return { start: Timestamp.fromDate(start), end: Timestamp.fromDate(now) };
}

// Demo activities for testing
function getDemoActivities() {
  const now = new Date();
  const yesterday = new Date(now);
  yesterday.setDate(yesterday.getDate() - 1);
  const twoDaysAgo = new Date(now);
  twoDaysAgo.setDate(twoDaysAgo.getDate() - 2);
  const lastWeek = new Date(now);
  lastWeek.setDate(lastWeek.getDate() - 5);

  return [
    {
      id: '1',
      type: 'milestone',
      timestamp: new Date(now.setHours(now.getHours() - 2)),
      icon: 'üéØ',
      playerId: 'john-smith',
      playerName: 'John Smith',
      title: '100 Career Hits',
      description: 'John Smith reached 100 career hits!',
      linkUrl: '/player.html?id=john-smith',
      share: {
        type: 'MILESTONE',
        headline: 'John Smith',
        subheadline: '100 CAREER HITS'
      }
    },
    {
      id: '2',
      type: 'game',
      timestamp: yesterday,
      icon: '‚öæ',
      title: 'Blue 12, Red 8',
      description: 'Final score from Field 1',
      linkUrl: '/game-preview.html?gameId=123',
      data: { homeTeam: 'Blue', awayTeam: 'Red', homeScore: 12, awayScore: 8 },
      share: {
        type: 'FINAL SCORE',
        headline: 'Blue vs Red',
        subheadline: '12 - 8'
      }
    },
    {
      id: '3',
      type: 'badge',
      timestamp: yesterday,
      icon: 'üèÖ',
      playerId: 'sarah-johnson',
      playerName: 'Sarah Johnson',
      title: '.400 Club',
      description: 'Sarah Johnson earned the .400 Club badge!',
      linkUrl: '/player.html?id=sarah-johnson',
      share: {
        type: 'BADGE EARNED',
        headline: 'Sarah Johnson',
        subheadline: '.400 CLUB üèÖ'
      }
    },
    {
      id: '4',
      type: 'career_high',
      timestamp: twoDaysAgo,
      icon: 'üìà',
      playerId: 'mike-wilson',
      playerName: 'Mike Wilson',
      title: 'New Career High: 4 Hits',
      description: 'Mike Wilson set a new single-game career high with 4 hits!',
      linkUrl: '/player.html?id=mike-wilson',
      share: {
        type: 'CAREER HIGH',
        headline: 'Mike Wilson',
        subheadline: '4 HITS IN A GAME'
      }
    },
    {
      id: '5',
      type: 'streak',
      timestamp: twoDaysAgo,
      icon: 'üî•',
      playerId: 'tom-davis',
      playerName: 'Tom Davis',
      title: '5-Game Hit Streak',
      description: 'Tom Davis has hit safely in 5 straight games!',
      linkUrl: '/player.html?id=tom-davis',
      share: {
        type: 'HOT STREAK',
        headline: 'Tom Davis',
        subheadline: '5-GAME HIT STREAK üî•'
      }
    },
    {
      id: '6',
      type: 'standings',
      timestamp: lastWeek,
      icon: 'üìä',
      teamId: 'green',
      teamName: 'Green',
      title: 'Green moves to 1st place',
      description: 'Green takes over first place in the standings!',
      linkUrl: '/current-season.html',
      share: {
        type: 'STANDINGS',
        headline: 'Team Green',
        subheadline: 'NOW IN 1ST PLACE üèÜ'
      }
    },
    {
      id: '7',
      type: 'photo',
      timestamp: lastWeek,
      icon: 'üì∏',
      teamId: 'white',
      teamName: 'White',
      title: 'New team photos',
      description: '5 new photos added to Team White gallery',
      linkUrl: '/pictures.html?team=white',
      share: {
        type: 'NEW PHOTOS',
        headline: 'Team White',
        subheadline: 'GAME DAY GALLERY üì∏'
      }
    }
  ];
}

// Render activities
function renderActivities() {
  const typeValue = typeFilter.value;
  
  // Filter by type
  let filtered = allActivities;
  if (typeValue !== 'all') {
    filtered = allActivities.filter(a => a.type === typeValue);
  }
  
  if (filtered.length === 0) {
    activityContainer.innerHTML = `
      <div class="empty-state">
        <div class="empty-state-icon">üì≠</div>
        <h3>No activity found</h3>
        <p>Try changing your filters or check back later.</p>
      </div>
    `;
    activityContainer.classList.remove('loading');
    return;
  }
  
  // Group by date
  const groups = groupByDate(filtered);
  
  let html = '';
  for (const [label, items] of Object.entries(groups)) {
    if (items.length === 0) continue;
    
    html += `
      <div class="date-group">
        <div class="date-label">${label}</div>
        ${items.map(item => renderActivityItem(item)).join('')}
      </div>
    `;
  }
  
  activityContainer.innerHTML = html;
  activityContainer.classList.remove('loading');
  
  // Add click handlers to share buttons
  document.querySelectorAll('.share-btn').forEach(btn => {
    btn.addEventListener('click', (e) => {
      const id = e.currentTarget.dataset.id;
      openShareModal(id);
    });
  });
}

// Group activities by date
function groupByDate(activities) {
  const now = new Date();
  const today = new Date(now.getFullYear(), now.getMonth(), now.getDate());
  const yesterday = new Date(today);
  yesterday.setDate(yesterday.getDate() - 1);
  const weekAgo = new Date(today);
  weekAgo.setDate(weekAgo.getDate() - 7);
  
  const groups = {
    'Today': [],
    'Yesterday': [],
    'This Week': [],
    'Earlier': []
  };
  
  activities.forEach(item => {
    const itemDate = new Date(item.timestamp);
    const itemDay = new Date(itemDate.getFullYear(), itemDate.getMonth(), itemDate.getDate());
    
    if (itemDay.getTime() === today.getTime()) {
      groups['Today'].push(item);
    } else if (itemDay.getTime() === yesterday.getTime()) {
      groups['Yesterday'].push(item);
    } else if (itemDay > weekAgo) {
      groups['This Week'].push(item);
    } else {
      groups['Earlier'].push(item);
    }
  });
  
  return groups;
}

// Render single activity item
function renderActivityItem(item) {
  const timeAgo = formatTimeAgo(item.timestamp);
  
  return `
    <div class="activity-item" data-id="${item.id}">
      <div class="activity-icon">${item.icon}</div>
      <div class="activity-content">
        <div class="activity-title">
          ${item.linkUrl ? `<a href="${item.linkUrl}">${item.title}</a>` : item.title}
        </div>
        <div class="activity-description">${item.description}</div>
        <div class="activity-meta">
          <span class="activity-type ${item.type}">${formatType(item.type)}</span>
          <span>${timeAgo}</span>
        </div>
      </div>
      <button class="share-btn" data-id="${item.id}">
        <span>üì§</span> Share
      </button>
    </div>
  `;
}

// Format activity type for display
function formatType(type) {
  const types = {
    milestone: 'Milestone',
    badge: 'Badge',
    game: 'Game',
    career_high: 'Career High',
    streak: 'Streak',
    standings: 'Standings',
    photo: 'Photo'
  };
  return types[type] || type;
}

// Format time ago
function formatTimeAgo(date) {
  const now = new Date();
  const diff = now - new Date(date);
  const minutes = Math.floor(diff / 60000);
  const hours = Math.floor(diff / 3600000);
  const days = Math.floor(diff / 86400000);
  
  if (minutes < 60) return `${minutes}m ago`;
  if (hours < 24) return `${hours}h ago`;
  if (days === 1) return 'Yesterday';
  if (days < 7) return `${days}d ago`;
  
  return new Date(date).toLocaleDateString('en-US', { month: 'short', day: 'numeric' });
}

// Open share modal
function openShareModal(id) {
  currentActivity = allActivities.find(a => a.id === id);
  if (!currentActivity) return;
  
  const share = currentActivity.share || {};
  
  sharePreview.innerHTML = `
    <div class="share-preview-type">${share.type || formatType(currentActivity.type).toUpperCase()}</div>
    <div class="share-preview-headline">${share.headline || currentActivity.playerName || currentActivity.teamName || ''}</div>
    <div class="share-preview-subheadline">${share.subheadline || currentActivity.title}</div>
    <div class="share-preview-footer">‚öæ Mountainside Aces</div>
  `;
  
  shareModal.classList.add('active');
}

// Close share modal
function closeShareModal() {
  shareModal.classList.remove('active');
  currentActivity = null;
}

// Show toast notification
function showToast(message) {
  toast.textContent = message;
  toast.classList.add('show');
  setTimeout(() => toast.classList.remove('show'), 3000);
}

// Generate share image
function generateShareImage() {
  return new Promise((resolve) => {
    const ctx = shareCanvas.getContext('2d');
    const share = currentActivity.share || {};
    
    // Background gradient
    const gradient = ctx.createLinearGradient(0, 0, 600, 400);
    gradient.addColorStop(0, '#2d5016');
    gradient.addColorStop(1, '#1a6b4a');
    ctx.fillStyle = gradient;
    ctx.fillRect(0, 0, 600, 400);
    
    // Header
    ctx.fillStyle = 'rgba(255,255,255,0.9)';
    ctx.font = 'bold 14px Inter, sans-serif';
    ctx.textAlign = 'center';
    ctx.fillText('‚öæ MOUNTAINSIDE ACES', 300, 50);
    
    // Type badge
    ctx.fillStyle = 'rgba(255,255,255,0.2)';
    ctx.fillRect(200, 80, 200, 30);
    ctx.fillStyle = 'white';
    ctx.font = 'bold 12px Inter, sans-serif';
    ctx.fillText(share.type || formatType(currentActivity.type).toUpperCase(), 300, 100);
    
    // Headline
    ctx.fillStyle = 'white';
    ctx.font = 'bold 28px Inter, sans-serif';
    ctx.fillText(share.headline || currentActivity.playerName || currentActivity.teamName || '', 300, 180);
    
    // Subheadline
    ctx.font = 'bold 42px Inter, sans-serif';
    ctx.fillText(share.subheadline || currentActivity.title, 300, 240);
    
    // Date
    ctx.fillStyle = 'rgba(255,255,255,0.7)';
    ctx.font = '14px Inter, sans-serif';
    const dateStr = new Date(currentActivity.timestamp).toLocaleDateString('en-US', { 
      month: 'long', day: 'numeric', year: 'numeric' 
    });
    ctx.fillText(dateStr, 300, 320);
    
    // Footer
    ctx.fillStyle = 'rgba(255,255,255,0.5)';
    ctx.font = '12px Inter, sans-serif';
    ctx.fillText('acessoftballreference.com', 300, 370);
    
    shareCanvas.toBlob(resolve, 'image/png');
  });
}

// Handle share actions
async function handleShare(action) {
  if (!currentActivity) return;
  
  const share = currentActivity.share || {};
  const shareText = `${share.headline || ''} - ${share.subheadline || currentActivity.title} ‚öæ Mountainside Aces`;
  const shareUrl = `https://acessoftballreference.com${currentActivity.linkUrl || '/activity.html'}`;
  
  switch (action) {
    case 'copy':
      try {
        await navigator.clipboard.writeText(shareUrl);
        showToast('Link copied to clipboard!');
      } catch (err) {
        showToast('Failed to copy link');
      }
      break;
      
    case 'text':
      window.open(`sms:?body=${encodeURIComponent(shareText + ' ' + shareUrl)}`);
      break;
      
    case 'whatsapp':
      window.open(`https://wa.me/?text=${encodeURIComponent(shareText + ' ' + shareUrl)}`);
      break;
      
    case 'twitter':
      window.open(`https://twitter.com/intent/tweet?text=${encodeURIComponent(shareText)}&url=${encodeURIComponent(shareUrl)}`);
      break;
      
    case 'facebook':
      window.open(`https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(shareUrl)}`);
      break;
      
    case 'download':
      const blob = await generateShareImage();
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = `aces-${currentActivity.type}-${Date.now()}.png`;
      a.click();
      URL.revokeObjectURL(url);
      showToast('Image downloaded!');
      break;
  }
  
  closeShareModal();
}

// Setup event listeners
function setupEventListeners() {
  typeFilter.addEventListener('change', renderActivities);
  timeFilter.addEventListener('change', loadActivities);
  
  shareClose.addEventListener('click', closeShareModal);
  shareModal.addEventListener('click', (e) => {
    if (e.target === shareModal) closeShareModal();
  });
  
  document.querySelectorAll('.share-option').forEach(btn => {
    btn.addEventListener('click', () => handleShare(btn.dataset.action));
  });
  
  // Escape key closes modal
  document.addEventListener('keydown', (e) => {
    if (e.key === 'Escape') closeShareModal();
  });
}

// Initialize
init();
</script>

<script type="module">
  import { NavigationComponent } from './nav-component.js';
</script>
<script src="team-colors.js"></script>
<script src="mobile-enhancements.js"></script>
</body>
</html>

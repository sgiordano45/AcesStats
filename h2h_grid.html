<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Head-to-Head Grid - Aces Stats</title>
<link rel="stylesheet" href="style.css">
<style>
  .back-nav {
    margin-bottom: 20px;
  }
  
  .back-nav a {
    padding: 8px 15px;
    background-color: #f0f0f0;
    border: 1px solid #ccc;
    text-decoration: none;
    border-radius: 3px;
    margin-right: 10px;
    color: #333;
  }
  
  .back-nav a:hover {
    background-color: #e0e0e0;
  }
  
  .pitching-link {
    background-color: #e6ffe6 !important;
    border-color: #00aa00 !important;
    color: #006600 !important;
  }
  
  .pitching-link:hover {
    background-color: #d4ffd4 !important;
  }
  
  .h2h-container {
    overflow-x: auto;
    margin: 20px 0;
    border-radius: 8px;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
  }
  
  .h2h-grid {
    border-collapse: collapse;
    width: 100%;
    min-width: 600px;
    background-color: white;
  }
  
  .h2h-grid th,
  .h2h-grid td {
    border: 1px solid #ddd;
    padding: 8px;
    text-align: center;
    vertical-align: middle;
    font-size: 0.9em;
  }
  
  .h2h-grid th {
    background-color: #333;
    color: white;
    font-weight: bold;
    position: sticky;
    top: 0;
    z-index: 10;
  }
  
  .h2h-grid .row-header {
    background-color: #333;
    color: white;
    font-weight: bold;
    position: sticky;
    left: 0;
    z-index: 5;
    min-width: 140px;
    font-size: 0.85em;
  }
  
  .h2h-grid .corner-cell {
    background-color: #333;
    position: sticky;
    left: 0;
    top: 0;
    z-index: 15;
  }
  
  .team-header {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 4px;
    white-space: nowrap;
  }
  
  .team-header img {
    width: 24px;
    height: 24px;
    object-fit: contain;
  }
  
  .team-row-header {
    display: flex;
    align-items: center;
    gap: 6px;
    justify-content: flex-start;
    padding-left: 8px;
    font-size: 0.85em;
  }
  
  .team-row-header img {
    width: 20px;
    height: 20px;
    object-fit: contain;
    flex-shrink: 0;
  }
  
  .diagonal-cell {
    background-color: #e9ecef;
    color: #6c757d;
    font-style: italic;
  }
  
  .h2h-cell {
    cursor: pointer;
    transition: background-color 0.2s;
    min-width: 80px;
  }
  
  .h2h-cell:hover {
    background-color: #f8f9fa;
  }
  
  .h2h-record {
    font-weight: bold;
    color: #333;
  }
  
  .h2h-details {
    font-size: 0.8em;
    color: #666;
    margin-top: 2px;
  }
  
  .winning-record {
    background-color: #d4edda;
    color: #155724;
  }
  
  .losing-record {
    background-color: #f8d7da;
    color: #721c24;
  }
  
  .tied-record {
    background-color: #fff3cd;
    color: #856404;
  }
  
  .no-games {
    background-color: #f8f9fa;
    color: #6c757d;
    font-style: italic;
  }
  
  .legend {
    display: flex;
    justify-content: center;
    gap: 20px;
    margin: 20px 0;
    flex-wrap: wrap;
  }
  
  .legend-item {
    display: flex;
    align-items: center;
    gap: 8px;
    font-size: 0.9em;
  }
  
  .legend-color {
    width: 20px;
    height: 20px;
    border-radius: 3px;
    border: 1px solid #ddd;
  }
  
  .summary-stats {
    background-color: #f8f9fa;
    padding: 20px;
    border-radius: 8px;
    margin: 20px 0;
    text-align: center;
  }
  
  .summary-stats h3 {
    margin: 0 0 10px 0;
    color: #333;
  }
  
  .stats-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
    gap: 15px;
    margin-top: 15px;
  }
  
  .stat-item {
    background-color: white;
    padding: 10px;
    border-radius: 5px;
    border: 1px solid #dee2e6;
  }
  
  .stat-label {
    font-size: 0.9em;
    color: #666;
    margin-bottom: 5px;
  }
  
  .stat-value {
    font-size: 1.2em;
    font-weight: bold;
    color: #333;
  }
  
  /* Mobile responsive */
  @media (max-width: 768px) {
    .back-nav {
      text-align: center;
    }
    
    .back-nav a {
      display: inline-block;
      margin: 2px;
      padding: 10px 12px;
      font-size: 14px;
    }
    
    .h2h-grid th,
    .h2h-grid td {
      padding: 6px;
      font-size: 0.8em;
    }
    
    .team-header {
      gap: 2px;
    }
    
    .team-header img {
      width: 18px;
      height: 18px;
    }
    
    .team-row-header img {
      width: 16px;
      height: 16px;
    }
    
    .legend {
      flex-direction: column;
      align-items: center;
    }
    
    .stats-grid {
      grid-template-columns: 1fr;
    }
  }
  
  @media (max-width: 480px) {
    .back-nav a {
      display: block;
      margin: 5px 0;
      text-align: center;
    }
    
    .h2h-grid th,
    .h2h-grid td {
      padding: 4px;
      font-size: 0.75em;
    }
    
    .team-header img {
      width: 16px;
      height: 16px;
    }
    
    .team-row-header img {
      width: 14px;
      height: 14px;
    }
  }
</style>
</head>
<body>
<div class="back-nav">
  <a href="index.html">← Batting Stats</a>
  <a href="pitching.html" class="pitching-link">Pitching Stats</a>
  <a href="teams.html">All Teams</a>
  <a href="team_comparison.html">Team Comparison</a>
  <a href="players.html">All Players</a>
  <a href="seasons.html">All Seasons</a>
  <a href="awards.html">League Awards</a>
</div>

<h1>Head-to-Head Results Grid (2022+)</h1>

<div class="summary-stats" id="summaryStats">
  <h3>League Head-to-Head Summary (2022+)</h3>
  <div class="stats-grid" id="statsGrid">
    <!-- Stats will be populated dynamically -->
  </div>
</div>

<div class="legend">
  <div class="legend-item">
    <div class="legend-color winning-record"></div>
    <span>Winning Record</span>
  </div>
  <div class="legend-item">
    <div class="legend-color tied-record"></div>
    <span>Even Record</span>
  </div>
  <div class="legend-item">
    <div class="legend-color losing-record"></div>
    <span>Losing Record</span>
  </div>
  <div class="legend-item">
    <div class="legend-color no-games"></div>
    <span>No Games</span>
  </div>
  <div class="legend-item">
    <div class="legend-color diagonal-cell"></div>
    <span>Same Team</span>
  </div>
</div>

<div class="h2h-container">
  <table class="h2h-grid" id="h2hGrid">
    <!-- Grid will be populated dynamically -->
  </table>
</div>

<script>
let allBattingData = [];
let allGames = [];
let teams = [];

// Function to get team logo path
function getTeamLogoPath(teamName) {
  // Convert team name to lowercase and replace spaces with underscores for filename
  const logoFileName = teamName.toLowerCase().replace(/\s+/g, '_') + '.png';
  return `logos/${logoFileName}`;
}

// Function to create team header with logo
function createTeamHeader(teamName) {
  return `
    <div class="team-header">
      <img src="${getTeamLogoPath(teamName)}" alt="${teamName}" onerror="this.style.display='none'">
      <div>${teamName}</div>
    </div>
  `;
}

// Function to create team row header with logo
function createTeamRowHeader(teamName) {
  return `
    <div class="team-row-header">
      <img src="${getTeamLogoPath(teamName)}" alt="${teamName}" onerror="this.style.display='none'">
      <div>${teamName}</div>
    </div>
  `;
}

// Load batting data and games data
Promise.all([
  fetch("data.json").then(res => res.json()),
  fetch("games.json").then(res => res.ok ? res.json() : [])
])
  .then(([battingData, gamesData]) => {
    allBattingData = battingData.map(p => ({
      ...p,
      name: p.name ? p.name.trim() : "",
      team: p.team ? p.team.trim() : ""
    }));
    
    allGames = gamesData;
    
    // Get teams that have pages (teams with batting data, excluding "Kings")
    teams = [...new Set(allBattingData.map(p => p.team))]
      .filter(team => team && team.toLowerCase() !== "kings")
      .sort();
    
    generateH2HGrid();
    generateSummaryStats();
  })
  .catch(error => {
    console.error("Error loading data:", error);
    document.getElementById("h2hGrid").innerHTML = 
      '<tr><td>Error loading head-to-head data. Please check that data files are available.</td></tr>';
  });

function generateH2HGrid() {
  const table = document.getElementById('h2hGrid');
  
  // Create header row with teams across the top
  let headerRow = '<tr><th class="corner-cell">vs Team</th>';
  teams.forEach(team => {
    headerRow += `<th>${createTeamHeader(team)}</th>`;
  });
  headerRow += '</tr>';
  
  // Create data rows with "vs TeamName" format
  let dataRows = '';
  teams.forEach(vsTeam => {
    let row = `<tr><td class="row-header">vs ${createTeamRowHeader(vsTeam)}</td>`;
    
    teams.forEach(firstTeam => {
      if (firstTeam === vsTeam) {
        // Diagonal cell (same team)
        row += '<td class="diagonal-cell">—</td>';
      } else {
        // Calculate H2H record from firstTeam's perspective against vsTeam
        const h2h = calculateHeadToHead(firstTeam, vsTeam);
        const cellClass = getCellClass(h2h, firstTeam);
        const cellContent = formatCellContent(h2h, firstTeam, vsTeam);
        
        row += `<td class="h2h-cell ${cellClass}" onclick="showH2HDetails('${firstTeam}', '${vsTeam}')">${cellContent}</td>`;
      }
    });
    
    row += '</tr>';
    dataRows += row;
  });
  
  table.innerHTML = headerRow + dataRows;
}

function calculateHeadToHead(team1, team2) {
  // Filter games where these two teams played each other, only including 2022 and later
  const headToHeadGames = allGames.filter(game => {
    const homeTeam = game["home team"];
    const awayTeam = game["away team"];
    const gameYear = parseInt(game.year);
    
    // Only include games from 2022 onwards
    const isRecentGame = gameYear >= 2022;
    const isMatchup = (homeTeam === team1 && awayTeam === team2) ||
                     (homeTeam === team2 && awayTeam === team1);
    
    return isMatchup && isRecentGame;
  });
  
  if (headToHeadGames.length === 0) {
    return null;
  }
  
  let team1Wins = 0, team2Wins = 0, ties = 0;
  
  headToHeadGames.forEach(game => {
    const winner = game.winner;
    
    // Handle different winner formats
    let actualWinner = winner;
    if (winner && winner.includes("Forfeit")) {
      actualWinner = winner.replace("Forfeit - ", "").replace("Tie", "");
    }
    
    if (actualWinner === "Tie") {
      ties++;
    } else if (actualWinner === team1) {
      team1Wins++;
    } else if (actualWinner === team2) {
      team2Wins++;
    }
  });
  
  return {
    team1: team1,
    team2: team2,
    team1Wins: team1Wins,
    team2Wins: team2Wins,
    ties: ties,
    totalGames: team1Wins + team2Wins + ties
  };
}

function getCellClass(h2h, perspective) {
  if (!h2h) return 'no-games';
  
  const perspectiveWins = h2h.team1 === perspective ? h2h.team1Wins : h2h.team2Wins;
  const opponentWins = h2h.team1 === perspective ? h2h.team2Wins : h2h.team1Wins;
  
  if (perspectiveWins > opponentWins) {
    return 'winning-record';
  } else if (perspectiveWins < opponentWins) {
    return 'losing-record';
  } else {
    return 'tied-record';
  }
}

function formatCellContent(h2h, team1, team2) {
  if (!h2h) {
    return '<div class="h2h-record">—</div><div class="h2h-details">No games</div>';
  }
  
  // Show record from team1's perspective (row team)
  const team1Wins = h2h.team1 === team1 ? h2h.team1Wins : h2h.team2Wins;
  const team2Wins = h2h.team1 === team1 ? h2h.team2Wins : h2h.team1Wins;
  
  const record = h2h.ties > 0 ? 
    `${team1Wins}-${team2Wins}-${h2h.ties}` : 
    `${team1Wins}-${team2Wins}`;
  
  return `<div class="h2h-record">${record}</div><div class="h2h-details">${h2h.totalGames} games</div>`;
}

function showH2HDetails(team1, team2) {
  // Redirect to team comparison page with these teams pre-selected
  window.location.href = `team_comparison.html?team1=${encodeURIComponent(team1)}&team2=${encodeURIComponent(team2)}`;
}

function generateSummaryStats() {
  const statsGrid = document.getElementById('statsGrid');
  
  // Calculate summary statistics
  let totalMatchups = 0;
  let totalGames = 0;
  let competitiveMatchups = 0; // Matchups with games played
  let mostGamesMatchup = { teams: '', games: 0 };
  let biggestRivalryLead = { team: '', opponent: '', wins: 0, losses: 0 };
  
  teams.forEach(team1 => {
    teams.forEach(team2 => {
      if (team1 !== team2) {
        totalMatchups++;
        const h2h = calculateHeadToHead(team1, team2);
        
        if (h2h && h2h.totalGames > 0) {
          if (totalMatchups % 2 === 0) { // Only count each matchup once
            competitiveMatchups++;
            totalGames += h2h.totalGames;
            
            if (h2h.totalGames > mostGamesMatchup.games) {
              mostGamesMatchup = {
                teams: `${team1} vs ${team2}`,
                games: h2h.totalGames
              };
            }
          }
          
          // Check for biggest rivalry lead (difference in wins)
          const team1Wins = h2h.team1 === team1 ? h2h.team1Wins : h2h.team2Wins;
          const team2Wins = h2h.team1 === team1 ? h2h.team2Wins : h2h.team1Wins;
          const leadDifference = Math.abs(team1Wins - team2Wins);
          
          if (leadDifference > Math.abs(biggestRivalryLead.wins - biggestRivalryLead.losses)) {
            if (team1Wins > team2Wins) {
              biggestRivalryLead = {
                team: team1,
                opponent: team2,
                wins: team1Wins,
                losses: team2Wins
              };
            } else if (team2Wins > team1Wins) {
              biggestRivalryLead = {
                team: team2,
                opponent: team1,
                wins: team2Wins,
                losses: team1Wins
              };
            }
          }
        }
      }
    });
  });
  
  // Adjust for double counting
  totalMatchups = totalMatchups / 2;
  competitiveMatchups = competitiveMatchups / 2;
  
  const statsHTML = `
    <div class="stat-item">
      <div class="stat-label">Total Teams</div>
      <div class="stat-value">${teams.length}</div>
    </div>
    <div class="stat-item">
      <div class="stat-label">Possible Matchups</div>
      <div class="stat-value">${totalMatchups}</div>
    </div>
    <div class="stat-item">
      <div class="stat-label">Matchups with Games</div>
      <div class="stat-value">${competitiveMatchups}</div>
    </div>
    <div class="stat-item">
      <div class="stat-label">Total H2H Games</div>
      <div class="stat-value">${totalGames}</div>
    </div>
    <div class="stat-item">
      <div class="stat-label">Most Games Played</div>
      <div class="stat-value">${mostGamesMatchup.games}</div>
      <div class="stat-label" style="font-size: 0.8em; margin-top: 2px;">${mostGamesMatchup.teams}</div>
    </div>
    <div class="stat-item">
      <div class="stat-label">Biggest Rivalry Lead</div>
      <div class="stat-value">${biggestRivalryLead.wins}-${biggestRivalryLead.losses}</div>
      <div class="stat-label" style="font-size: 0.8em; margin-top: 2px;">${biggestRivalryLead.team} over ${biggestRivalryLead.opponent}</div>
    </div>
  `;
  
  statsGrid.innerHTML = statsHTML;
}
</script>
</body>
</html>
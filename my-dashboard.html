<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>My Dashboard - Mountainside Aces</title>
<meta name="theme-color" content="#2d5016">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<link rel="stylesheet" href="mobile-enhancements.css">
<link rel="stylesheet" href="nav-styles.css">

<style>
:root {
  --primary-color: #2d5016;
  --secondary-color: #1a6b4a;
  --accent-color: #ffd700;
  --card-bg: #ffffff;
  --text-dark: #2d3748;
  --text-light: #718096;
  --border-color: #e2e8f0;
  --shadow-sm: 0 2px 8px rgba(0,0,0,0.08);
  --shadow-md: 0 4px 16px rgba(0,0,0,0.12);
  --shadow-lg: 0 12px 32px rgba(0,0,0,0.16);
  --success-color: #10b981;
  --warning-color: #f59e0b;
  --danger-color: #ef4444;
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

body {
  font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
  background: linear-gradient(135deg, #f7fafc 0%, #edf2f7 100%);
  min-height: 100vh;
  color: var(--text-dark);
}

/* Loading Overlay */
.loading-overlay {
  position: fixed;
  top: 0; left: 0; right: 0; bottom: 0;
  background: rgba(255,255,255,0.95);
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 9999;
  transition: opacity 0.3s ease;
}

.loading-overlay.hidden {
  opacity: 0;
  pointer-events: none;
}

.softball-spinner::before {
  content: '‚öæ';
  font-size: 80px;
  animation: spin 1.5s ease-in-out infinite;
}

@keyframes spin {
  0%, 100% { transform: rotate(0deg) scale(1); }
  50% { transform: rotate(180deg) scale(1.1); }
}

/* Header */
.header {
  background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
  padding: 2rem;
  box-shadow: var(--shadow-lg);
  position: relative;
  overflow: hidden;
}

.header::before {
  content: '';
  position: absolute;
  top: -50px;
  right: -50px;
  width: 250px;
  height: 250px;
  background: rgba(255,255,255,0.05);
  border-radius: 50%;
}

.header::after {
  content: '‚öæ';
  position: absolute;
  bottom: -30px;
  left: -30px;
  font-size: 150px;
  opacity: 0.05;
}

.header-content {
  max-width: 1400px;
  margin: 0 auto;
  position: relative;
  z-index: 1;
}

.greeting-section {
  display: flex;
  justify-content: space-between;
  align-items: center;
  flex-wrap: wrap;
  gap: 1.5rem;
}

.greeting {
  color: white;
}

.greeting h1 {
  font-size: 2rem;
  margin-bottom: 0.5rem;
  text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
}

.greeting p {
  font-size: 1.1rem;
  opacity: 0.9;
}

.time-display {
  font-size: 0.9rem;
  opacity: 0.8;
  margin-top: 0.25rem;
}

.header-actions {
  display: flex;
  gap: 1rem;
  flex-wrap: wrap;
}

.header-btn {
  padding: 0.75rem 1.5rem;
  border-radius: 8px;
  text-decoration: none;
  font-weight: 600;
  font-size: 0.95rem;
  display: flex;
  align-items: center;
  gap: 0.5rem;
  transition: all 0.3s ease;
  border: 2px solid rgba(255,255,255,0.3);
  cursor: pointer;
}

.header-btn.primary {
  background: white;
  color: var(--primary-color);
}

.header-btn.primary:hover {
  background: var(--accent-color);
  border-color: var(--accent-color);
  transform: translateY(-2px);
}

.header-btn.secondary {
  background: rgba(255,255,255,0.15);
  color: white;
}

.header-btn.secondary:hover {
  background: rgba(255,255,255,0.25);
  transform: translateY(-2px);
}

/* Main Content */
.dashboard-container {
  max-width: 1400px;
  margin: 0 auto;
  padding: 2rem;
}

/* Dashboard Grid */
.dashboard-grid {
  display: grid;
  grid-template-columns: 1fr 1fr 350px;
  gap: 2rem;
}

@media (max-width: 1200px) {
  .dashboard-grid {
    grid-template-columns: 1fr 1fr;
  }
  .sidebar {
    grid-column: span 2;
  }
}

@media (max-width: 768px) {
  .dashboard-grid {
    grid-template-columns: 1fr;
  }
  .sidebar {
    grid-column: span 1;
  }
}

/* Cards */
.card {
  background: var(--card-bg);
  border-radius: 16px;
  padding: 1.5rem;
  box-shadow: var(--shadow-sm);
  border: 1px solid var(--border-color);
  transition: all 0.3s ease;
}

.card:hover {
  box-shadow: var(--shadow-md);
  transform: translateY(-2px);
}

.card-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 1.25rem;
  padding-bottom: 1rem;
  border-bottom: 2px solid var(--border-color);
}

.card-title {
  font-size: 1.25rem;
  font-weight: 700;
  color: var(--text-dark);
  display: flex;
  align-items: center;
  gap: 0.5rem;
}

.card-action {
  color: var(--primary-color);
  text-decoration: none;
  font-weight: 600;
  font-size: 0.9rem;
  display: flex;
  align-items: center;
  gap: 0.25rem;
  transition: all 0.3s ease;
}

.card-action:hover {
  color: var(--secondary-color);
  transform: translateX(3px);
}

/* Next Game Card - Featured */
.next-game-card {
  grid-column: span 2;
  background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
  color: white;
  position: relative;
  overflow: hidden;
}

.next-game-card::before {
  content: '';
  position: absolute;
  top: -50px;
  right: -50px;
  width: 200px;
  height: 200px;
  background: rgba(255,255,255,0.05);
  border-radius: 50%;
}

.next-game-card .card-header {
  border-bottom-color: rgba(255,255,255,0.2);
}

.next-game-card .card-title {
  color: white;
}

.next-game-card .card-action {
  color: var(--accent-color);
}

.next-game-content {
  display: flex;
  justify-content: space-between;
  align-items: center;
  gap: 2rem;
  flex-wrap: wrap;
}

.game-matchup {
  flex: 1;
  min-width: 250px;
}

.matchup-teams {
  display: flex;
  align-items: center;
  gap: 1.5rem;
  margin-bottom: 1rem;
}

.team-info {
  text-align: center;
}

.team-name {
  font-size: 1.5rem;
  font-weight: 700;
}

.team-label {
  font-size: 0.8rem;
  opacity: 0.8;
  text-transform: uppercase;
  letter-spacing: 0.5px;
}

.vs-badge {
  font-size: 1.2rem;
  font-weight: 700;
  opacity: 0.7;
}

.game-details {
  display: flex;
  flex-wrap: wrap;
  gap: 1.5rem;
  margin-top: 1rem;
}

.game-detail {
  display: flex;
  align-items: center;
  gap: 0.5rem;
  font-size: 0.95rem;
  opacity: 0.95;
}

.game-actions {
  display: flex;
  flex-direction: column;
  gap: 0.75rem;
}

.rsvp-buttons {
  display: flex;
  gap: 0.5rem;
}

.rsvp-btn {
  padding: 0.6rem 1rem;
  border: 2px solid rgba(255,255,255,0.3);
  background: rgba(255,255,255,0.1);
  color: white;
  border-radius: 8px;
  font-weight: 600;
  font-size: 0.85rem;
  cursor: pointer;
  transition: all 0.3s ease;
  font-family: inherit;
}

.rsvp-btn:hover {
  background: rgba(255,255,255,0.2);
  transform: translateY(-2px);
}

.rsvp-btn.active {
  background: white;
  color: var(--primary-color);
  border-color: white;
}

.rsvp-btn.yes.active { background: var(--success-color); color: white; border-color: var(--success-color); }
.rsvp-btn.maybe.active { background: var(--warning-color); color: white; border-color: var(--warning-color); }
.rsvp-btn.no.active { background: var(--danger-color); color: white; border-color: var(--danger-color); }

.countdown {
  text-align: center;
  padding: 1rem;
  background: rgba(255,255,255,0.1);
  border-radius: 12px;
}

.countdown-number {
  font-size: 2.5rem;
  font-weight: 800;
  line-height: 1;
}

.countdown-label {
  font-size: 0.85rem;
  opacity: 0.8;
  margin-top: 0.25rem;
}

@media (max-width: 768px) {
  .next-game-card {
    grid-column: span 1;
  }
}

/* Quick Stats */
.quick-stats {
  display: grid;
  grid-template-columns: repeat(2, 1fr);
  gap: 1rem;
}

.stat-item {
  background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
  padding: 1rem;
  border-radius: 12px;
  text-align: center;
  border: 2px solid var(--border-color);
  transition: all 0.3s ease;
}

.stat-item:hover {
  border-color: var(--primary-color);
  transform: translateY(-2px);
}

.stat-value {
  font-size: 1.75rem;
  font-weight: 700;
  color: var(--primary-color);
}

.stat-label {
  font-size: 0.8rem;
  color: var(--text-light);
  text-transform: uppercase;
  letter-spacing: 0.5px;
  margin-top: 0.25rem;
}

/* Upcoming Games List */
.games-list {
  display: flex;
  flex-direction: column;
  gap: 1rem;
}

.game-item {
  display: flex;
  align-items: center;
  gap: 1rem;
  padding: 1rem;
  background: #f8f9fa;
  border-radius: 12px;
  border: 2px solid transparent;
  transition: all 0.3s ease;
  text-decoration: none;
  color: inherit;
}

.game-item:hover {
  border-color: var(--primary-color);
  background: white;
  transform: translateX(5px);
}

.game-date-box {
  background: var(--primary-color);
  color: white;
  padding: 0.75rem;
  border-radius: 10px;
  text-align: center;
  min-width: 60px;
}

.game-date-day {
  font-size: 1.25rem;
  font-weight: 700;
  line-height: 1;
}

.game-date-month {
  font-size: 0.7rem;
  text-transform: uppercase;
  opacity: 0.9;
  margin-top: 0.25rem;
}

.game-info {
  flex: 1;
}

.game-opponent {
  font-weight: 600;
  color: var(--text-dark);
  margin-bottom: 0.25rem;
}

.game-meta {
  font-size: 0.85rem;
  color: var(--text-light);
  display: flex;
  gap: 1rem;
}

.game-rsvp-status {
  padding: 4px 10px;
  border-radius: 12px;
  font-size: 0.75rem;
  font-weight: 600;
  text-transform: uppercase;
}

.game-rsvp-status.yes { background: #d1fae5; color: #065f46; }
.game-rsvp-status.maybe { background: #fef3c7; color: #92400e; }
.game-rsvp-status.no { background: #fee2e2; color: #991b1b; }
.game-rsvp-status.pending { background: #e2e8f0; color: #475569; }

/* Action Items */
.action-items {
  display: flex;
  flex-direction: column;
  gap: 0.75rem;
}

.action-item {
  display: flex;
  align-items: center;
  gap: 1rem;
  padding: 1rem;
  background: #fffbeb;
  border: 2px solid #fcd34d;
  border-radius: 12px;
  text-decoration: none;
  color: inherit;
  transition: all 0.3s ease;
}

.action-item:hover {
  background: #fef3c7;
  transform: translateX(5px);
}

.action-item.urgent {
  background: #fef2f2;
  border-color: #fca5a5;
}

.action-item.urgent:hover {
  background: #fee2e2;
}

.action-icon {
  font-size: 1.5rem;
}

.action-content {
  flex: 1;
}

.action-title {
  font-weight: 600;
  color: var(--text-dark);
}

.action-description {
  font-size: 0.85rem;
  color: var(--text-light);
}

.action-arrow {
  color: var(--text-light);
  font-size: 1.25rem;
}

/* Empty State */
.empty-state {
  text-align: center;
  padding: 2rem;
  color: var(--text-light);
}

.empty-state-icon {
  font-size: 3rem;
  margin-bottom: 1rem;
  opacity: 0.5;
}

.empty-state h3 {
  color: var(--text-dark);
  margin-bottom: 0.5rem;
}

/* Quick Links */
.quick-links-grid {
  display: grid;
  grid-template-columns: repeat(2, 1fr);
  gap: 0.75rem;
}

.quick-link {
  display: flex;
  align-items: center;
  gap: 0.75rem;
  padding: 1rem;
  background: #f8f9fa;
  border-radius: 10px;
  text-decoration: none;
  color: var(--text-dark);
  font-weight: 600;
  font-size: 0.9rem;
  transition: all 0.3s ease;
  border: 2px solid transparent;
}

.quick-link:hover {
  background: white;
  border-color: var(--primary-color);
  color: var(--primary-color);
  transform: translateY(-2px);
}

.quick-link-icon {
  font-size: 1.25rem;
}

/* Favorites Section */
.favorites-row {
  display: flex;
  gap: 0.75rem;
  overflow-x: auto;
  padding-bottom: 0.5rem;
  scrollbar-width: thin;
}

.favorite-chip {
  display: flex;
  align-items: center;
  gap: 0.5rem;
  padding: 0.5rem 1rem;
  background: #f8f9fa;
  border-radius: 20px;
  text-decoration: none;
  color: var(--text-dark);
  font-size: 0.9rem;
  font-weight: 500;
  white-space: nowrap;
  transition: all 0.3s ease;
  border: 2px solid transparent;
}

.favorite-chip:hover {
  background: white;
  border-color: var(--primary-color);
  color: var(--primary-color);
}

/* Recent Activity */
.activity-list {
  display: flex;
  flex-direction: column;
  gap: 0.75rem;
}

.activity-item {
  display: flex;
  align-items: flex-start;
  gap: 0.75rem;
  padding: 0.75rem;
  border-radius: 8px;
  transition: background 0.3s ease;
}

.activity-item:hover {
  background: #f8f9fa;
}

.activity-icon {
  font-size: 1.25rem;
  padding-top: 0.125rem;
}

.activity-content {
  flex: 1;
}

.activity-text {
  font-size: 0.9rem;
  color: var(--text-dark);
}

.activity-time {
  font-size: 0.8rem;
  color: var(--text-light);
  margin-top: 0.25rem;
}

/* Not Signed In State */
.not-signed-in {
  min-height: 60vh;
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 2rem;
}

.signin-prompt {
  text-align: center;
  max-width: 500px;
}

.signin-prompt-icon {
  font-size: 5rem;
  margin-bottom: 1.5rem;
}

.signin-prompt h2 {
  font-size: 2rem;
  color: var(--text-dark);
  margin-bottom: 1rem;
}

.signin-prompt p {
  color: var(--text-light);
  margin-bottom: 2rem;
  font-size: 1.1rem;
  line-height: 1.6;
}

.signin-buttons {
  display: flex;
  gap: 1rem;
  justify-content: center;
  flex-wrap: wrap;
}

.signin-btn {
  padding: 1rem 2rem;
  border-radius: 12px;
  font-weight: 600;
  font-size: 1rem;
  text-decoration: none;
  transition: all 0.3s ease;
  display: flex;
  align-items: center;
  gap: 0.5rem;
}

.signin-btn.primary {
  background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
  color: white;
  box-shadow: var(--shadow-md);
}

.signin-btn.primary:hover {
  transform: translateY(-3px);
  box-shadow: var(--shadow-lg);
}

.signin-btn.secondary {
  background: white;
  color: var(--primary-color);
  border: 2px solid var(--primary-color);
}

.signin-btn.secondary:hover {
  background: var(--primary-color);
  color: white;
}

/* Weather Widget */
.weather-widget {
  display: flex;
  align-items: center;
  gap: 1rem;
  padding: 1rem;
  background: linear-gradient(135deg, #e0f2fe 0%, #bae6fd 100%);
  border-radius: 12px;
}

.weather-icon {
  font-size: 2.5rem;
}

.weather-info {
  flex: 1;
}

.weather-temp {
  font-size: 1.5rem;
  font-weight: 700;
  color: var(--text-dark);
}

.weather-desc {
  font-size: 0.85rem;
  color: var(--text-light);
}

/* Notifications Badge */
.notification-badge {
  background: var(--danger-color);
  color: white;
  font-size: 0.7rem;
  font-weight: 700;
  padding: 2px 6px;
  border-radius: 10px;
  margin-left: 0.25rem;
}

/* Mobile Adjustments */
@media (max-width: 768px) {

/* Debug Banner */
.debug-banner {
  background: linear-gradient(135deg, #7c3aed 0%, #5b21b6 100%);
  color: white;
  padding: 0.75rem 1.5rem;
  text-align: center;
  font-weight: 600;
  font-size: 0.9rem;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 0.75rem;
}

.debug-banner code {
  background: rgba(255,255,255,0.2);
  padding: 0.25rem 0.5rem;
  border-radius: 4px;
  font-family: monospace;
}

/* Mobile Adjustments */
@media (max-width: 768px) {
  .header {
    padding: 1.5rem;
  }
  
  .greeting h1 {
    font-size: 1.5rem;
  }
  
  .header-actions {
    width: 100%;
  }
  
  .header-btn {
    flex: 1;
    justify-content: center;
  }
  
  .dashboard-container {
    padding: 1rem;
  }
  
  .card {
    padding: 1.25rem;
  }
  
  .next-game-content {
    flex-direction: column;
    align-items: stretch;
  }
  
  .game-actions {
    flex-direction: row;
    justify-content: space-between;
    align-items: center;
  }
  
  .countdown {
    padding: 0.75rem 1rem;
  }
  
  .quick-links-grid {
    grid-template-columns: 1fr;
  }
  
  .quick-stats {
    grid-template-columns: repeat(2, 1fr);
  }
}
</style>
</head>
<body>
  <!-- Loading Overlay -->
  <div class="loading-overlay" id="loadingOverlay">
    <div class="softball-spinner"></div>
  </div>

  <!-- Not Signed In State -->
  <div class="not-signed-in" id="notSignedInState" style="display: none;">
    <div class="signin-prompt">
      <div class="signin-prompt-icon">üè†</div>
      <h2>Your Personal Dashboard</h2>
      <p>Sign in to access your personalized dashboard with upcoming games, RSVP status, your stats, and quick actions tailored just for you.</p>
      <div class="signin-buttons">
        <a href="signin.html" class="signin-btn primary">
          <span>üîê</span> Sign In
        </a>
        <a href="signup.html" class="signin-btn secondary">
          <span>‚ú®</span> Create Account
        </a>
      </div>
    </div>
  </div>

  <!-- Debug Banner (only shown in debug mode) -->
  <div class="debug-banner" id="debugBanner" style="display: none;">
    üîß DEBUG MODE: Viewing dashboard as of <code id="debugDateDisplay"></code>
    <span style="opacity: 0.8;">‚Ä¢ Edit DEBUG_DATE in script to change</span>
  </div>

  <!-- Signed In Content -->
  <div id="signedInContent" style="display: none;">
    <!-- Header -->
    <header class="header">
      <div class="header-content">
        <div class="greeting-section">
          <div class="greeting">
            <h1 id="greetingText">Good morning, Player!</h1>
            <p id="teamContext">Loading your dashboard...</p>
            <div class="time-display" id="timeDisplay"></div>
          </div>
          <div class="header-actions">
            <a href="roster-management.html" class="header-btn primary" id="rsvpHeaderBtn">
              <span>‚úâÔ∏è</span> RSVP to Games
            </a>
            <a href="profile.html" class="header-btn secondary">
              <span>üë§</span> My Profile
            </a>
          </div>
        </div>
      </div>
    </header>

    <!-- Dashboard Content -->
    <main class="dashboard-container">
      <div class="dashboard-grid">
        
        <!-- Next Game Card (Featured) -->
        <div class="card next-game-card" id="nextGameCard">
          <div class="card-header">
            <h2 class="card-title">
              <span>üéØ</span> Next Game
            </h2>
            <a href="game-preview.html" class="card-action" id="nextGamePreviewLink" style="display: none;">
              Preview ‚Üí
            </a>
          </div>
          <div class="next-game-content" id="nextGameContent">
            <!-- Populated by JavaScript -->
            <div class="empty-state">
              <div class="empty-state-icon">üìÖ</div>
              <h3>No Upcoming Games</h3>
              <p>Check back when the schedule is posted!</p>
            </div>
          </div>
        </div>

        <!-- Quick Stats Card -->
        <div class="card">
          <div class="card-header">
            <h2 class="card-title">
              <span>üìä</span> My Stats
            </h2>
            <a href="player.html" class="card-action" id="viewFullStatsLink" style="display: none;">
              Full Stats ‚Üí
            </a>
          </div>
          <div class="quick-stats" id="quickStats">
            <div class="stat-item">
              <div class="stat-value" id="statAvg">.---</div>
              <div class="stat-label">Batting Avg</div>
            </div>
            <div class="stat-item">
              <div class="stat-value" id="statHits">--</div>
              <div class="stat-label">Hits</div>
            </div>
            <div class="stat-item">
              <div class="stat-value" id="statRuns">--</div>
              <div class="stat-label">Runs</div>
            </div>
            <div class="stat-item">
              <div class="stat-value" id="statGames">--</div>
              <div class="stat-label">Games</div>
            </div>
          </div>
          <div id="noStatsMessage" style="display: none;">
            <div class="empty-state">
              <p>Link your player profile to see your stats!</p>
              <a href="link-player.html" style="color: var(--primary-color); font-weight: 600;">Link Player ‚Üí</a>
            </div>
          </div>
        </div>

        <!-- Sidebar -->
        <div class="sidebar">
          <!-- Action Items -->
          <div class="card" id="actionItemsCard">
            <div class="card-header">
              <h2 class="card-title">
                <span>‚ö°</span> Action Needed
                <span class="notification-badge" id="actionCount" style="display: none;">0</span>
              </h2>
            </div>
            <div class="action-items" id="actionItems">
              <!-- Populated by JavaScript -->
            </div>
          </div>

          <!-- Quick Links -->
          <div class="card">
            <div class="card-header">
              <h2 class="card-title">
                <span>üîó</span> Quick Links
              </h2>
            </div>
            <div class="quick-links-grid">
              <a href="current-season.html" class="quick-link">
                <span class="quick-link-icon">üçÇ</span> Current Season
              </a>
              <a href="#" class="quick-link" id="myTeamLink">
                <span class="quick-link-icon">üèÜ</span> My Team
              </a>
              <a href="trophy-case.html" class="quick-link">
                <span class="quick-link-icon">üèÖ</span> Trophy Case
              </a>
              <a href="weekend-preview.html" class="quick-link">
                <span class="quick-link-icon">üîÆ</span> Weekend Preview
              </a>
              <a href="games.html" class="quick-link">
                <span class="quick-link-icon">üéÆ</span> Daily Games
              </a>
              <a href="pictures.html" class="quick-link">
                <span class="quick-link-icon">üì∑</span> Photo Gallery
              </a>
            </div>
          </div>
        </div>

        <!-- Upcoming Games List -->
        <div class="card">
          <div class="card-header">
            <h2 class="card-title">
              <span>üìÖ</span> Upcoming Games
            </h2>
            <a href="roster-management.html" class="card-action">
              Manage RSVPs ‚Üí
            </a>
          </div>
          <div class="games-list" id="upcomingGamesList">
            <!-- Populated by JavaScript -->
          </div>
        </div>

        <!-- Favorites -->
        <div class="card">
          <div class="card-header">
            <h2 class="card-title">
              <span>‚≠ê</span> My Favorites
            </h2>
            <a href="favorites.html" class="card-action">
              Manage ‚Üí
            </a>
          </div>
          <div id="favoritesContent">
            <h4 style="font-size: 0.9rem; color: var(--text-light); margin-bottom: 0.75rem;">Teams</h4>
            <div class="favorites-row" id="favoriteTeams">
              <!-- Populated by JavaScript -->
            </div>
            <h4 style="font-size: 0.9rem; color: var(--text-light); margin: 1rem 0 0.75rem;">Players</h4>
            <div class="favorites-row" id="favoritePlayers">
              <!-- Populated by JavaScript -->
            </div>
          </div>
          <div id="noFavoritesMessage" style="display: none;">
            <div class="empty-state">
              <div class="empty-state-icon">‚≠ê</div>
              <h3>No Favorites Yet</h3>
              <p>Add teams and players you want to follow!</p>
              <a href="favorites.html" style="color: var(--primary-color); font-weight: 600;">Add Favorites ‚Üí</a>
            </div>
          </div>
        </div>

        <!-- Captain Section (shown only for captains) -->
        <div class="card" id="captainCard" style="display: none;">
          <div class="card-header">
            <h2 class="card-title">
              <span>üéñÔ∏è</span> Captain Tools
            </h2>
          </div>
          <div class="quick-links-grid">
            <a href="roster-management.html" class="quick-link">
              <span class="quick-link-icon">üìã</span> Manage Roster
            </a>
            <a href="game-tracker.html" class="quick-link">
              <span class="quick-link-icon">üî∂</span> Game Tracker
            </a>
            <a href="submit-stats.html" class="quick-link">
              <span class="quick-link-icon">üßÆ</span> Submit Stats
            </a>
            <a href="submit-score.html" class="quick-link">
              <span class="quick-link-icon">üì¢</span> Submit Score
            </a>
          </div>
          <div id="captainRsvpSummary" style="margin-top: 1rem; padding-top: 1rem; border-top: 2px solid var(--border-color);">
            <h4 style="font-size: 0.9rem; color: var(--text-light); margin-bottom: 0.75rem;">Next Game RSVPs</h4>
            <div style="display: flex; gap: 1rem; flex-wrap: wrap;">
              <div style="display: flex; align-items: center; gap: 0.5rem;">
                <span style="color: var(--success-color); font-weight: 700;" id="rsvpYesCount">0</span>
                <span style="font-size: 0.85rem; color: var(--text-light);">Yes</span>
              </div>
              <div style="display: flex; align-items: center; gap: 0.5rem;">
                <span style="color: var(--warning-color); font-weight: 700;" id="rsvpMaybeCount">0</span>
                <span style="font-size: 0.85rem; color: var(--text-light);">Maybe</span>
              </div>
              <div style="display: flex; align-items: center; gap: 0.5rem;">
                <span style="color: var(--danger-color); font-weight: 700;" id="rsvpNoCount">0</span>
                <span style="font-size: 0.85rem; color: var(--text-light);">No</span>
              </div>
              <div style="display: flex; align-items: center; gap: 0.5rem;">
                <span style="color: var(--text-light); font-weight: 700;" id="rsvpPendingCount">0</span>
                <span style="font-size: 0.85rem; color: var(--text-light);">Pending</span>
              </div>
            </div>
          </div>
        </div>

      </div>
    </main>
  </div>

  <script type="module">
    import { onAuthChange, getCurrentUser, getUserProfile, isUserCaptain } from './firebase-auth.js';
    import { 
      getCurrentSeason, 
      getSeasonPlayerStatsOptimized,
      getAllTeams
    } from './firebase-data.js';
    import { getUpcomingTeamGames, getGameRSVPs, updateRSVP } from './firebase-roster.js';

    let currentUser = null;
    let userProfile = null;
    let currentSeason = null;
    let linkedTeam = null;
    let linkedPlayer = null;
    let upcomingGames = [];

    // ============================================
    // DEBUG MODE - Set to true to test with a fixed date
    // ============================================
    const DEBUG_MODE = true;
    const DEBUG_DATE = new Date('2025-10-05T10:00:00'); // Early October - mid-season for Fall
    // ============================================

    function getDebugNow() {
      return DEBUG_MODE ? new Date(DEBUG_DATE) : new Date();
    }

    console.log('üìä Dashboard loading...');
    if (DEBUG_MODE) {
      console.log('üîß DEBUG MODE ENABLED - Using fixed date:', DEBUG_DATE.toDateString());
      document.getElementById('debugBanner').style.display = 'flex';
      document.getElementById('debugDateDisplay').textContent = DEBUG_DATE.toLocaleDateString('en-US', { 
        weekday: 'long', 
        month: 'long', 
        day: 'numeric', 
        year: 'numeric' 
      });
    }

    // Update time display
    function updateTimeDisplay() {
      const now = getDebugNow();
      const options = { weekday: 'long', month: 'long', day: 'numeric', year: 'numeric' };
      let dateText = now.toLocaleDateString('en-US', options);
      if (DEBUG_MODE) {
        dateText += ' (DEBUG)';
      }
      document.getElementById('timeDisplay').textContent = dateText;
    }

    // Get greeting based on time of day
    function getGreeting() {
      const hour = getDebugNow().getHours();
      if (hour < 12) return 'Good morning';
      if (hour < 17) return 'Good afternoon';
      return 'Good evening';
    }

    // Calculate days until game
    function getDaysUntil(gameDate) {
      const now = getDebugNow();
      now.setHours(0, 0, 0, 0);
      
      let date;
      if (gameDate?.seconds) {
        date = new Date(gameDate.seconds * 1000);
      } else {
        date = new Date(gameDate);
      }
      date.setHours(0, 0, 0, 0);
      
      const diffTime = date - now;
      const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
      return diffDays;
    }

    // Format date for display
    // Time can come from: 
    //   1) The date field itself (timestamp with time, e.g., "December 7, 2025 at 10:00:00 AM UTC-5")
    //   2) A separate 'time' field (string, e.g., "10:00")
    function formatGameDate(gameDate, gameTimeField = null) {
      let date;
      if (gameDate?.seconds) {
        date = new Date(gameDate.seconds * 1000);
      } else {
        date = new Date(gameDate);
      }
      
      // Determine time display
      let timeDisplay = 'TBD';
      
      // First, check if there's a separate time field (takes priority)
      if (gameTimeField) {
        // Format like "10:00" to "10:00 AM"
        const timeParts = gameTimeField.split(':');
        if (timeParts.length >= 2) {
          let hours = parseInt(timeParts[0], 10);
          const minutes = timeParts[1];
          const ampm = hours >= 12 ? 'PM' : 'AM';
          hours = hours % 12 || 12;
          timeDisplay = `${hours}:${minutes} ${ampm}`;
        } else {
          timeDisplay = gameTimeField; // Use as-is if can't parse
        }
      } else {
        // Fall back to time from the date timestamp
        // Check if the time is midnight (00:00) - likely means no time was set
        const hours = date.getHours();
        const minutes = date.getMinutes();
        if (hours === 0 && minutes === 0) {
          timeDisplay = 'TBD';
        } else {
          timeDisplay = date.toLocaleTimeString('en-US', { hour: 'numeric', minute: '2-digit' });
        }
      }
      
      return {
        day: date.getDate(),
        month: date.toLocaleDateString('en-US', { month: 'short' }),
        weekday: date.toLocaleDateString('en-US', { weekday: 'short' }),
        time: timeDisplay,
        full: date.toLocaleDateString('en-US', { weekday: 'short', month: 'short', day: 'numeric' })
      };
    }

    // Render next game card
    async function renderNextGame(game) {
      const container = document.getElementById('nextGameContent');
      
      if (!game) {
        container.innerHTML = `
          <div class="empty-state">
            <div class="empty-state-icon">üìÖ</div>
            <h3>No Upcoming Games</h3>
            <p>Check back when the schedule is posted!</p>
          </div>
        `;
        return;
      }

      const daysUntil = getDaysUntil(game.date);
      const dateInfo = formatGameDate(game.date, game.time);
      const isHome = game.isHome;
      
      // Get user's RSVP status
      let userRsvp = 'pending';
      if (currentUser) {
        try {
          const rsvps = await getGameRSVPs(game.id);
          if (rsvps[currentUser.uid]) {
            userRsvp = rsvps[currentUser.uid].status || 'pending';
          }
        } catch (e) {
          console.log('Could not load RSVP status');
        }
      }

      // Update preview link
      const previewLink = document.getElementById('nextGamePreviewLink');
      previewLink.href = `game-preview.html?game=${game.id}&season=${currentSeason?.id}`;
      previewLink.style.display = 'inline-flex';

      // Helper to capitalize team name
      const capitalize = (str) => str ? str.charAt(0).toUpperCase() + str.slice(1).toLowerCase() : '';
      
      container.innerHTML = `
        <div class="game-matchup">
          <div class="matchup-teams">
            <div class="team-info">
              <div class="team-name">${capitalize(isHome ? linkedTeam : game.opponent)}</div>
              <div class="team-label">${isHome ? 'Home' : 'Away'}</div>
            </div>
            <div class="vs-badge">VS</div>
            <div class="team-info">
              <div class="team-name">${capitalize(isHome ? game.opponent : linkedTeam)}</div>
              <div class="team-label">${isHome ? 'Away' : 'Home'}</div>
            </div>
          </div>
          <div class="game-details">
            <div class="game-detail">
              <span>üìÖ</span> ${dateInfo.full}
            </div>
            <div class="game-detail">
              <span>‚è∞</span> ${dateInfo.time || 'TBD'}
            </div>
            <div class="game-detail">
              <span>üìç</span> ${game.field || game.location || 'TBD'}
            </div>
            ${game.gameType && game.gameType !== 'Regular' ? `
              <div class="game-detail">
                <span>üèÜ</span> ${game.gameType}
              </div>
            ` : ''}
          </div>
        </div>
        <div class="game-actions">
          <div class="countdown">
            <div class="countdown-number">${daysUntil}</div>
            <div class="countdown-label">${daysUntil === 1 ? 'day away' : 'days away'}</div>
          </div>
          <div class="rsvp-buttons">
            <button class="rsvp-btn yes ${userRsvp === 'yes' ? 'active' : ''}" data-status="yes" data-game="${game.id}">‚úì Yes</button>
            <button class="rsvp-btn maybe ${userRsvp === 'maybe' ? 'active' : ''}" data-status="maybe" data-game="${game.id}">? Maybe</button>
            <button class="rsvp-btn no ${userRsvp === 'no' ? 'active' : ''}" data-status="no" data-game="${game.id}">‚úó No</button>
          </div>
        </div>
      `;

      // Add RSVP button handlers
      container.querySelectorAll('.rsvp-btn').forEach(btn => {
        btn.addEventListener('click', async (e) => {
          const status = e.target.dataset.status;
          const gameId = e.target.dataset.game;
          
          try {
            const result = await updateRSVP(
              gameId,
              currentUser.uid,
              status,
              userProfile?.displayName || currentUser.displayName || 'Unknown',
              linkedTeam
            );
            
            if (result.success) {
              // Update UI
              container.querySelectorAll('.rsvp-btn').forEach(b => b.classList.remove('active'));
              e.target.classList.add('active');
              
              // Refresh upcoming games list
              renderUpcomingGames(upcomingGames);
            }
          } catch (error) {
            console.error('Error updating RSVP:', error);
          }
        });
      });
    }

    // Render upcoming games list
    async function renderUpcomingGames(games) {
      const container = document.getElementById('upcomingGamesList');
      
      if (!games || games.length === 0) {
        container.innerHTML = `
          <div class="empty-state">
            <div class="empty-state-icon">üìÖ</div>
            <h3>No Upcoming Games</h3>
            <p>Check back when the schedule is posted!</p>
          </div>
        `;
        return;
      }

      // Get RSVPs for all games
      const rsvpPromises = games.map(g => getGameRSVPs(g.id));
      const allRsvps = await Promise.all(rsvpPromises);

      // Skip first game (shown in featured card)
      const gamesToShow = games.slice(1, 6);
      
      if (gamesToShow.length === 0) {
        container.innerHTML = `
          <div class="empty-state">
            <p style="color: var(--text-light);">Only one game scheduled - shown above!</p>
          </div>
        `;
        return;
      }

      container.innerHTML = gamesToShow.map((game, index) => {
        const dateInfo = formatGameDate(game.date, game.time);
        const rsvps = allRsvps[index + 1] || {};
        const userRsvp = rsvps[currentUser?.uid]?.status || 'pending';
        const capitalize = (str) => str ? str.charAt(0).toUpperCase() + str.slice(1).toLowerCase() : '';
        
        return `
          <a href="game-preview.html?game=${game.id}&season=${currentSeason?.id}" class="game-item">
            <div class="game-date-box">
              <div class="game-date-day">${dateInfo.day}</div>
              <div class="game-date-month">${dateInfo.month}</div>
            </div>
            <div class="game-info">
              <div class="game-opponent">${game.isHome ? 'vs' : '@'} ${capitalize(game.opponent)}</div>
              <div class="game-meta">
                <span>${dateInfo.time}</span>
                <span>${game.field || game.location || ''}</span>
              </div>
            </div>
            <div class="game-rsvp-status ${userRsvp}">${userRsvp === 'pending' ? 'RSVP?' : userRsvp.toUpperCase()}</div>
          </a>
        `;
      }).join('');
    }

    // Render action items
    function renderActionItems() {
      const container = document.getElementById('actionItems');
      const countBadge = document.getElementById('actionCount');
      const actions = [];

      // Check for pending RSVPs
      const pendingRsvps = upcomingGames.filter(g => {
        // Check if user has RSVPed (we'd need to track this)
        return true; // Simplified - would need actual RSVP check
      }).length;

      if (pendingRsvps > 0 && upcomingGames.length > 0) {
        actions.push({
          icon: '‚úâÔ∏è',
          title: 'RSVP to upcoming games',
          description: `${upcomingGames.length} game${upcomingGames.length > 1 ? 's' : ''} need your response`,
          href: 'roster-management.html',
          urgent: upcomingGames.some(g => getDaysUntil(g.date) <= 2)
        });
      }

      // Check if player profile is linked
      if (!linkedPlayer) {
        actions.push({
          icon: 'üîó',
          title: 'Link your player profile',
          description: 'Connect your account to see your stats',
          href: 'link-player.html',
          urgent: false
        });
      }

      // Check for profile completion
      if (!userProfile?.displayName) {
        actions.push({
          icon: 'üë§',
          title: 'Complete your profile',
          description: 'Add your display name and photo',
          href: 'profile.html',
          urgent: false
        });
      }

      // Update badge
      if (actions.length > 0) {
        countBadge.textContent = actions.length;
        countBadge.style.display = 'inline';
      } else {
        countBadge.style.display = 'none';
      }

      if (actions.length === 0) {
        container.innerHTML = `
          <div class="empty-state" style="padding: 1rem;">
            <p style="color: var(--success-color); font-weight: 600;">‚úì All caught up!</p>
          </div>
        `;
        return;
      }

      container.innerHTML = actions.map(action => `
        <a href="${action.href}" class="action-item ${action.urgent ? 'urgent' : ''}">
          <div class="action-icon">${action.icon}</div>
          <div class="action-content">
            <div class="action-title">${action.title}</div>
            <div class="action-description">${action.description}</div>
          </div>
          <div class="action-arrow">‚Üí</div>
        </a>
      `).join('');
    }

    // Render quick stats
    function renderQuickStats(stats) {
      const statsContainer = document.getElementById('quickStats');
      const noStatsMessage = document.getElementById('noStatsMessage');
      const viewFullLink = document.getElementById('viewFullStatsLink');

      if (!stats || !linkedPlayer) {
        statsContainer.style.display = 'none';
        noStatsMessage.style.display = 'block';
        return;
      }

      statsContainer.style.display = 'grid';
      noStatsMessage.style.display = 'none';
      
      // Link to player page using authenticated user's Firebase UID
      viewFullLink.href = `player.html?id=${currentUser.uid}`;
      viewFullLink.style.display = 'inline-flex';

      // Calculate batting average properly: H / AB
      let avgDisplay = '.---';
      const hits = stats.h ?? stats.hits ?? 0;
      const atBats = stats.ab ?? stats.atBats ?? 0;
      
      if (atBats > 0) {
        const avg = hits / atBats;
        // Format as .XXX (e.g., .333, .250, .400)
        avgDisplay = avg.toFixed(3).replace(/^0/, ''); // Remove leading zero
      }

      document.getElementById('statAvg').textContent = avgDisplay;
      document.getElementById('statHits').textContent = hits || '--';
      document.getElementById('statRuns').textContent = stats.r ?? stats.runs ?? '--';
      document.getElementById('statGames').textContent = stats.g ?? stats.games ?? '--';
    }

    // Render favorites
    function renderFavorites(profile) {
      const teamsContainer = document.getElementById('favoriteTeams');
      const playersContainer = document.getElementById('favoritePlayers');
      const noFavoritesMessage = document.getElementById('noFavoritesMessage');
      const favoritesContent = document.getElementById('favoritesContent');

      const favoriteTeams = profile?.favoriteTeams || [];
      const favoritePlayers = profile?.favoritePlayers || [];

      if (favoriteTeams.length === 0 && favoritePlayers.length === 0) {
        favoritesContent.style.display = 'none';
        noFavoritesMessage.style.display = 'block';
        return;
      }

      favoritesContent.style.display = 'block';
      noFavoritesMessage.style.display = 'none';

      if (favoriteTeams.length > 0) {
        teamsContainer.innerHTML = favoriteTeams.map(team => `
          <a href="team.html?team=${encodeURIComponent(team)}" class="favorite-chip">
            <span>üèÜ</span> ${team}
          </a>
        `).join('');
      } else {
        teamsContainer.innerHTML = '<span style="color: var(--text-light); font-size: 0.9rem;">No favorite teams</span>';
      }

      if (favoritePlayers.length > 0) {
        playersContainer.innerHTML = favoritePlayers.map(player => `
          <a href="player.html?player=${encodeURIComponent(player)}" class="favorite-chip">
            <span>‚≠ê</span> ${player}
          </a>
        `).join('');
      } else {
        playersContainer.innerHTML = '<span style="color: var(--text-light); font-size: 0.9rem;">No favorite players</span>';
      }
    }

    // Setup captain features
    async function setupCaptainFeatures() {
      const isCaptain = await isUserCaptain();
      const captainCard = document.getElementById('captainCard');

      if (isCaptain) {
        captainCard.style.display = 'block';
        
        // Get RSVP counts for next game
        if (upcomingGames.length > 0) {
          const nextGame = upcomingGames[0];
          const rsvps = await getGameRSVPs(nextGame.id);
          
          let yes = 0, maybe = 0, no = 0, pending = 0;
          Object.values(rsvps).forEach(r => {
            switch(r.status) {
              case 'yes': yes++; break;
              case 'maybe': maybe++; break;
              case 'no': no++; break;
              default: pending++;
            }
          });

          document.getElementById('rsvpYesCount').textContent = yes;
          document.getElementById('rsvpMaybeCount').textContent = maybe;
          document.getElementById('rsvpNoCount').textContent = no;
          document.getElementById('rsvpPendingCount').textContent = pending;
        }
      }
    }

    // Main initialization
    async function initDashboard(user) {
      try {
        currentUser = user;
        
        // Get user profile
        const profileResult = await getUserProfile(user.uid);
        userProfile = profileResult.success ? profileResult.data : {};
        
        // Get current season
        currentSeason = await getCurrentSeason();
        
        // Extract linked info
        linkedTeam = userProfile?.linkedTeam || userProfile?.team || null;
        linkedPlayer = userProfile?.linkedPlayer || null;

        // Update greeting
        const displayName = userProfile?.displayName || user.displayName || 'Player';
        const firstName = displayName.split(' ')[0];
        document.getElementById('greetingText').textContent = `${getGreeting()}, ${firstName}!`;
        
        // Update team context
        if (linkedTeam) {
          document.getElementById('teamContext').textContent = `Team ${linkedTeam} ‚Ä¢ ${currentSeason?.displayName || 'Current Season'}`;
        } else {
          document.getElementById('teamContext').textContent = currentSeason?.displayName || 'Welcome to Mountainside Aces';
        }

        // Update time display
        updateTimeDisplay();

        // Set My Team quick link with team parameter
        const myTeamLink = document.getElementById('myTeamLink');
        if (linkedTeam) {
          myTeamLink.href = `current-season-team.html?team=${encodeURIComponent(linkedTeam)}`;
        } else {
          myTeamLink.href = 'current-season.html'; // Fallback if no team linked
        }

        // Load upcoming games if team is linked
        if (linkedTeam && currentSeason?.id) {
          let allGames = await getUpcomingTeamGames(linkedTeam, currentSeason.id);
          
          // In debug mode, filter games relative to DEBUG_DATE instead of today
          if (DEBUG_MODE) {
            const debugNow = getDebugNow();
            debugNow.setHours(0, 0, 0, 0);
            
            // Get ALL team games for the season (since getUpcomingTeamGames filters by real today)
            // We need to re-fetch without the date filter
            try {
              const { collection, getDocs } = await import('https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js');
              const { db } = await import('./firebase-data.js');
              
              const gamesRef = collection(db, 'seasons', currentSeason.id, 'games');
              const allGamesSnap = await getDocs(gamesRef);
              
              const teamIdLower = linkedTeam.toLowerCase();
              allGames = [];
              
              allGamesSnap.forEach(doc => {
                const data = doc.data();
                const homeTeamValue = data.homeTeamId || data.homeTeamName || data.homeTeam || data['home team'] || '';
                const awayTeamValue = data.awayTeamId || data.awayTeamName || data.awayTeam || data['away team'] || '';
                
                const homeTeamMatch = homeTeamValue.toLowerCase() === teamIdLower;
                const awayTeamMatch = awayTeamValue.toLowerCase() === teamIdLower;
                
                if (!homeTeamMatch && !awayTeamMatch) return;
                
                // Parse game date
                let gameDate;
                if (data.date?.seconds) {
                  gameDate = new Date(data.date.seconds * 1000);
                } else if (data.date) {
                  gameDate = new Date(data.date);
                } else {
                  return;
                }
                
                const gameDateCompare = new Date(gameDate);
                gameDateCompare.setHours(0, 0, 0, 0);
                
                // Include games from DEBUG_DATE forward
                if (gameDateCompare >= debugNow) {
                  const opponent = homeTeamMatch ? awayTeamValue : homeTeamValue;
                  const gameType = data.game_type || data.gameType || 'Regular';
                  
                  allGames.push({
                    id: doc.id,
                    ...data,
                    homeTeam: homeTeamValue,
                    awayTeam: awayTeamValue,
                    gameType: gameType,
                    isHome: homeTeamMatch,
                    opponent: opponent
                  });
                }
              });
              
              // Sort by date
              allGames.sort((a, b) => {
                const dateA = a.date?.seconds || new Date(a.date).getTime() / 1000 || 0;
                const dateB = b.date?.seconds || new Date(b.date).getTime() / 1000 || 0;
                return dateA - dateB;
              });
              
              console.log(`üîß DEBUG: Found ${allGames.length} games from ${debugNow.toDateString()} forward`);
            } catch (e) {
              console.error('Debug mode game fetch error:', e);
            }
          }
          
          upcomingGames = allGames;
          console.log(`üìÖ Loaded ${upcomingGames.length} upcoming games`);
          
          // Render next game
          await renderNextGame(upcomingGames[0]);
          
          // Render upcoming games list
          await renderUpcomingGames(upcomingGames);
        } else {
          renderNextGame(null);
          renderUpcomingGames([]);
        }

        // Load player stats if linked
        if (linkedPlayer && currentSeason?.id) {
          try {
            const seasonStats = await getSeasonPlayerStatsOptimized(currentSeason.id);
            const playerStats = seasonStats.find(p => 
              p.name?.toLowerCase() === linkedPlayer.toLowerCase() ||
              p.player?.toLowerCase() === linkedPlayer.toLowerCase()
            );
            renderQuickStats(playerStats);
          } catch (e) {
            console.log('Could not load player stats');
            renderQuickStats(null);
          }
        } else {
          renderQuickStats(null);
        }

        // Render action items
        renderActionItems();

        // Render favorites
        renderFavorites(userProfile);

        // Setup captain features
        await setupCaptainFeatures();

        // Hide loading, show content
        document.getElementById('loadingOverlay').classList.add('hidden');
        document.getElementById('signedInContent').style.display = 'block';

      } catch (error) {
        console.error('‚ùå Error initializing dashboard:', error);
        document.getElementById('loadingOverlay').classList.add('hidden');
        document.getElementById('signedInContent').style.display = 'block';
      }
    }

    // Auth state listener
    onAuthChange(async (user) => {
      console.log('üîê Auth state:', user ? user.email : 'Not signed in');
      
      if (user) {
        await initDashboard(user);
      } else {
        document.getElementById('loadingOverlay').classList.add('hidden');
        document.getElementById('notSignedInState').style.display = 'flex';
        document.getElementById('signedInContent').style.display = 'none';
      }
    });

    // Update time every minute
    setInterval(updateTimeDisplay, 60000);
  </script>
</body>
</html>

<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Wordle Admin - Mountainside Aces</title>
<link rel="stylesheet" href="style.css">
<style>
  :root {
    --bg-dark: #0a0e14;
    --bg-card: #0f1419;
    --accent-cyan: #00d4ff;
    --accent-green: #00ff88;
    --accent-red: #ff4757;
    --accent-gold: #ffd700;
    --accent-purple: #a855f7;
    --text-white: #ffffff;
    --text-gray: #8899a6;
    --border-dark: #1e2a36;
  }

  * { box-sizing: border-box; }

  body {
    font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
    background: var(--bg-dark);
    color: var(--text-white);
    margin: 0;
    padding: 20px;
    min-height: 100vh;
  }

  .container {
    max-width: 1200px;
    margin: 0 auto;
  }

  h1 {
    color: var(--accent-cyan);
    margin-bottom: 0.5rem;
  }

  .subtitle {
    color: var(--text-gray);
    margin-bottom: 2rem;
  }

  .admin-section {
    background: var(--bg-card);
    border: 1px solid var(--border-dark);
    border-radius: 12px;
    padding: 1.5rem;
    margin-bottom: 1.5rem;
  }

  .admin-section h2 {
    margin-top: 0;
    color: var(--accent-cyan);
    font-size: 1.2rem;
    border-bottom: 1px solid var(--border-dark);
    padding-bottom: 0.75rem;
    margin-bottom: 1rem;
  }

  .form-group {
    margin-bottom: 1rem;
  }

  label {
    display: block;
    color: var(--text-gray);
    margin-bottom: 0.5rem;
    font-size: 0.9rem;
  }

  select, input, textarea {
    width: 100%;
    padding: 0.75rem;
    background: var(--bg-dark);
    border: 1px solid var(--border-dark);
    border-radius: 8px;
    color: var(--text-white);
    font-size: 1rem;
  }

  select:focus, input:focus, textarea:focus {
    outline: none;
    border-color: var(--accent-cyan);
  }

  .form-row {
    display: grid;
    grid-template-columns: 1fr 2fr 1fr auto;
    gap: 1rem;
    align-items: end;
  }

  @media (max-width: 768px) {
    .form-row {
      grid-template-columns: 1fr;
    }
  }

  button {
    padding: 0.75rem 1.5rem;
    border: none;
    border-radius: 8px;
    font-size: 1rem;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.2s;
  }

  .btn-primary {
    background: var(--accent-cyan);
    color: var(--bg-dark);
  }

  .btn-primary:hover {
    filter: brightness(1.1);
  }

  .btn-danger {
    background: var(--accent-red);
    color: white;
  }

  .btn-success {
    background: var(--accent-green);
    color: var(--bg-dark);
  }

  .btn-secondary {
    background: var(--border-dark);
    color: var(--text-white);
  }

  .btn-small {
    padding: 0.5rem 1rem;
    font-size: 0.85rem;
  }

  .words-table {
    width: 100%;
    border-collapse: collapse;
  }

  .words-table th,
  .words-table td {
    padding: 0.75rem;
    text-align: left;
    border-bottom: 1px solid var(--border-dark);
  }

  .words-table th {
    color: var(--text-gray);
    font-weight: 600;
    font-size: 0.85rem;
    text-transform: uppercase;
  }

  .words-table tr:hover {
    background: rgba(255,255,255,0.02);
  }

  .word-cell {
    font-family: monospace;
    font-size: 1.1rem;
    font-weight: 700;
    letter-spacing: 2px;
  }

  .category-badge {
    display: inline-block;
    padding: 0.25rem 0.5rem;
    border-radius: 4px;
    font-size: 0.75rem;
    font-weight: 600;
    text-transform: uppercase;
  }

  .category-action { background: rgba(0, 212, 255, 0.2); color: var(--accent-cyan); }
  .category-equipment { background: rgba(0, 255, 136, 0.2); color: var(--accent-green); }
  .category-position { background: rgba(168, 85, 247, 0.2); color: var(--accent-purple); }
  .category-team { background: rgba(255, 215, 0, 0.2); color: var(--accent-gold); }
  .category-general { background: rgba(136, 153, 166, 0.2); color: var(--text-gray); }

  .status-enabled {
    color: var(--accent-green);
  }

  .status-disabled {
    color: var(--accent-red);
  }

  .stats-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
    gap: 1rem;
  }

  .stat-card {
    background: var(--bg-dark);
    padding: 1rem;
    border-radius: 8px;
    text-align: center;
  }

  .stat-value {
    font-size: 2rem;
    font-weight: 700;
    color: var(--accent-cyan);
  }

  .stat-label {
    color: var(--text-gray);
    font-size: 0.85rem;
  }

  .hidden { display: none; }

  .auth-warning {
    background: rgba(255, 71, 87, 0.1);
    border: 1px solid var(--accent-red);
    padding: 1rem;
    border-radius: 8px;
    color: var(--accent-red);
    text-align: center;
  }

  .action-buttons {
    display: flex;
    gap: 0.5rem;
    flex-wrap: wrap;
    margin-top: 1rem;
  }

  .bulk-words {
    font-family: monospace;
    min-height: 150px;
    resize: vertical;
  }

  .filter-bar {
    display: flex;
    gap: 1rem;
    margin-bottom: 1rem;
    flex-wrap: wrap;
  }

  .filter-bar select {
    width: auto;
    min-width: 150px;
  }

  .search-input {
    flex: 1;
    min-width: 200px;
  }

  .word-count {
    color: var(--text-gray);
    font-size: 0.9rem;
    margin-bottom: 1rem;
  }
</style>
</head>
<body>

<div class="container">
  <h1>üî§ Wordle Admin</h1>
  <p class="subtitle">Manage softball words for Aces Wordle puzzles</p>

  <div id="authWarning" class="auth-warning">
    ‚ö†Ô∏è Please sign in with an admin account to use this page.
    <br><br>
    <a href="signin.html" style="color: var(--accent-cyan);">Sign In</a>
  </div>

  <div id="adminContent" class="hidden">
    
    <!-- Quick Stats -->
    <div class="admin-section">
      <h2>üìä Word Pool Stats</h2>
      <div class="stats-grid">
        <div class="stat-card">
          <div class="stat-value" id="statTotal">-</div>
          <div class="stat-label">Total Words</div>
        </div>
        <div class="stat-card">
          <div class="stat-value" id="statEnabled">-</div>
          <div class="stat-label">Enabled</div>
        </div>
        <div class="stat-card">
          <div class="stat-value" id="statAction">-</div>
          <div class="stat-label">Action</div>
        </div>
        <div class="stat-card">
          <div class="stat-value" id="statEquipment">-</div>
          <div class="stat-label">Equipment</div>
        </div>
        <div class="stat-card">
          <div class="stat-value" id="statPosition">-</div>
          <div class="stat-label">Position</div>
        </div>
        <div class="stat-card">
          <div class="stat-value" id="statGeneral">-</div>
          <div class="stat-label">General</div>
        </div>
      </div>
    </div>

    <!-- Add Single Word -->
    <div class="admin-section">
      <h2>‚ûï Add Word</h2>
      <div class="form-row">
        <div class="form-group">
          <label>Word (letters only)</label>
          <input type="text" id="newWord" placeholder="PITCH" maxlength="10" style="text-transform: uppercase;">
        </div>
        <div class="form-group">
          <label>Hint/Definition</label>
          <input type="text" id="newHint" placeholder="What the pitcher throws">
        </div>
        <div class="form-group">
          <label>Category</label>
          <select id="newCategory">
            <option value="action">Action</option>
            <option value="equipment">Equipment</option>
            <option value="position">Position</option>
            <option value="team">Team</option>
            <option value="general">General</option>
          </select>
        </div>
        <div class="form-group">
          <label>&nbsp;</label>
          <button class="btn-success" onclick="addWord()">Add</button>
        </div>
      </div>
    </div>

    <!-- Bulk Add Words -->
    <div class="admin-section">
      <h2>üìù Bulk Add Words</h2>
      <p style="color: var(--text-gray); margin-bottom: 1rem;">
        Add multiple words at once. Format: <code>WORD | hint | category</code> (one per line)
      </p>
      <div class="form-group">
        <textarea id="bulkWords" class="bulk-words" placeholder="PITCH | What the pitcher throws | action
CATCH | What the catcher does | action
GLOVE | Worn on the hand | equipment"></textarea>
      </div>
      <div class="action-buttons">
        <button class="btn-primary" onclick="bulkAddWords()">Add All Words</button>
        <button class="btn-secondary" onclick="loadSuggestions()">Load Suggestions</button>
      </div>
    </div>

    <!-- Word List -->
    <div class="admin-section">
      <h2>üìã Word List</h2>
      
      <div class="filter-bar">
        <input type="text" id="searchWords" class="search-input" placeholder="Search words..." oninput="filterWords()">
        <select id="filterCategory" onchange="filterWords()">
          <option value="">All Categories</option>
          <option value="action">Action</option>
          <option value="equipment">Equipment</option>
          <option value="position">Position</option>
          <option value="team">Team</option>
          <option value="general">General</option>
        </select>
        <select id="filterStatus" onchange="filterWords()">
          <option value="">All Status</option>
          <option value="enabled">Enabled</option>
          <option value="disabled">Disabled</option>
        </select>
      </div>

      <div class="word-count" id="wordCount">Loading...</div>

      <div style="max-height: 500px; overflow-y: auto;">
        <table class="words-table">
          <thead>
            <tr>
              <th>Word</th>
              <th>Hint</th>
              <th>Category</th>
              <th>Status</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody id="wordsTableBody">
            <tr><td colspan="5" style="text-align: center; color: var(--text-gray);">Loading...</td></tr>
          </tbody>
        </table>
      </div>
    </div>

  </div>
</div>

<script type="module">
import { 
  db, 
  collection, 
  doc, 
  getDocs, 
  getDoc
} from './firebase-config.js';

import { 
  setDoc,
  updateDoc,
  deleteDoc,
  serverTimestamp
} from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';

import { getAuth, onAuthStateChanged } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js';

const auth = getAuth();

let allWords = [];
let currentUser = null;

// Auth check
onAuthStateChanged(auth, async (user) => {
  if (user) {
    currentUser = user;
    await checkAuthorization();
  } else {
    document.getElementById('authWarning').innerHTML = '‚ö†Ô∏è Please sign in to access this page.<br><br><a href="signin.html" style="color: var(--accent-cyan);">Sign In</a>';
  }
});

async function checkAuthorization() {
  try {
    const userDoc = await getDoc(doc(db, 'users', currentUser.uid));
    
    if (!userDoc.exists()) {
      document.getElementById('authWarning').innerHTML = '‚ö†Ô∏è User profile not found.';
      return;
    }

    const userProfile = userDoc.data();
    const userRole = (userProfile.userRole || '').toLowerCase();
    const userType = (userProfile.userType || '').toLowerCase();
    const role = (userProfile.role || '').toLowerCase();
    
    const isAuthorized = 
      userProfile.isAdmin === true || 
      userType === 'league-staff' ||
      userType === 'admin' ||
      userRole === 'admin' ||
      userRole === 'league-staff' ||
      role === 'admin' ||
      role === 'league-staff';

    if (isAuthorized) {
      document.getElementById('authWarning').classList.add('hidden');
      document.getElementById('adminContent').classList.remove('hidden');
      await loadWords();
    } else {
      document.getElementById('authWarning').innerHTML = '‚ö†Ô∏è You do not have admin permissions.';
    }
  } catch (error) {
    console.error('Auth error:', error);
    document.getElementById('authWarning').innerHTML = '‚ö†Ô∏è Error checking authorization: ' + error.message;
  }
}

async function loadWords() {
  try {
    const snapshot = await getDocs(collection(db, 'wordleWords'));
    allWords = [];
    
    snapshot.forEach(doc => {
      allWords.push({
        id: doc.id,
        ...doc.data()
      });
    });
    
    // Sort alphabetically
    allWords.sort((a, b) => (a.word || '').localeCompare(b.word || ''));
    
    updateStats();
    renderWordTable();
  } catch (error) {
    console.error('Error loading words:', error);
  }
}

function updateStats() {
  const enabled = allWords.filter(w => w.enabled !== false);
  const categories = {
    action: allWords.filter(w => w.category === 'action').length,
    equipment: allWords.filter(w => w.category === 'equipment').length,
    position: allWords.filter(w => w.category === 'position').length,
    general: allWords.filter(w => !w.category || w.category === 'general').length
  };
  
  document.getElementById('statTotal').textContent = allWords.length;
  document.getElementById('statEnabled').textContent = enabled.length;
  document.getElementById('statAction').textContent = categories.action;
  document.getElementById('statEquipment').textContent = categories.equipment;
  document.getElementById('statPosition').textContent = categories.position;
  document.getElementById('statGeneral').textContent = categories.general;
}

function renderWordTable(words = allWords) {
  const tbody = document.getElementById('wordsTableBody');
  document.getElementById('wordCount').textContent = `Showing ${words.length} of ${allWords.length} words`;
  
  if (words.length === 0) {
    tbody.innerHTML = '<tr><td colspan="5" style="text-align: center; color: var(--text-gray);">No words found</td></tr>';
    return;
  }
  
  tbody.innerHTML = words.map(word => `
    <tr data-id="${word.id}">
      <td class="word-cell">${word.word || ''}</td>
      <td>${word.hint || '-'}</td>
      <td><span class="category-badge category-${word.category || 'general'}">${word.category || 'general'}</span></td>
      <td class="${word.enabled !== false ? 'status-enabled' : 'status-disabled'}">
        ${word.enabled !== false ? '‚úì Enabled' : '‚úó Disabled'}
      </td>
      <td>
        <button class="btn-small btn-secondary" onclick="toggleWord('${word.id}', ${word.enabled !== false})">
          ${word.enabled !== false ? 'Disable' : 'Enable'}
        </button>
        <button class="btn-small btn-danger" onclick="deleteWord('${word.id}', '${word.word}')">Delete</button>
      </td>
    </tr>
  `).join('');
}

window.filterWords = function() {
  const search = document.getElementById('searchWords').value.toLowerCase();
  const category = document.getElementById('filterCategory').value;
  const status = document.getElementById('filterStatus').value;
  
  const filtered = allWords.filter(word => {
    const matchesSearch = !search || 
      (word.word || '').toLowerCase().includes(search) ||
      (word.hint || '').toLowerCase().includes(search);
    const matchesCategory = !category || word.category === category;
    const matchesStatus = !status || 
      (status === 'enabled' && word.enabled !== false) ||
      (status === 'disabled' && word.enabled === false);
    
    return matchesSearch && matchesCategory && matchesStatus;
  });
  
  renderWordTable(filtered);
};

window.addWord = async function() {
  const word = document.getElementById('newWord').value.trim().toUpperCase();
  const hint = document.getElementById('newHint').value.trim();
  const category = document.getElementById('newCategory').value;
  
  if (!word) {
    alert('Please enter a word');
    return;
  }
  
  if (!/^[A-Z]+$/.test(word)) {
    alert('Word must contain only letters');
    return;
  }
  
  // Check for duplicates
  if (allWords.some(w => w.word === word)) {
    alert('This word already exists');
    return;
  }
  
  try {
    const docId = word.toLowerCase();
    await setDoc(doc(db, 'wordleWords', docId), {
      word,
      hint,
      category,
      enabled: true,
      addedBy: currentUser.displayName || currentUser.email,
      addedAt: serverTimestamp()
    });
    
    // Clear form
    document.getElementById('newWord').value = '';
    document.getElementById('newHint').value = '';
    
    await loadWords();
    alert(`Added: ${word}`);
  } catch (error) {
    console.error('Error adding word:', error);
    alert('Error adding word: ' + error.message);
  }
};

window.bulkAddWords = async function() {
  const text = document.getElementById('bulkWords').value.trim();
  if (!text) {
    alert('Please enter some words');
    return;
  }
  
  const lines = text.split('\n').filter(l => l.trim());
  let added = 0;
  let skipped = 0;
  let errors = [];
  
  for (const line of lines) {
    const parts = line.split('|').map(p => p.trim());
    const word = (parts[0] || '').toUpperCase();
    const hint = parts[1] || '';
    const category = parts[2] || 'general';
    
    if (!word || !/^[A-Z]+$/.test(word)) {
      errors.push(`Invalid: ${line}`);
      continue;
    }
    
    if (allWords.some(w => w.word === word)) {
      skipped++;
      continue;
    }
    
    try {
      const docId = word.toLowerCase();
      await setDoc(doc(db, 'wordleWords', docId), {
        word,
        hint,
        category,
        enabled: true,
        addedBy: currentUser.displayName || currentUser.email,
        addedAt: serverTimestamp()
      });
      added++;
    } catch (error) {
      errors.push(`Error: ${word} - ${error.message}`);
    }
  }
  
  document.getElementById('bulkWords').value = '';
  await loadWords();
  
  let message = `Added ${added} words`;
  if (skipped > 0) message += `, skipped ${skipped} duplicates`;
  if (errors.length > 0) message += `\n\nErrors:\n${errors.join('\n')}`;
  alert(message);
};

window.toggleWord = async function(id, currentlyEnabled) {
  try {
    await updateDoc(doc(db, 'wordleWords', id), {
      enabled: !currentlyEnabled
    });
    await loadWords();
  } catch (error) {
    console.error('Error toggling word:', error);
    alert('Error: ' + error.message);
  }
};

window.deleteWord = async function(id, word) {
  if (!confirm(`Delete "${word}"?`)) return;
  
  try {
    await deleteDoc(doc(db, 'wordleWords', id));
    await loadWords();
  } catch (error) {
    console.error('Error deleting word:', error);
    alert('Error: ' + error.message);
  }
};

window.loadSuggestions = function() {
  const suggestions = `PITCH | What the pitcher throws | action
CATCH | What the catcher does | action
SWING | Batter's motion | action
SLIDE | How to avoid a tag | action
STEAL | Taking a base without a hit | action
THROW | Sending the ball | action
BUNT | Soft hit to infield | action
FIELD | Defensive play | action
SCORE | Crossing home plate | action
HOMER | Home run | action
DRIVE | Hard hit ball | action
GROUNDER | Ball hit on ground | action
GLOVE | Worn on the hand | equipment
CLEAT | Shoes with spikes | equipment
FENCE | Outfield boundary | equipment
BASES | Four corners of diamond | equipment
PLATE | Home base | equipment
MOUND | Where pitcher stands | equipment
FIRST | Initial base | position
THIRD | Hot corner | position
SHORT | Between second and third | position
COACH | Team leader | position
UMPIRE | Game official | position
BENCH | Where subs sit | position
INNING | Game segment | general
STRIKE | Missed swing or called | general
FOUL | Out of play | general
SAFE | Not out | general
ERROR | Defensive mistake | general
RALLY | Scoring surge | general
FINAL | Game end | general
CHAMP | Winner | general
DRAFT | Player selection | general
TRADE | Player exchange | general
SQUAD | Team roster | general`;
  
  document.getElementById('bulkWords').value = suggestions;
};

</script>

</body>
</html>

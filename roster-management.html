<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Roster Management - Mountainside Aces</title>
<script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
<script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
<script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
<style>
  * { box-sizing: border-box; }
  body { margin: 0; padding: 0; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
  #root { min-height: 100vh; }
  .table-scroll-container {
    overflow-x: auto;
    -webkit-overflow-scrolling: touch;
  }
  .table-scroll-container::-webkit-scrollbar {
    height: 8px;
  }
  .table-scroll-container::-webkit-scrollbar-track {
    background: #f1f1f1;
  }
  .table-scroll-container::-webkit-scrollbar-thumb {
    background: #888;
    border-radius: 4px;
  }
  .table-scroll-container::-webkit-scrollbar-thumb:hover {
    background: #555;
  }
</style>
</head>
<body>
<div id="root"></div>

<script type="text/babel">
const { useState, useEffect } = React;

// SVG Icon Components
const AlertCircle = ({ style }) => (
  <svg style={style} width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
    <circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="12"/><line x1="12" y1="16" x2="12.01" y2="16"/>
  </svg>
);

const Lock = ({ style }) => (
  <svg style={style} width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
    <rect x="3" y="11" width="18" height="11" rx="2"/><path d="M7 11V7a5 5 0 0 1 10 0v4"/>
  </svg>
);

const Eye = ({ style }) => (
  <svg style={style} width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
    <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/><circle cx="12" cy="12" r="3"/>
  </svg>
);

const Edit3 = ({ style }) => (
  <svg style={style} width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
    <path d="M12 20h9"/><path d="M16.5 3.5a2.121 2.121 0 0 1 3 3L7 19l-4 1 1-4L16.5 3.5z"/>
  </svg>
);

const X = ({ style }) => (
  <svg style={style} width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
    <line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/>
  </svg>
);

const LogIn = ({ style }) => (
  <svg style={style} width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
    <path d="M15 3h4a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-4"/><polyline points="10 17 15 12 10 7"/><line x1="15" y1="12" x2="3" y2="12"/>
  </svg>
);

const SEASONS = {
  fall: { name: 'Fall', minPlayers: 7, catcherMinPlayers: 9, maxRoster: 14, battingOrderSize: 14, 
         positions: ['P', 'C', '1B', '2B', '3B', 'SS', 'LF', 'CF', 'RF'] },
  summer: { name: 'Summer', minPlayers: 8, catcherMinPlayers: 10, maxRoster: 17, battingOrderSize: 17,
           positions: ['P', 'C', '1B', '2B', '3B', 'SS', 'LF', 'LCF', 'RCF', 'RF'] }
};

const RSVP_STATUS = {
  yes: { label: 'Yes', color: '#10b981', icon: '✓' },
  no: { label: 'No', color: '#ef4444', icon: '✗' },
  maybe: { label: 'Maybe', color: '#f59e0b', icon: '?' },
  none: { label: 'No Response', color: '#9ca3af', icon: '∅' }
};

function RosterManagement() {
  const [season, setSeason] = useState('fall');
  const [currentUserId, setCurrentUserId] = useState(null);
  const [loggedInPlayer, setLoggedInPlayer] = useState(null);
  const [selectedTeam, setSelectedTeam] = useState('');
  const [selectedGame, setSelectedGame] = useState(null);
  const [rsvps, setRsvps] = useState({});
  const [loading, setLoading] = useState(true);
  const [players, setPlayers] = useState([]);
  const [games, setGames] = useState([]);
  const [allTeams, setAllTeams] = useState([]);
  const [playerInfo, setPlayerInfo] = useState({});

  const isCaptain = loggedInPlayer?.isCaptain || false;
  const isLoggedIn = currentUserId !== null;

  useEffect(() => {
    async function loadData() {
      try {
        // Load player info for captain designation and jersey numbers
        const playerInfoResponse = await fetch('player_info.json');
        const playerInfoData = await playerInfoResponse.json();
        const playerInfoMap = {};
        playerInfoData.forEach(p => {
          playerInfoMap[p.name] = {
            captain: p.captain === 'yes',
            number: p.number || ''
          };
        });
        setPlayerInfo(playerInfoMap);

        // Load games
        const gamesResponse = await fetch('games.json');
        const allGames = await gamesResponse.json();
        const seasonGames = allGames.filter(g => g.year === "2025" && g.season === "Fall");
        
        const teamsSet = new Set();
        seasonGames.forEach(game => {
          teamsSet.add(game["home team"]);
          teamsSet.add(game["away team"]);
        });
        setAllTeams(Array.from(teamsSet).sort());
        
        // Get today's date at start of day for comparison
        const today = new Date();
        today.setHours(0, 0, 0, 0);
        
        // Filter for today and future games only
        const upcomingGames = seasonGames.filter(game => {
          const gameDate = new Date(game.date);
          gameDate.setHours(0, 0, 0, 0);
          return gameDate >= today;
        });
        
        const formattedGames = upcomingGames.map((game, index) => ({
          id: index + 1, 
          date: game.date, 
          homeTeam: game["home team"],
          awayTeam: game["away team"], 
          opponent: '', 
          gameType: game.game_type || 'Regular'
        }));
        
        setGames(formattedGames);
        setLoading(false);
      } catch (error) {
        console.error('Error loading data:', error);
        setLoading(false);
      }
    }
    loadData();
  }, []);

  useEffect(() => {
    async function loadTeamPlayers() {
      if (!selectedTeam) return setPlayers([]);
      try {
        const playerResponse = await fetch('data.json');
        const allPlayers = await playerResponse.json();
        const teamPlayers = allPlayers.filter(p =>
          p.year === "2025" && p.season === "Fall" && p.sub === "No" && p.team === selectedTeam
        );
        
        const formattedPlayers = teamPlayers.map((player, index) => {
          const nameParts = player.name.trim().split(' ');
          const avatar = nameParts.length > 1 ? 
            (nameParts[0][0] + nameParts[nameParts.length - 1][0]).toUpperCase() :
            player.name.substring(0, 2).toUpperCase();
          const atBats = Number(player.atBats) || 0;
          const hits = Number(player.hits) || 0;
          const battingAvg = atBats > 0 ? (hits / atBats).toFixed(3) : '.000';
          
          // Get captain status and jersey number from player_info
          const info = playerInfo[player.name] || { captain: false, number: '' };
          
          return {
            id: index + 1, 
            name: player.name, 
            jersey: info.number || (index + 1), // Use real number or fallback to index
            avatar, 
            battingAvg, 
            isCaptain: info.captain
          };
        }).sort((a, b) => a.name.localeCompare(b.name));
        
        setPlayers(formattedPlayers);
        
        // Filter games to only show games involving selected team
        setGames(prev => prev.filter(game => 
          game.homeTeam === selectedTeam || game.awayTeam === selectedTeam
        ).map(game => ({
          ...game, 
          opponent: game.homeTeam === selectedTeam ? game.awayTeam : game.homeTeam
        })));
      } catch (error) {
        console.error('Error loading team players:', error);
      }
    }
    loadTeamPlayers();
  }, [selectedTeam, playerInfo]);

  useEffect(() => {
    if (players.length === 0 || games.length === 0) return;
    const initialRsvps = {};
    players.forEach(player => {
      games.forEach(game => {
        const key = `${player.id}-${game.id}`;
        const statuses = ['yes', 'yes', 'yes', 'no', 'maybe', 'none'];
        initialRsvps[key] = statuses[Math.floor(Math.random() * statuses.length)];
      });
    });
    setRsvps(initialRsvps);
    if (games.length > 0 && !selectedGame) setSelectedGame(games[0].id);
  }, [players, games]);

  const handleLogin = (playerId) => {
    if (!playerId) {
      setCurrentUserId(null);
      setLoggedInPlayer(null);
    } else {
      const player = players.find(p => p.id === parseInt(playerId));
      setCurrentUserId(parseInt(playerId));
      setLoggedInPlayer(player);
    }
  };

  const handleRSVPClick = (playerId, gameId) => {
    if (currentUserId !== playerId) return;
    const key = `${playerId}-${gameId}`;
    const status = rsvps[key] || 'none';
    const statuses = ['yes', 'no', 'maybe', 'none'];
    const currentIndex = statuses.indexOf(status);
    const nextStatus = statuses[(currentIndex + 1) % statuses.length];
    setRsvps({ ...rsvps, [key]: nextStatus });
  };

  const currentSeason = SEASONS[season];

  return (
    <div style={{ fontFamily: "'Segoe UI', Tahoma, Geneva, Verdana, sans-serif", background: 'linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%)', minHeight: '100vh', padding: '2rem' }}>
      <div style={{ maxWidth: '1200px', margin: '0 auto' }}>
        <div style={{ background: 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)', color: 'white', textAlign: 'center', padding: '3rem 2rem', borderRadius: '12px', marginBottom: '2rem' }}>
          <h1 style={{ margin: 0, fontSize: '2.5rem', fontWeight: 'bold' }}>Roster Management</h1>
          <p style={{ margin: '1rem 0 0 0', fontSize: '1.1rem', opacity: 0.9 }}>2025 Fall Season</p>
        </div>

        <div style={{ background: 'white', padding: '1.5rem', borderRadius: '12px', marginBottom: '2rem', boxShadow: '0 4px 6px rgba(0,0,0,0.07)' }}>
          <div style={{ display: 'flex', flexWrap: 'wrap', gap: '1rem', alignItems: 'center', justifyContent: 'center' }}>
            <div style={{ display: 'flex', alignItems: 'center', gap: '0.5rem' }}>
              <span style={{ fontWeight: '600' }}>Team:</span>
              <select value={selectedTeam} onChange={(e) => { setSelectedTeam(e.target.value); setCurrentUserId(null); setLoggedInPlayer(null); }}
                style={{ padding: '0.5rem 1rem', border: '1px solid #ccc', borderRadius: '8px', fontSize: '14px', minWidth: '200px' }}>
                <option value="">Select a Team</option>
                {allTeams.map(team => <option key={team} value={team}>{team}</option>)}
              </select>
            </div>
            
            {selectedTeam && players.length > 0 && (
              <div style={{ display: 'flex', alignItems: 'center', gap: '0.5rem' }}>
                <LogIn style={{ width: '20px', height: '20px', color: '#6b7280' }} />
                <select value={currentUserId || ''} onChange={(e) => handleLogin(e.target.value)}
                  style={{ padding: '0.5rem 1rem', border: '1px solid #ccc', borderRadius: '8px', fontSize: '14px', minWidth: '200px' }}>
                  <option value="">Not Logged In</option>
                  {players.map(p => <option key={p.id} value={p.id}>{p.name} {p.isCaptain ? '(Captain)' : ''}</option>)}
                </select>
              </div>
            )}
          </div>
          
          {isLoggedIn ? (
            <div style={{ marginTop: '1rem', padding: '0.75rem 1rem', borderRadius: '8px', background: isCaptain ? '#eff6ff' : '#f0fdf4',
                          color: isCaptain ? '#1e40af' : '#166534', display: 'flex', alignItems: 'center', gap: '0.5rem', fontWeight: '600', justifyContent: 'center' }}>
              {isCaptain ? <Edit3 style={{ width: '18px', height: '18px' }} /> : <Eye style={{ width: '18px', height: '18px' }} />}
              <span>Logged in as {loggedInPlayer.name}{isCaptain && ' - Captain Access'}</span>
            </div>
          ) : (
            <div style={{ marginTop: '1rem', padding: '0.75rem 1rem', borderRadius: '8px', background: '#fef3c7', color: '#92400e',
                          display: 'flex', alignItems: 'center', gap: '0.5rem', fontWeight: '600', justifyContent: 'center', border: '1px solid #fde68a' }}>
              <AlertCircle style={{ width: '18px', height: '18px' }} />
              <span>{!selectedTeam ? 'Please select a team to begin' : 'Please log in to RSVP to games'}</span>
            </div>
          )}
        </div>

        {loading && <div style={{ background: 'white', padding: '2rem', borderRadius: '12px', textAlign: 'center', color: '#666' }}>Loading...</div>}
        
        {!loading && !selectedTeam && (
          <div style={{ background: 'white', padding: '2rem', borderRadius: '12px', textAlign: 'center' }}>
            <h3 style={{ marginTop: 0 }}>Welcome to Roster Management</h3>
            <p style={{ color: '#666' }}>Select a team to get started</p>
            <p style={{ color: '#666', fontSize: '0.9rem' }}>Teams: {allTeams.join(', ')}</p>
          </div>
        )}

        {!loading && selectedTeam && players.length === 0 && (
          <div style={{ background: 'white', padding: '2rem', borderRadius: '12px', textAlign: 'center', color: '#666' }}>
            Loading roster for {selectedTeam}...
          </div>
        )}

        {!loading && selectedTeam && players.length > 0 && games.length === 0 && (
          <div style={{ background: 'white', padding: '2rem', borderRadius: '12px', textAlign: 'center', color: '#666' }}>
            <h3 style={{ marginTop: 0 }}>No Upcoming Games</h3>
            <p>There are no scheduled games today or in the future for {selectedTeam}.</p>
          </div>
        )}

        {!loading && selectedTeam && players.length > 0 && games.length > 0 && (
          <div style={{ background: 'white', padding: '1.5rem', borderRadius: '12px', boxShadow: '0 4px 6px rgba(0,0,0,0.07)' }}>
            <h2 style={{ margin: '0 0 1rem 0', fontSize: '1.5rem', fontWeight: 'bold' }}>Game RSVPs</h2>
            <p style={{ margin: '0 0 1rem 0', color: '#666', fontSize: '0.9rem' }}>
              Showing {games.length} upcoming game{games.length !== 1 ? 's' : ''} for {selectedTeam} (today and future dates only)
            </p>
            <div className="table-scroll-container" style={{ overflowX: 'auto', border: '1px solid #e5e7eb', borderRadius: '8px' }}>
              <table style={{ width: '100%', borderCollapse: 'collapse', fontSize: '14px' }}>
                <thead>
                  <tr>
                    <th style={{ position: 'sticky', left: 0, background: '#f2f2f2', zIndex: 10, borderBottom: '2px solid #ccc', padding: '8px', textAlign: 'left', minWidth: '200px' }}>Player</th>
                    {games.map(game => (
                      <th key={game.id} style={{ borderBottom: '2px solid #ccc', padding: '8px', textAlign: 'center', background: '#f2f2f2', whiteSpace: 'nowrap', minWidth: '80px' }}>
                        {game.date}<br/><span style={{ fontSize: '12px', fontWeight: 'normal', color: '#666' }}>vs {game.opponent}</span>
                      </th>
                    ))}
                  </tr>
                </thead>
                <tbody>
                  {players.map(player => {
                    const isCurrentUser = player.id === currentUserId;
                    return (
                      <tr key={player.id} style={{ background: isCurrentUser ? '#eff6ff' : 'white', borderLeft: isCurrentUser ? '4px solid #667eea' : 'none' }}>
                        <td style={{ position: 'sticky', left: 0, background: isCurrentUser ? '#eff6ff' : 'white', zIndex: 10, borderBottom: '1px solid #ccc', padding: '8px' }}>
                          <div style={{ display: 'flex', alignItems: 'center', gap: '8px' }}>
                            <div style={{ width: '32px', height: '32px', borderRadius: '50%', background: '#667eea', color: 'white', display: 'flex', alignItems: 'center', justifyContent: 'center', fontSize: '12px', fontWeight: '600', flexShrink: 0 }}>
                              {player.avatar}
                            </div>
                            <div>
                              <div style={{ fontWeight: '500', fontSize: '14px' }}>
                                {player.name}
                                {isCurrentUser && <span style={{ fontSize: '10px', background: '#667eea', color: 'white', padding: '2px 6px', borderRadius: '4px', marginLeft: '8px' }}>You</span>}
                              </div>
                              <div style={{ fontSize: '11px', color: '#6b7280' }}>
                                {player.jersey ? `#${player.jersey}` : 'No #'}
                              </div>
                            </div>
                          </div>
                        </td>
                        {games.map(game => {
                          const key = `${player.id}-${game.id}`;
                          const status = rsvps[key] || 'none';
                          const statusInfo = RSVP_STATUS[status];
                          const canEdit = currentUserId === player.id;
                          
                          return (
                            <td key={game.id} style={{ borderBottom: '1px solid #ccc', padding: '8px', textAlign: 'center' }}>
                              <button onClick={() => handleRSVPClick(player.id, game.id)} disabled={!canEdit}
                                style={{ width: '48px', height: '48px', borderRadius: '8px', border: 'none', fontSize: '18px', fontWeight: 'bold', color: 'white',
                                        cursor: canEdit ? 'pointer' : 'not-allowed', opacity: canEdit ? 1 : 0.5, background: statusInfo.color }}>
                                {statusInfo.icon}
                              </button>
                            </td>
                          );
                        })}
                      </tr>
                    );
                  })}
                </tbody>
              </table>
            </div>
            <div style={{ marginTop: '1.5rem', padding: '1rem', background: '#f8f9fa', borderRadius: '8px', textAlign: 'center', color: '#666' }}>
              <p style={{ margin: 0, fontSize: '0.9rem' }}>
                ✅ Lineup management features coming soon! Currently showing RSVP grid with {players.length} players and {games.length} game{games.length !== 1 ? 's' : ''}.
              </p>
            </div>
          </div>
        )}
      </div>
    </div>
  );
}

ReactDOM.render(<RosterManagement />, document.getElementById('root'));
</script>
</body>
</html>
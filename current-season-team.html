<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Current Season Team - Aces Stats</title>
<meta name="theme-color" content="#2d5016">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<link rel="stylesheet" href="mobile-enhancements.css">
<link rel="stylesheet" href="nav-styles.css">
<style>
  :root {
    --primary-color: #2d5016;
    --secondary-color: #1a6b4a;
    --accent-color: #ffd700;
    --card-bg: #ffffff;
    --text-dark: #2d3748;
    --text-light: #718096;
    --border-color: #e2e8f0;
    --shadow-sm: 0 2px 8px rgba(0,0,0,0.08);
    --shadow-md: 0 4px 16px rgba(0,0,0,0.12);
    --shadow-lg: 0 12px 32px rgba(0,0,0,0.16);
  }

  body {
    font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
    margin: 0;
    padding: 0;
    background: linear-gradient(135deg, #f7fafc 0%, #edf2f7 100%);
    min-height: 100vh;
    line-height: 1.6;
    color: var(--text-dark);
  }
  
  .page-container {
    max-width: 1400px;
    margin: 0 auto;
    padding: 2rem;
  }
  
  /* Loading Spinner */
  .loading-overlay {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(255,255,255,0.95);
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 9999;
    transition: opacity 0.5s ease;
  }

  .loading-overlay.hidden {
    opacity: 0;
    pointer-events: none;
  }

  .softball-spinner::before {
    content: '‚öæ';
    font-size: 80px;
    animation: spin 1.5s ease-in-out infinite;
  }

  @keyframes spin {
    0%, 100% { 
      transform: rotate(0deg) scale(1); 
    }
    50% { 
      transform: rotate(180deg) scale(1.1); 
    }
  }
  
  /* Team Header */
  .team-header {
    background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
    color: white;
    padding: 4rem 2rem;
    border-radius: 16px;
    margin-bottom: 2rem;
    box-shadow: var(--shadow-lg);
    display: flex;
    align-items: center;
    gap: 2rem;
    position: relative;
    overflow: hidden;
  }
  
  .team-header::before {
    content: "";
    position: absolute;
    top: -50%;
    right: -10%;
    width: 500px;
    height: 500px;
    background: radial-gradient(circle, rgba(255,255,255,0.15) 0%, transparent 70%);
    border-radius: 50%;
  }
  
  .team-header::after {
    content: '‚öæ';
    position: absolute;
    bottom: -30px;
    left: -30px;
    font-size: 200px;
    opacity: 0.08;
    transform: rotate(-15deg);
  }
  
  .team-logo {
    height: 120px;
    max-width: 120px;
    object-fit: contain;
    border: 4px solid rgba(255,255,255,0.3);
    border-radius: 12px;
    background: rgba(255,255,255,0.15);
    padding: 1rem;
    display: none;
    transition: all 0.4s ease;
    z-index: 1;
  }
  
  .team-logo.loaded {
    display: block;
    animation: fadeInScale 0.6s ease backwards;
  }

  @keyframes fadeInScale {
    from {
      opacity: 0;
      transform: scale(0.8);
    }
    to {
      opacity: 1;
      transform: scale(1);
    }
  }
  
  .team-info {
    flex: 1;
    z-index: 1;
  }
  
  .team-header h1 {
    margin: 0;
    font-size: 3rem;
    font-weight: 800;
    text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
    animation: fadeInUp 0.6s ease backwards 0.1s;
  }
  
  .season-info {
    font-size: 1.1rem;
    opacity: 0.95;
    margin: 1rem 0 0 0;
    font-weight: 500;
    animation: fadeInUp 0.6s ease backwards 0.2s;
  }

  .quick-stats {
    display: flex;
    gap: 2rem;
    margin-top: 1.5rem;
    animation: fadeInUp 0.6s ease backwards 0.3s;
  }

  .quick-stat {
    text-align: center;
  }

  .quick-stat-value {
    font-size: 2rem;
    font-weight: 800;
    display: block;
    color: var(--accent-color);
    text-shadow: 1px 1px 2px rgba(0,0,0,0.2);
  }

  .quick-stat-label {
    font-size: 0.9rem;
    opacity: 0.9;
    font-weight: 600;
  }

  @keyframes fadeInUp {
    from {
      opacity: 0;
      transform: translateY(20px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  /* Next Game Banner */
  .next-game-banner {
    background: linear-gradient(135deg, #ffd700 0%, #ffb300 100%);
    color: #1a1a2e;
    padding: 1rem 1.5rem;
    border-radius: 12px;
    margin-bottom: 1.5rem;
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 1rem;
    box-shadow: var(--shadow-md);
    animation: fadeInUp 0.6s ease backwards 0.35s;
    border: 2px solid rgba(255,255,255,0.3);
  }

  .next-game-banner.hidden {
    display: none;
  }

  .next-game-info {
    display: flex;
    align-items: center;
    gap: 1rem;
    flex-wrap: wrap;
  }

  .next-game-icon {
    font-size: 2rem;
  }

  .next-game-details {
    display: flex;
    flex-direction: column;
  }

  .next-game-label {
    font-size: 0.85rem;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    opacity: 0.8;
  }

  .next-game-text {
    font-size: 1.1rem;
    font-weight: 700;
  }

  .next-game-countdown {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    background: rgba(255,255,255,0.9);
    padding: 0.75rem 1.25rem;
    border-radius: 10px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
  }

  .countdown-number {
    font-size: 2rem;
    font-weight: 900;
    color: var(--primary-color);
    line-height: 1;
  }

  .countdown-unit {
    font-size: 0.9rem;
    font-weight: 700;
    color: var(--primary-color);
    text-transform: uppercase;
  }

  .next-game-today {
    background: linear-gradient(135deg, #22c55e 0%, #16a34a 100%);
    color: white;
  }

  .next-game-today .countdown-number,
  .next-game-today .countdown-unit {
    color: white;
  }

  .next-game-today .next-game-countdown {
    background: rgba(255,255,255,0.2);
  }

  .next-game-tomorrow {
    background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
    color: white;
  }

  .next-game-tomorrow .countdown-number,
  .next-game-tomorrow .countdown-unit {
    color: white;
  }

  .next-game-tomorrow .next-game-countdown {
    background: rgba(255,255,255,0.2);
  }

  /* Season Complete Banner */
  .season-complete-banner {
    background: linear-gradient(135deg, #6366f1 0%, #4f46e5 100%);
    color: white;
  }

  .season-complete-banner .next-game-countdown {
    background: rgba(255,255,255,0.2);
  }

  .season-complete-banner .countdown-number,
  .season-complete-banner .countdown-unit {
    color: white;
  }
  
  /* Navigation */
  .filters-nav {
    background: var(--card-bg);
    padding: 1.5rem;
    border-radius: 16px;
    margin-bottom: 2rem;
    box-shadow: var(--shadow-sm);
    border: 1px solid var(--border-color);
    animation: fadeInUp 0.6s ease backwards 0.4s;
  }

  .nav-container {
    display: flex;
    flex-wrap: wrap;
    gap: 1rem;
    align-items: center;
    justify-content: center;
  }

  .nav-link {
    padding: 1rem 1.75rem;
    border: 2px solid var(--primary-color);
    background: white;
    color: var(--primary-color);
    text-decoration: none;
    border-radius: 12px;
    font-weight: 600;
    transition: all 0.3s ease;
    display: flex;
    align-items: center;
    gap: 0.5rem;
    white-space: nowrap;
    position: relative;
    overflow: hidden;
    z-index: 1;
  }

  .nav-link::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
    transform: translateX(-100%);
    transition: transform 0.3s ease;
    z-index: -1;
  }

  .nav-link:hover::before {
    transform: translateX(0);
  }

  .nav-link:hover {
    color: white;
    transform: translateY(-2px);
    box-shadow: var(--shadow-md);
    border-color: var(--secondary-color);
  }

  /* Section Styling */
  .section {
    background: var(--card-bg);
    border-radius: 16px;
    margin-bottom: 2rem;
    box-shadow: var(--shadow-sm);
    overflow: hidden;
    border: 1px solid var(--border-color);
    transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    animation: fadeInUp 0.6s ease backwards;
  }

  .section:nth-child(5) { animation-delay: 0.5s; }
  .section:nth-child(6) { animation-delay: 0.6s; }
  .section:nth-child(7) { animation-delay: 0.7s; }
  .section:nth-child(8) { animation-delay: 0.8s; }

  .section:hover {
    transform: translateY(-4px);
    box-shadow: var(--shadow-lg);
  }

  .section-header {
    background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
    color: white;
    padding: 1.25rem 1.5rem;
    font-size: 1.3rem;
    font-weight: 700;
    display: flex;
    align-items: center;
    gap: 0.75rem;
    position: relative;
    overflow: hidden;
  }

  .section-header::before {
    content: '';
    position: absolute;
    top: 0;
    right: 0;
    width: 150px;
    height: 150px;
    background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%);
    border-radius: 50%;
    transform: translate(30%, -30%);
  }

  .section-header::after {
    content: '';
    position: absolute;
    bottom: 0;
    left: 0;
    width: 100%;
    height: 3px;
    background: var(--accent-color);
  }

  .section-content {
    padding: 2rem;
  }

  /* ========================================
     BASEBALL CARD ROSTER GRID
     ======================================== */
  
  .roster-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
    gap: 1.5rem;
    perspective: 1000px;
  }

  /* Card Flip Container */
  .player-card-flip {
    width: 100%;
    height: 320px;
    cursor: pointer;
    perspective: 1000px;
  }

  .player-card-inner {
    position: relative;
    width: 100%;
    height: 100%;
    transition: transform 0.6s cubic-bezier(0.4, 0, 0.2, 1);
    transform-style: preserve-3d;
  }

  .player-card-flip.flipped .player-card-inner {
    transform: rotateY(180deg);
  }

  .player-card-front,
  .player-card-back {
    position: absolute;
    width: 100%;
    height: 100%;
    backface-visibility: hidden;
    -webkit-backface-visibility: hidden;
    border-radius: 12px;
    overflow: hidden;
    box-shadow: var(--shadow-md);
  }

  /* ========================================
     CARD FRONT STYLES
     ======================================== */
  
  .player-card-front {
    background: #f5f0e1;
    border: 3px solid #8B4513;
    display: flex;
    flex-direction: column;
  }

  .mini-card-banner {
    background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
    color: white;
    text-align: center;
    padding: 8px 10px;
    position: relative;
  }

  .mini-card-team {
    font-size: 11px;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 1.5px;
    margin: 0;
  }

  .mini-card-league {
    font-size: 8px;
    opacity: 0.85;
    letter-spacing: 0.5px;
  }

  .mini-card-photo-frame {
    flex: 1;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 12px;
    background: #f5f0e1;
    position: relative;
    min-height: 100px;
  }

  .mini-card-photo-frame::before {
    content: '';
    position: absolute;
    top: 6px;
    left: 6px;
    right: 6px;
    bottom: 6px;
    border: 2px solid #8B4513;
    border-radius: 6px;
    pointer-events: none;
  }

  .mini-card-photo {
    width: 100px;
    height: 100px;
    object-fit: cover;
    border-radius: 6px;
    border: 2px solid #8B4513;
  }

  .mini-card-photo-placeholder {
    width: 100px;
    height: 100px;
    background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
    border-radius: 6px;
    border: 2px solid #8B4513;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 48px;
    color: rgba(255,255,255,0.3);
  }

  .mini-card-player-info {
    background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
    color: white;
    padding: 10px 12px;
    text-align: center;
    position: relative;
  }

  .mini-card-number {
    position: absolute;
    top: -14px;
    right: 10px;
    background: var(--accent-color);
    color: #333;
    width: 28px;
    height: 28px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: 900;
    font-size: 12px;
    border: 2px solid #8B4513;
    font-family: 'Arial Black', sans-serif;
  }

  .mini-card-captain-star {
    position: absolute;
    top: -14px;
    left: 10px;
    font-size: 20px;
  }

  .mini-card-name {
    font-size: 14px;
    font-weight: 700;
    margin: 0 0 2px 0;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
  }

  .mini-card-position {
    font-size: 9px;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    opacity: 0.9;
  }

  .mini-card-stats-strip {
    background: #f5f0e1;
    padding: 8px 6px;
    border-top: 2px solid #8B4513;
  }

  .mini-card-stats-row {
    display: flex;
    justify-content: space-around;
    text-align: center;
  }

  .mini-card-stat {
    display: flex;
    flex-direction: column;
    align-items: center;
  }

  .mini-card-stat-value {
    font-size: 13px;
    font-weight: 700;
    color: var(--primary-color);
  }

  .mini-card-stat-label {
    font-size: 8px;
    color: #666;
    text-transform: uppercase;
    letter-spacing: 0.5px;
  }

  .mini-card-footer {
    background: #8B4513;
    color: #f5f0e1;
    text-align: center;
    padding: 6px;
    font-size: 8px;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 1px;
  }

  /* ========================================
     CARD BACK STYLES
     ======================================== */
  
  .player-card-back {
    background: #f5f0e1;
    border: 3px solid #8B4513;
    transform: rotateY(180deg);
    display: flex;
    flex-direction: column;
    padding: 12px;
  }

  .mini-card-back-header {
    text-align: center;
    padding-bottom: 8px;
    border-bottom: 2px solid #8B4513;
    margin-bottom: 8px;
  }

  .mini-card-back-number {
    font-size: 16px;
    font-weight: 900;
    color: var(--primary-color);
    font-family: 'Arial Black', sans-serif;
  }

  .mini-card-back-name {
    font-size: 14px;
    font-weight: 700;
    color: var(--text-dark);
    margin: 2px 0;
  }

  .mini-card-back-team {
    font-size: 10px;
    color: var(--text-light);
    text-transform: uppercase;
    letter-spacing: 0.5px;
  }

  .mini-card-back-vitals {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 6px;
    margin-bottom: 10px;
  }

  .mini-vital-item {
    display: flex;
    justify-content: space-between;
    padding: 4px 8px;
    background: rgba(45, 80, 22, 0.08);
    border-radius: 4px;
    font-size: 10px;
  }

  .mini-vital-label {
    font-weight: 600;
    color: var(--text-light);
  }

  .mini-vital-value {
    font-weight: 700;
    color: var(--primary-color);
  }

  .mini-card-back-stats {
    flex: 1;
    overflow: hidden;
  }

  .mini-card-back-stats-title {
    font-size: 9px;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    color: var(--text-light);
    margin-bottom: 6px;
    text-align: center;
  }

  .mini-stats-table {
    width: 100%;
    border-collapse: collapse;
    font-size: 9px;
  }

  .mini-stats-table th {
    background: var(--primary-color);
    color: white;
    padding: 4px 2px;
    font-weight: 600;
  }

  .mini-stats-table td {
    padding: 4px 2px;
    text-align: center;
    border-bottom: 1px solid #ddd;
  }

  .mini-card-back-link {
    display: block;
    text-align: center;
    margin-top: 8px;
    padding: 6px;
    background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
    color: white;
    text-decoration: none;
    border-radius: 6px;
    font-size: 10px;
    font-weight: 600;
    transition: all 0.2s ease;
  }

  .mini-card-back-link:hover {
    transform: scale(1.02);
    box-shadow: 0 2px 8px rgba(0,0,0,0.2);
  }

  .mini-card-back-footer {
    text-align: center;
    font-size: 7px;
    color: var(--text-light);
    margin-top: 8px;
    padding-top: 6px;
    border-top: 1px solid #ddd;
  }

  /* ========================================
     SUMMARY STATS GRID
     ======================================== */
  
  .summary-stats {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
    gap: 1.5rem;
  }

  .stat-card {
    background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
    border-radius: 12px;
    padding: 1.5rem;
    text-align: center;
    border: 1px solid var(--border-color);
    transition: all 0.3s ease;
    position: relative;
    overflow: hidden;
  }

  .stat-card::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 4px;
    background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
  }

  .stat-card:hover {
    transform: translateY(-4px);
    box-shadow: var(--shadow-md);
    border-color: var(--primary-color);
  }

  .stat-label {
    font-size: 0.85rem;
    color: var(--text-light);
    text-transform: uppercase;
    letter-spacing: 1px;
    font-weight: 700;
    margin-bottom: 0.5rem;
  }

  .stat-value {
    font-size: 2.25rem;
    font-weight: 800;
    color: var(--primary-color);
    line-height: 1.2;
  }

  .stat-description {
    font-size: 0.8rem;
    color: var(--text-light);
    margin-top: 0.5rem;
  }

  /* ========================================
     TABLE STYLES
     ======================================== */
  
  .stats-table, .schedule-table {
    width: 100%;
    border-collapse: collapse;
    font-size: 0.95rem;
  }

  .stats-table th, .schedule-table th {
    background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
    color: white;
    padding: 14px 12px;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    font-size: 0.85rem;
    position: sticky;
    top: 0;
    z-index: 10;
  }

  .stats-table td, .schedule-table td {
    padding: 14px 12px;
    border-bottom: 1px solid var(--border-color);
    font-weight: 700;
    color: var(--text-dark);
    text-align: center;
    font-size: 0.95rem;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    border-bottom: 2px solid var(--primary-color);
  }

  .stats-table tr:nth-child(even), 
  .schedule-table tr:nth-child(even) {
    background-color: #fafbfc;
  }

  .stats-table tr:hover, 
  .schedule-table tr:hover {
    background: linear-gradient(135deg, #f0f4f8 0%, #e9f0f7 100%);
  }

  .player-link {
    color: var(--primary-color);
    text-decoration: none;
    font-weight: 700;
    transition: all 0.2s ease;
  }

  .player-link:hover {
    color: var(--secondary-color);
    text-decoration: underline;
  }

  /* Game Results */
  .upcoming-game {
    background: linear-gradient(135deg, #fff8dc 0%, #fffacd 100%) !important;
    border-left: 4px solid var(--accent-color);
  }

  .completed-game {
    opacity: 0.85;
  }

  .win-result {
    color: #22c55e;
    font-weight: 800;
    text-shadow: 0 1px 2px rgba(34, 197, 94, 0.2);
  }

  .loss-result {
    color: #ef4444;
    font-weight: 800;
    text-shadow: 0 1px 2px rgba(239, 68, 68, 0.2);
  }

  .tie-result {
    color: #6b7280;
    font-weight: 800;
  }

  /* Loading and Empty States */
  .loading {
    text-align: center;
    padding: 3rem;
    color: var(--text-light);
    font-style: italic;
    font-size: 1.1rem;
  }

  .no-data {
    text-align: center;
    padding: 3rem 2rem;
    color: var(--text-light);
    font-size: 1.1rem;
    background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
    border-radius: 12px;
    border: 2px dashed var(--border-color);
  }

  .table-container {
    max-height: 600px;
    overflow-y: auto;
    border: 1px solid var(--border-color);
    border-radius: 12px;
  }

  .table-container::-webkit-scrollbar {
    width: 10px;
    height: 10px;
  }

  .table-container::-webkit-scrollbar-track {
    background: #f1f1f1;
    border-radius: 12px;
  }

  .table-container::-webkit-scrollbar-thumb {
    background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
    border-radius: 12px;
    border: 2px solid #f1f1f1;
  }

  .swipe-indicator {
    display: none;
    text-align: center;
    padding: 0.75rem;
    background: linear-gradient(135deg, #fff3cd 0%, #ffeeba 100%);
    color: #856404;
    font-size: 0.85rem;
    border-radius: 8px 8px 0 0;
    border: 1px solid #ffc107;
    border-bottom: none;
    font-weight: 600;
  }

  /* Mobile Responsive */
  @media (max-width: 768px) {
    .page-container {
      padding: 1rem;
    }

    .team-header {
      flex-direction: column;
      text-align: center;
      padding: 2rem 1rem;
    }

    .team-header h1 {
      font-size: 2rem;
    }

    .quick-stats {
      flex-wrap: wrap;
      justify-content: center;
      gap: 1rem;
    }

    .quick-stat-value {
      font-size: 1.5rem;
    }

    .next-game-banner {
      flex-direction: column;
      text-align: center;
      padding: 1rem;
    }

    .next-game-info {
      justify-content: center;
    }

    .countdown-number {
      font-size: 1.5rem;
    }

    .roster-grid {
      grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
      gap: 1rem;
    }

    .player-card-flip {
      height: 280px;
    }

    .mini-card-photo,
    .mini-card-photo-placeholder {
      width: 80px;
      height: 80px;
      font-size: 36px;
    }

    .mini-card-name {
      font-size: 12px;
    }

    .mini-card-stat-value {
      font-size: 11px;
    }

    .summary-stats {
      grid-template-columns: repeat(2, 1fr);
      gap: 1rem;
    }

    .stat-card {
      padding: 1.25rem 1rem;
    }

    .stat-value {
      font-size: 1.75rem;
    }

    .section-content {
      padding: 1rem;
    }

    .section-header {
      font-size: 1.1rem;
      padding: 1rem;
    }

    .swipe-indicator {
      display: block;
    }

    .table-container {
      overflow-x: auto;
    }

    .stats-table th, .schedule-table th,
    .stats-table td, .schedule-table td {
      padding: 10px 6px;
      font-size: 0.85rem;
      white-space: nowrap;
    }

    .player-card-flip::after {
      display: none;
    }
  }

  @media (max-width: 480px) {
    .roster-grid {
      grid-template-columns: repeat(2, 1fr);
      gap: 0.75rem;
    }

    .player-card-flip {
      height: 260px;
    }

    .mini-card-photo,
    .mini-card-photo-placeholder {
      width: 70px;
      height: 70px;
      font-size: 32px;
    }

    .summary-stats {
      grid-template-columns: repeat(2, 1fr);
    }
  }
</style>
</head>
<body>

<div class="loading-overlay" id="loadingOverlay">
  <div class="softball-spinner"></div>
</div>

<nav-component></nav-component>

<div class="page-container">
  
  <div class="team-header">
    <img id="team-logo" class="team-logo" src="" alt="" onerror="this.style.display='none';">
    
    <div class="team-info">
      <h1><span id="team-name">Loading...</span></h1>
      <p class="season-info" id="season-info">Loading season...</p>
      <div class="quick-stats">
        <div class="quick-stat">
          <span class="quick-stat-value" id="team-record">--</span>
          <span class="quick-stat-label">Record</span>
        </div>
        <div class="quick-stat">
          <span class="quick-stat-value" id="team-standing">--</span>
          <span class="quick-stat-label">Standing</span>
        </div>
        <div class="quick-stat">
          <span class="quick-stat-value" id="games-remaining">--</span>
          <span class="quick-stat-label">Games Left</span>
        </div>
      </div>
    </div>
  </div>

  <!-- Next Game Banner -->
  <div class="next-game-banner hidden" id="next-game-banner">
    <div class="next-game-info">
      <div class="next-game-icon">üìÖ</div>
      <div class="next-game-details">
        <span class="next-game-label">Next Game</span>
        <span class="next-game-text" id="next-game-text">--</span>
      </div>
    </div>
    <div class="next-game-countdown">
      <span class="countdown-number" id="countdown-number">--</span>
      <span class="countdown-unit" id="countdown-unit">days</span>
    </div>
  </div>
  
  <div class="filters-nav">

  </div>

  <!-- Team Summary Stats -->
  <div class="section">
    <div class="section-header">
      üìä Season Summary
    </div>
    <div class="section-content">
      <div class="summary-stats" id="summary-stats">
        <div class="loading">Loading team statistics...</div>
      </div>
    </div>
  </div>

  <!-- Current Roster - Baseball Cards -->
  <div class="section">
    <div class="section-header">
      üÉè Current Roster
    </div>
    <div class="section-content">
      <div class="roster-grid" id="roster-grid">
        <div class="loading">Loading roster...</div>
      </div>
    </div>
  </div>

  <!-- Player Stats -->
  <div class="section">
    <div class="section-header">
      üìà Player Statistics
    </div>
    <div class="section-content">
      <div class="table-container">
        <div class="swipe-indicator">‚Üê Swipe left/right to see all columns ‚Üí</div>
        <table class="stats-table" id="player-stats-table">
          <thead>
            <tr>
              <th>Player</th>
              <th>G</th>
              <th>AB</th>
              <th>H</th>
              <th>R</th>
              <th>BB</th>
              <th>BA</th>
              <th>OBP</th>
              <th>AcesBPI</th>
            </tr>
          </thead>
          <tbody>
            <tr><td colspan="9" class="loading">Loading player stats...</td></tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>

  <!-- Team Schedule -->
  <div class="section">
    <div class="section-header">
      üìÖ Season Schedule & Results
    </div>
    <div class="section-content">
      <div class="table-container">
        <div class="swipe-indicator">‚Üê Swipe left/right to see all columns ‚Üí</div>
        <table class="schedule-table" id="schedule-table">
          <thead>
            <tr>
              <th>Date</th>
              <th>Opponent</th>
              <th>H/A</th>
              <th>Score</th>
              <th>Result</th>
              <th>Type</th>
            </tr>
          </thead>
          <tbody>
            <tr><td colspan="6" class="loading">Loading schedule...</td></tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>

</div>

<script type="module">
  console.log('üöÄ Script started - loading Firebase data...');
  
  // Hide loading overlay when page loads
  window.addEventListener('load', function() {
    setTimeout(function() {
      document.getElementById('loadingOverlay').classList.add('hidden');
    }, 800);
  });
  
  // Import Firebase helper functions
  import {
    getSeasonGames,
    getSeasonPlayerStatsOptimized,
    getSeasonPitchingStatsOptimized,
    getCurrentSeason,
    getPlayerInfo,
    db,
    doc,
    getDoc
  } from './firebase-data.js';
  
  import { collection, query, where, getDocs } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';
    
  console.log('‚úÖ Imports successful!');

  // Mobile menu toggle
  function toggleMobileMenu() {
    const menu = document.getElementById('mobileNavMenu');
    menu.classList.toggle('open');
  }
  window.toggleMobileMenu = toggleMobileMenu;

  // Global variables
  let teamName = "";
  let allGames = [];
  let playerData = [];
  let playerExtraInfo = {}; // Store additional player info (photos, position, etc.)
  let currentSeasonData = null;
  const today = new Date();

  // Get team name from URL
  const params = new URLSearchParams(window.location.search);
  teamName = params.get("team");

  if (!teamName) {
    document.body.innerHTML = '<div class="page-container"><h1>Error: Team not specified</h1><p><a href="current-season.html">Return to current season</a></p></div>';
  } else {
    loadTeamData();
  }

  // Helper function to capitalize
  const capitalize = (str) => str ? str.charAt(0).toUpperCase() + str.slice(1) : "";

  async function loadTeamData() {
    try {
      console.log('üìä Loading team data from Firebase...');
      
      // Get current season
      currentSeasonData = await getCurrentSeason();
      console.log('‚úÖ Current season:', currentSeasonData);
      
      const seasonId = currentSeasonData.id;
      
      // Update season info in header
      document.getElementById("season-info").textContent = 
        `${currentSeasonData.year} ${capitalize(currentSeasonData.season)} Season Performance`;
      
      // Fetch all data
      const [games, batting, pitching] = await Promise.all([
        getSeasonGames(seasonId),
        getSeasonPlayerStatsOptimized(seasonId),
        getSeasonPitchingStatsOptimized(seasonId)
      ]);
      
      console.log(`‚úÖ Fetched: ${games?.length || 0} games, ${batting?.length || 0} batting records`);
      
      // Map games to expected format
      allGames = (games || []).map(g => {
        let dateString = "";
        if (g.date && g.date.seconds) {
          const dateObj = new Date(g.date.seconds * 1000);
          dateString = dateObj.toLocaleDateString('en-US');
        } else if (g.date) {
          dateString = g.date;
        }
        
        return {
          "home team": g.homeTeamName || capitalize(g.homeTeamId) || "",
          "away team": g.awayTeamName || capitalize(g.awayTeamId) || "",
          "home score": g.homeScore !== undefined ? g.homeScore : null,
          "away score": g.awayScore !== undefined ? g.awayScore : null,
          winner: capitalize(g.winner),
          game_type: g.gameType === "regular" ? "Regular" :
                     g.gameType === "playoff" ? "Playoff" :
                     capitalize(g.gameType) || "Regular",
          date: dateString,
          year: currentSeasonData.year.toString(),
          season: capitalize(currentSeasonData.season),
          forfeit: g.forfeit ? "Yes" : "No"
        };
      });
      
      console.log('‚úÖ Mapped games:', allGames.length);
      
      // Map batting data - filter for this specific team
      playerData = (batting || [])
        .filter(p => {
          const playerTeam = p.team || p.currentTeam || "";
          return playerTeam.toLowerCase() === teamName.toLowerCase();
        })
        .map(p => ({
          id: p.id || p.playerId,
          name: p.playerName || p.name || p.id,
          team: teamName,
          games: Number(p.games) || 0,
          atBats: Number(p.atBats) || 0,
          hits: Number(p.hits) || 0,
          runs: Number(p.runs) || 0,
          walks: Number(p.walks) || 0,
          acesBPI: p.acesBPI || "N/A",
          battingAverage: p.battingAverage || 0,
          onBasePercentage: p.onBasePercentage || 0
        }));
      
      console.log(`‚úÖ Filtered to ${playerData.length} players on team ${teamName}`);
      
      // Fetch additional player info for baseball cards (photos, position, etc.)
      await loadPlayerExtraInfo();
      
      // Initialize page
      initializePage();
      
      // Setup click outside to close flipped cards
      setupCardFlipHandlers();
      
    } catch (error) {
      console.error('‚ùå Error loading team data:', error);
      document.body.innerHTML = `
        <div class="page-container">
          <h1>Error loading team data</h1>
          <p>Could not load statistics. Please try again later.</p>
          <p><a href="current-season.html">Return to current season</a></p>
        </div>
      `;
    }
  }

  // Load extra player info (photos, position, number, captain status)
  async function loadPlayerExtraInfo() {
    console.log('üé¥ Loading extra player info for baseball cards...');
    
    const infoPromises = playerData.map(async (player) => {
      try {
        // Get player profile info
        const info = await getPlayerInfo(player.name);
        
        // Try to get photo from linked user account
        let photoURL = null;
        try {
          const usersRef = collection(db, 'users');
          const q = query(usersRef, where('linkedPlayer', '==', player.name));
          const querySnapshot = await getDocs(q);
          
          if (!querySnapshot.empty) {
            const userData = querySnapshot.docs[0].data();
            photoURL = userData.playerPhotoURL || userData.profilePhotoURL || null;
          }
        } catch (e) {
          console.warn('Could not fetch user photo for', player.name);
        }
        
        // Fall back to info.photo if no user photo
        if (!photoURL && info?.photo) {
          photoURL = info.photo;
        }
        
        playerExtraInfo[player.id] = {
          position: info?.position || '-',
          bats: info?.bats || '-',
          throws: info?.throws || '-',
          number: info?.number || null,
          nickname: info?.nickname || null,
          captain: info?.captain === 'Yes' || info?.captain === 'yes',
          photoURL: photoURL
        };
        
      } catch (error) {
        console.warn('Could not load extra info for', player.name);
        playerExtraInfo[player.id] = {
          position: '-',
          bats: '-',
          throws: '-',
          number: null,
          nickname: null,
          captain: false,
          photoURL: null
        };
      }
    });
    
    await Promise.all(infoPromises);
    console.log('‚úÖ Loaded extra info for', Object.keys(playerExtraInfo).length, 'players');
  }

  // Setup click handlers for card flipping
  function setupCardFlipHandlers() {
    // Click outside any card to close all flipped cards
    document.addEventListener('click', (e) => {
      // If clicking outside all cards, close all flipped cards
      if (!e.target.closest('.player-card-flip')) {
        document.querySelectorAll('.player-card-flip.flipped').forEach(card => {
          card.classList.remove('flipped');
        });
      }
    });
  }

  // Handle card flip
  function flipCard(cardElement, event) {
    event.stopPropagation();
    
    // If clicking the "View Full Profile" link, don't flip
    if (event.target.classList.contains('mini-card-back-link')) {
      return;
    }
    
    // Close all other flipped cards first
    document.querySelectorAll('.player-card-flip.flipped').forEach(card => {
      if (card !== cardElement) {
        card.classList.remove('flipped');
      }
    });
    
    // Toggle this card
    cardElement.classList.toggle('flipped');
  }
  
  // Make flipCard available globally
  window.flipCard = flipCard;

  function parseGameDate(dateStr) {
    return new Date(dateStr);
  }

  function initializePage() {
    // Update page elements
    document.title = `${teamName} - ${currentSeasonData.year} ${capitalize(currentSeasonData.season)} Season`;
    document.getElementById("team-name").textContent = teamName;
    
    // Load team logo
    loadTeamLogo();
    
    // Calculate team record and standings position
    updateTeamHeader();
    
    // Update next game banner
    updateNextGameBanner();
    
    // Update all sections
    updateSummaryStats();
    updateRoster();
    updatePlayerStats();
    updateSchedule();
  }

  function loadTeamLogo() {
    const logoElement = document.getElementById("team-logo");
    
    logoElement.src = `logos/${teamName.toLowerCase().replace(/\s+/g, '_')}.png`;
    logoElement.alt = `${teamName} logo`;
    
    logoElement.onload = function() {
      this.classList.add('loaded');
      this.style.display = 'block';
    };
    
    logoElement.onerror = function() {
      this.style.display = 'none';
    };
  }

  function updateTeamHeader() {
    // Calculate team record
    const teamGames = allGames.filter(g => 
      (g["home team"] === teamName || g["away team"] === teamName) && 
      g.winner && g.winner.trim() !== "" &&
      parseGameDate(g.date) < today
    );

    let wins = 0, losses = 0, ties = 0;
    teamGames.forEach(game => {
      if (game.winner === teamName) {
        wins++;
      } else if (game.winner === "Tie") {
        ties++;
      } else {
        losses++;
      }
    });

    const recordStr = ties > 0 ? `${wins}-${losses}-${ties}` : `${wins}-${losses}`;
    document.getElementById("team-record").textContent = recordStr;

    // Calculate games remaining
    const totalScheduledGames = allGames.filter(g => 
      g["home team"] === teamName || g["away team"] === teamName
    ).length;
    const gamesPlayed = teamGames.length;
    const remaining = totalScheduledGames - gamesPlayed;
    document.getElementById("games-remaining").textContent = remaining;

    // Calculate standing position
    const standingPosition = calculateStandingPosition();
    document.getElementById("team-standing").textContent = standingPosition;
  }

  function updateNextGameBanner() {
    const banner = document.getElementById("next-game-banner");
    const textEl = document.getElementById("next-game-text");
    const numberEl = document.getElementById("countdown-number");
    const unitEl = document.getElementById("countdown-unit");
    const iconEl = banner.querySelector(".next-game-icon");
    
    // Get all games for this team
    const teamGames = allGames.filter(g => 
      g["home team"] === teamName || g["away team"] === teamName
    );
    
    // Find upcoming games (games with no winner yet or in the future)
    const todayStart = new Date();
    todayStart.setHours(0, 0, 0, 0);
    
    const upcomingGames = teamGames.filter(g => {
      const gameDate = parseGameDate(g.date);
      gameDate.setHours(0, 0, 0, 0);
      // Game is upcoming if it's today or in the future AND has no winner
      return gameDate >= todayStart && (!g.winner || g.winner.trim() === "");
    }).sort((a, b) => parseGameDate(a.date) - parseGameDate(b.date));
    
    if (upcomingGames.length === 0) {
      // No upcoming games - check if season is complete
      const totalGames = teamGames.length;
      const completedGames = teamGames.filter(g => g.winner && g.winner.trim() !== "").length;
      
      if (completedGames === totalGames && totalGames > 0) {
        // Season complete
        banner.classList.remove("hidden", "next-game-today", "next-game-tomorrow");
        banner.classList.add("season-complete-banner");
        iconEl.textContent = "üèÜ";
        textEl.textContent = "Season Complete!";
        numberEl.textContent = completedGames;
        unitEl.textContent = "games played";
      } else {
        // No games scheduled or all played
        banner.classList.add("hidden");
      }
      return;
    }
    
    // Get the next game
    const nextGame = upcomingGames[0];
    const nextGameDate = parseGameDate(nextGame.date);
    nextGameDate.setHours(0, 0, 0, 0);
    
    // Calculate days until game
    const timeDiff = nextGameDate.getTime() - todayStart.getTime();
    const daysUntil = Math.ceil(timeDiff / (1000 * 60 * 60 * 24));
    
    // Determine opponent and home/away
    const isHome = nextGame["home team"] === teamName;
    const opponent = isHome ? nextGame["away team"] : nextGame["home team"];
    const homeAway = isHome ? "vs" : "@";
    
    // Format the date nicely
    const gameDay = nextGameDate.toLocaleDateString('en-US', { 
      weekday: 'short', 
      month: 'short', 
      day: 'numeric' 
    });
    
    // Update the banner content
    banner.classList.remove("hidden", "next-game-today", "next-game-tomorrow", "season-complete-banner");
    
    if (daysUntil === 0) {
      // Game is TODAY
      banner.classList.add("next-game-today");
      iconEl.textContent = "üî•";
      textEl.textContent = `TODAY ${homeAway} ${opponent}`;
      numberEl.textContent = "TODAY";
      unitEl.textContent = "Game Day!";
    } else if (daysUntil === 1) {
      // Game is TOMORROW
      banner.classList.add("next-game-tomorrow");
      iconEl.textContent = "‚ö°";
      textEl.textContent = `Tomorrow ${homeAway} ${opponent}`;
      numberEl.textContent = "1";
      unitEl.textContent = "day";
    } else {
      // Game is further out
      iconEl.textContent = "üìÖ";
      textEl.textContent = `${gameDay} ${homeAway} ${opponent}`;
      numberEl.textContent = daysUntil;
      unitEl.textContent = daysUntil === 1 ? "day" : "days";
    }
    
    console.log(`üìÖ Next game: ${nextGame.date} vs ${opponent} (${daysUntil} days away)`);
  }

  function calculateStandingPosition() {
    // Get all teams from games
    const allTeams = new Set();
    allGames.forEach(g => {
      if (g["home team"]) allTeams.add(g["home team"]);
      if (g["away team"]) allTeams.add(g["away team"]);
    });

    // Calculate standings
    const teamStats = {};
    allTeams.forEach(team => {
      teamStats[team] = { 
        name: team, 
        wins: 0, 
        losses: 0, 
        runsFor: 0, 
        runsAgainst: 0,
        h2h: {}
      };
    });

    allGames.forEach(g => {
      const isPast = parseGameDate(g.date) < today;
      const hasWinner = g.winner && g.winner.trim() !== "";
      if (!isPast || !hasWinner) return;

      const home = g["home team"];
      const away = g["away team"];

      if (g.winner === home) {
        if (teamStats[home]) teamStats[home].wins++;
        if (teamStats[away]) teamStats[away].losses++;
      } else if (g.winner === away) {
        if (teamStats[away]) teamStats[away].wins++;
        if (teamStats[home]) teamStats[home].losses++;
      }

      // Track runs
      const homeScore = parseInt(g["home score"]) || 0;
      const awayScore = parseInt(g["away score"]) || 0;
      
      if (teamStats[home]) {
        teamStats[home].runsFor += homeScore;
        teamStats[home].runsAgainst += awayScore;
      }
      if (teamStats[away]) {
        teamStats[away].runsFor += awayScore;
        teamStats[away].runsAgainst += homeScore;
      }
    });

    // Sort teams by wins, then win percentage, then run differential
    const sortedTeams = Object.values(teamStats).sort((a, b) => {
      if (b.wins !== a.wins) return b.wins - a.wins;
      
      const wpA = (a.wins + a.losses) > 0 ? a.wins / (a.wins + a.losses) : 0;
      const wpB = (b.wins + b.losses) > 0 ? b.wins / (b.wins + b.losses) : 0;
      if (wpB !== wpA) return wpB - wpA;
      
      const rdA = a.runsFor - a.runsAgainst;
      const rdB = b.runsFor - b.runsAgainst;
      return rdB - rdA;
    });

    // Find position
    const position = sortedTeams.findIndex(t => t.name === teamName) + 1;
    
    if (position === 0) return "-";
    
    // Add ordinal suffix
    const suffix = position === 1 ? "st" : 
                   position === 2 ? "nd" : 
                   position === 3 ? "rd" : "th";
    
    return `${position}${suffix}`;
  }

  function updateSummaryStats() {
    const container = document.getElementById("summary-stats");
    
    if (playerData.length === 0) {
      container.innerHTML = '<div class="no-data">No statistics available yet</div>';
      return;
    }

    // Calculate team totals
    const totals = playerData.reduce((acc, p) => {
      acc.games = Math.max(acc.games, Number(p.games) || 0);
      acc.atBats += Number(p.atBats) || 0;
      acc.hits += Number(p.hits) || 0;
      acc.runs += Number(p.runs) || 0;
      acc.walks += Number(p.walks) || 0;
      return acc;
    }, { games: 0, atBats: 0, hits: 0, runs: 0, walks: 0 });

    const teamBA = totals.atBats > 0 ? (totals.hits / totals.atBats).toFixed(3) : '.000';
    const teamOBP = (totals.atBats + totals.walks) > 0 
      ? ((totals.hits + totals.walks) / (totals.atBats + totals.walks)).toFixed(3) 
      : '.000';
    const runsPerGame = totals.games > 0 ? (totals.runs / totals.games).toFixed(1) : '0.0';

    container.innerHTML = `
      <div class="stat-card">
        <div class="stat-label">Team Avg</div>
        <div class="stat-value">${teamBA}</div>
        <div class="stat-description">${totals.hits} H / ${totals.atBats} AB</div>
      </div>
      <div class="stat-card">
        <div class="stat-label">Team OBP</div>
        <div class="stat-value">${teamOBP}</div>
        <div class="stat-description">On-Base %</div>
      </div>
      <div class="stat-card">
        <div class="stat-label">Total Runs</div>
        <div class="stat-value">${totals.runs}</div>
        <div class="stat-description">${runsPerGame} per game</div>
      </div>
      <div class="stat-card">
        <div class="stat-label">Total Hits</div>
        <div class="stat-value">${totals.hits}</div>
        <div class="stat-description">This season</div>
      </div>
      <div class="stat-card">
        <div class="stat-label">Walks</div>
        <div class="stat-value">${totals.walks}</div>
        <div class="stat-description">Total BBs</div>
      </div>
      <div class="stat-card">
        <div class="stat-label">Roster</div>
        <div class="stat-value">${playerData.length}</div>
        <div class="stat-description">Active players</div>
      </div>
    `;
  }

  function updateRoster() {
    const element = document.getElementById("roster-grid");
    
    if (playerData.length === 0) {
      element.innerHTML = '<div class="no-data">No roster data available</div>';
      return;
    }
    
    // Sort roster: captains first, then alphabetically
    const sortedRoster = [...playerData].sort((a, b) => {
      const infoA = playerExtraInfo[a.id] || {};
      const infoB = playerExtraInfo[b.id] || {};
      
      // Captains come first
      if (infoA.captain && !infoB.captain) return -1;
      if (!infoA.captain && infoB.captain) return 1;
      
      // Then sort alphabetically
      return a.name.localeCompare(b.name);
    });
    
    const rosterHTML = sortedRoster.map(player => {
      const info = playerExtraInfo[player.id] || {};
      const atBats = Number(player.atBats) || 0;
      const hits = Number(player.hits) || 0;
      const walks = Number(player.walks) || 0;
      
      const ba = atBats > 0 ? (hits / atBats).toFixed(3) : '.000';
      const obp = (atBats + walks) > 0 ? ((hits + walks) / (atBats + walks)).toFixed(3) : '.000';
      
      const photoHTML = info.photoURL 
        ? `<img class="mini-card-photo" src="${info.photoURL}" alt="${player.name}" onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
           <div class="mini-card-photo-placeholder" style="display:none;">‚öæ</div>`
        : `<div class="mini-card-photo-placeholder">‚öæ</div>`;
      
      const numberHTML = info.number 
        ? `<div class="mini-card-number">${info.number}</div>` 
        : '';
      
      const captainHTML = info.captain 
        ? `<div class="mini-card-captain-star">‚≠ê</div>` 
        : '';
      
      return `
        <div class="player-card-flip" onclick="flipCard(this, event)">
          <div class="player-card-inner">
            <!-- FRONT OF CARD -->
            <div class="player-card-front">
              <div class="mini-card-banner">
                <div class="mini-card-team">${teamName}</div>
                <div class="mini-card-league">Mountainside Aces</div>
              </div>
              
              <div class="mini-card-photo-frame">
                ${photoHTML}
              </div>
              
              <div class="mini-card-player-info">
                ${numberHTML}
                ${captainHTML}
                <div class="mini-card-name">${player.name}</div>
                <div class="mini-card-position">${info.position || '-'}</div>
              </div>
              
              <div class="mini-card-stats-strip">
                <div class="mini-card-stats-row">
                  <div class="mini-card-stat">
                    <div class="mini-card-stat-value">${player.games}</div>
                    <div class="mini-card-stat-label">G</div>
                  </div>
                  <div class="mini-card-stat">
                    <div class="mini-card-stat-value">${ba}</div>
                    <div class="mini-card-stat-label">AVG</div>
                  </div>
                  <div class="mini-card-stat">
                    <div class="mini-card-stat-value">${player.hits}</div>
                    <div class="mini-card-stat-label">H</div>
                  </div>
                  <div class="mini-card-stat">
                    <div class="mini-card-stat-value">${player.runs}</div>
                    <div class="mini-card-stat-label">R</div>
                  </div>
                </div>
              </div>
              
              <div class="mini-card-footer">
                ${currentSeasonData.year} ${capitalize(currentSeasonData.season)} ‚Ä¢ ACES
              </div>
            </div>
            
            <!-- BACK OF CARD -->
            <div class="player-card-back">
              <div class="mini-card-back-header">
                ${info.number ? `<div class="mini-card-back-number">#${info.number}</div>` : ''}
                <div class="mini-card-back-name">${player.name}</div>
                <div class="mini-card-back-team">${teamName}</div>
              </div>
              
              <div class="mini-card-back-vitals">
                <div class="mini-vital-item">
                  <span class="mini-vital-label">POS</span>
                  <span class="mini-vital-value">${info.position || '-'}</span>
                </div>
                <div class="mini-vital-item">
                  <span class="mini-vital-label">BATS</span>
                  <span class="mini-vital-value">${info.bats || '-'}</span>
                </div>
                <div class="mini-vital-item">
                  <span class="mini-vital-label">THR</span>
                  <span class="mini-vital-value">${info.throws || '-'}</span>
                </div>
                ${info.captain ? `
                <div class="mini-vital-item">
                  <span class="mini-vital-label">ROLE</span>
                  <span class="mini-vital-value">‚≠ê CPT</span>
                </div>
                ` : ''}
              </div>
              
              <div class="mini-card-back-stats">
                <div class="mini-card-back-stats-title">CURRENT SEASON STATS</div>
                <table class="mini-stats-table">
                  <thead>
                    <tr>
                      <th>G</th>
                      <th>AB</th>
                      <th>H</th>
                      <th>R</th>
                      <th>BB</th>
                      <th>AVG</th>
                      <th>OBP</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr>
                      <td>${player.games}</td>
                      <td>${player.atBats}</td>
                      <td>${player.hits}</td>
                      <td>${player.runs}</td>
                      <td>${player.walks}</td>
                      <td><strong>${ba}</strong></td>
                      <td><strong>${obp}</strong></td>
                    </tr>
                  </tbody>
                </table>
              </div>
              
              <a href="player.html?id=${encodeURIComponent(player.id)}" class="mini-card-back-link" onclick="event.stopPropagation();">
                View Full Profile ‚Üí
              </a>
              
              <div class="mini-card-back-footer">
                acessoftballreference.com
              </div>
            </div>
          </div>
        </div>
      `;
    }).join('');

    element.innerHTML = rosterHTML;
  }

  function updatePlayerStats() {
    const tbody = document.querySelector("#player-stats-table tbody");
    tbody.classList.remove('loading');
    
    if (playerData.length === 0) {
      tbody.innerHTML = '<tr><td colspan="9" class="no-data">No player statistics available</td></tr>';
      return;
    }

    const sortedPlayers = [...playerData].sort((a, b) => {
      const gamesA = Number(a.games) || 0;
      const gamesB = Number(b.games) || 0;
      if (gamesB !== gamesA) return gamesB - gamesA;
      
      const baA = (Number(a.atBats) || 0) > 0 ? (Number(a.hits) || 0) / (Number(a.atBats) || 0) : 0;
      const baB = (Number(b.atBats) || 0) > 0 ? (Number(b.hits) || 0) / (Number(b.atBats) || 0) : 0;
      return baB - baA;
    });

    const statsHTML = sortedPlayers.map(player => {
      const games = Number(player.games) || 0;
      const atBats = Number(player.atBats) || 0;
      const hits = Number(player.hits) || 0;
      const runs = Number(player.runs) || 0;
      const walks = Number(player.walks) || 0;
      
      const ba = atBats > 0 ? (hits / atBats).toFixed(3) : '.000';
      const obp = (atBats + walks) > 0 ? ((hits + walks) / (atBats + walks)).toFixed(3) : '.000';
      
      const acesBPIValue = player.acesBPI;
      const acesBPI = (acesBPIValue !== "N/A" && acesBPIValue !== null && acesBPIValue !== undefined && !isNaN(acesBPIValue)) 
        ? Number(acesBPIValue).toFixed(2) 
        : "N/A";

      return `
        <tr>
          <td><a href="player.html?id=${encodeURIComponent(player.id)}" class="player-link">${player.name}</a></td>
          <td style="text-align: center;">${games}</td>
          <td style="text-align: center;">${atBats}</td>
          <td style="text-align: center;">${hits}</td>
          <td style="text-align: center;">${runs}</td>
          <td style="text-align: center;">${walks}</td>
          <td style="text-align: center; font-weight: bold;">${ba}</td>
          <td style="text-align: center; font-weight: bold;">${obp}</td>
          <td style="text-align: center;">${acesBPI}</td>
        </tr>
      `;
    }).join('');

    tbody.innerHTML = statsHTML;
  }

  function updateSchedule() {
    const tbody = document.querySelector("#schedule-table tbody");
    tbody.classList.remove('loading');
    
    const teamGames = allGames.filter(g => 
      g["home team"] === teamName || g["away team"] === teamName
    );

    if (teamGames.length === 0) {
      tbody.innerHTML = '<tr><td colspan="6" class="no-data">No games found for current season</td></tr>';
      return;
    }

    const sortedGames = [...teamGames].sort((a, b) => {
      return parseGameDate(a.date) - parseGameDate(b.date);
    });

    const scheduleHTML = sortedGames.map(game => {
      const isHome = game["home team"] === teamName;
      const opponent = isHome ? game["away team"] : game["home team"];
      const homeAwayText = isHome ? "vs" : "@";
      
      const gameDate = parseGameDate(game.date);
      const isPast = gameDate < today;
      const hasResult = game.winner && game.winner.trim() !== "";
      
      let scoreDisplay = "-";
      let result = "-";
      let resultClass = "";
      let rowClass = "";

      if (hasResult && isPast) {
        rowClass = "completed-game";
        const homeScore = game["home score"];
        const awayScore = game["away score"];
        
        if (homeScore === "W" || homeScore === "L") {
          scoreDisplay = isHome ? homeScore : awayScore;
        } else {
          const teamScore = isHome ? homeScore : awayScore;
          const oppScore = isHome ? awayScore : homeScore;
          scoreDisplay = `${teamScore}-${oppScore}`;
        }

        if (game.winner === teamName) {
          result = "W";
          resultClass = "win-result";
        } else if (game.winner === "Tie") {
          result = "T";
          resultClass = "tie-result";
        } else {
          result = "L";
          resultClass = "loss-result";
        }
      } else if (!isPast) {
        rowClass = "upcoming-game";
      }

      return `
        <tr class="${rowClass}">
          <td>${game.date}</td>
          <td>${opponent}</td>
          <td style="text-align: center;">${homeAwayText}</td>
          <td style="text-align: center;">${scoreDisplay}</td>
          <td style="text-align: center;" class="${resultClass}">${result}</td>
          <td style="text-align: center;">${game.game_type}</td>
        </tr>
      `;
    }).join('');

    tbody.innerHTML = scheduleHTML;
  }
</script>
<script type="module">
  import { NavigationComponent } from './nav-component.js';
</script>
<script src="team-colors.js"></script>
<script src="mobile-enhancements.js"></script>
<script src="theme-toggle.js"></script>
</body>
</html>

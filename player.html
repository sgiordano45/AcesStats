<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Player Stats</title>
<link rel="stylesheet" href="style.css">
<style>
  table { border-collapse: collapse; width: 100%; margin-bottom: 20px; }
  th, td { border: 1px solid #ccc; padding: 8px; text-align: center; }
  th { background-color: #f2f2f2; }
  .back-button { 
    margin: 20px 0; 
    padding: 10px 20px; 
    background-color: #f0f0f0; 
    border: 1px solid #ccc; 
    cursor: pointer; 
  }
  .back-button:hover { background-color: #e0e0e0; }
  
  /* Player Info Section */
  .player-header {
    background-color: #f8f9fa;
    border: 1px solid #dee2e6;
    border-radius: 8px;
    padding: 20px;
    margin-bottom: 30px;
    display: flex;
    align-items: center;
    gap: 20px;
  }
  
  .player-photo {
    width: 100px;
    height: 100px;
    border-radius: 50%;
    object-fit: cover;
    border: 3px solid #0066cc;
    display: none; /* Hidden until we have photos */
  }
  
  .player-info {
    flex: 1;
  }
  
  .player-name-section {
    display: flex;
    align-items: center;
    gap: 15px;
    margin-bottom: 15px;
  }
  
  .player-number {
    background-color: #0066cc;
    color: white;
    width: 50px;
    height: 50px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.4em;
    font-weight: bold;
  }
  
  .player-name-text h1 {
    margin: 0;
    color: #333;
  }
  
  .player-nickname {
    font-style: italic;
    color: #666;
    margin-top: 5px;
  }
  
  .player-details {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
    gap: 15px;
  }
  
  .detail-item {
    background-color: white;
    padding: 10px;
    border-radius: 5px;
    border: 1px solid #e9ecef;
    text-align: center;
  }
  
  .detail-label {
    font-size: 0.9em;
    color: #6c757d;
    margin-bottom: 5px;
    font-weight: bold;
  }
  
  .detail-value {
    font-size: 1.1em;
    color: #495057;
    font-weight: bold;
  }
  
  .bats-throws {
    display: flex;
    gap: 10px;
    justify-content: center;
  }
  
  .bt-item {
    padding: 5px 10px;
    background-color: #e9ecef;
    border-radius: 15px;
    font-size: 0.9em;
    font-weight: bold;
  }
  
  .captain-badge {
    background: linear-gradient(135deg, #ffd700 0%, #ffed4e 100%);
    color: #333;
    padding: 5px 12px;
    border-radius: 20px;
    font-size: 0.9em;
    font-weight: bold;
    display: inline-flex;
    align-items: center;
    gap: 5px;
    border: 1px solid #e6c200;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
  }
  
  .captain-badge::before {
    content: "‚≠ê";
    font-size: 1em;
  }
  
  .player-name-section .captain-badge {
    margin-left: 10px;
  }
  
  /* Awards Section */
  .awards-section {
    background-color: white;
    border: 1px solid #e9ecef;
    border-radius: 8px;
    padding: 20px;
    margin-bottom: 30px;
  }
  
  .awards-section h2 {
    margin: 0 0 15px 0;
    color: #333;
    font-size: 1.3em;
    display: flex;
    align-items: center;
    gap: 10px;
  }
  
  .awards-section h2::before {
    content: "üèÖ";
    font-size: 1.2em;
  }
  
  .awards-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 15px;
  }
  
  .award-item {
    background-color: #f8f9fa;
    padding: 12px 15px;
    border-radius: 8px;
    border-left: 4px solid #0066cc;
    display: flex;
    align-items: center;
    gap: 10px;
  }
  
  .award-icon {
    width: 24px;
    height: 24px;
    flex-shrink: 0;
    object-fit: contain;
  }
  
  .award-icon.fallback {
    font-size: 1.3em;
    width: auto;
    height: auto;
  }
  
  .award-details {
    flex: 1;
  }
  
  .award-name {
    font-weight: bold;
    color: #333;
    margin-bottom: 2px;
  }
  
  .award-season {
    font-size: 0.9em;
    color: #666;
  }
  
  .award-count {
    background-color: #0066cc;
    color: white;
    border-radius: 12px;
    padding: 2px 8px;
    font-size: 0.8em;
    font-weight: bold;
    margin-left: auto;
    flex-shrink: 0;
  }
  
  .no-awards {
    text-align: center;
    color: #666;
    font-style: italic;
    padding: 20px;
  }
  
  /* Mobile responsive */
  @media (max-width: 768px) {
    .player-header {
      flex-direction: column;
      text-align: center;
    }
    
    .player-name-section {
      flex-direction: column;
      gap: 10px;
    }
    
    .player-details {
      grid-template-columns: 1fr;
    }
  }
  
  /* Show photo when available */
  .player-photo.loaded {
    display: block;
  }
</style>
</head>
<body>

<div class="player-header" id="playerHeader">
  <img id="playerPhoto" class="player-photo" alt="Player Photo" onerror="this.style.display='none';">
  
  <div class="player-info">
    <div class="player-name-section">
      <div id="playerNumber" class="player-number" style="display: none;">#</div>
      <div class="player-name-text">
        <h1 id="playerName">Player Name</h1>
        <div id="playerNickname" class="player-nickname" style="display: none;"></div>
      </div>
    </div>
    
    <div class="player-details" id="playerDetails">
      <!-- Player details will be populated dynamically -->
    </div>
  </div>
</div>

<div class="awards-section" id="awardsSection" style="display: none;">
  <h2>Awards & Recognition</h2>
  <div class="awards-grid" id="awardsGrid">
    <!-- Awards will be populated dynamically -->
  </div>
</div>

<h2>Regular Season Stats</h2>
<table id="regularStatsTable">
  <thead>
    <tr>
      <th>Year</th>
      <th>Season</th>
      <th>Team</th>
      <th>Games</th>
      <th>At Bats</th>
      <th>Hits</th>
      <th>Runs</th>
      <th>Walks</th>
      <th>AcesBPI</th>
      <th>BA</th>
      <th>OBP</th>
      <th>Sub</th>
    </tr>
  </thead>
  <tbody></tbody>
</table>

<h2>Substitute Season Stats</h2>
<table id="subStatsTable">
  <thead>
    <tr>
      <th>Year</th>
      <th>Season</th>
      <th>Team</th>
      <th>Games</th>
      <th>At Bats</th>
      <th>Hits</th>
      <th>Runs</th>
      <th>Walks</th>
      <th>AcesBPI</th>
      <th>BA</th>
      <th>OBP</th>
      <th>Sub</th>
    </tr>
  </thead>
  <tbody></tbody>
</table>

<h2>Career Stats</h2>
<table id="careerStatsTable">
  <thead>
    <tr>
      <th>Category</th>
      <th>Games</th>
      <th>At Bats</th>
      <th>Hits</th>
      <th>Runs</th>
      <th>Walks</th>
      <th>Avg AcesBPI</th>
      <th>BA</th>
      <th>OBP</th>
    </tr>
  </thead>
  <tbody></tbody>
</table>

<button class="back-button" onclick="goBack()">‚Üê Back to Main</button>
<script>
let playerName = new URLSearchParams(window.location.search).get('name');
let playerInfo = null;

if (!playerName) {
  document.body.innerHTML = '<h1>Error: No player specified</h1><p><a href="index.html">Return to main page</a></p>';
} else {
  document.getElementById("playerName").textContent = playerName;
  loadPlayerData();
}

async function loadPlayerData() {
  try {
    // Load batting stats
    const response = await fetch('data.json');
    if (!response.ok) throw new Error('Failed to load data.json');
    
    const allPlayers = await response.json();

    // Try to load player info if available
    try {
      const playerInfoResponse = await fetch('player_info.json');
      if (playerInfoResponse.ok) {
        const allPlayerInfo = await playerInfoResponse.json();
        playerInfo = allPlayerInfo.find(p => p.name && p.name.trim() === playerName);
        if (playerInfo) {
          populatePlayerInfo(playerInfo);
        }
      }
    } catch (error) {
      console.log('Player info not available yet');
    }

    // Try to load awards data
    try {
      const awardsResponse = await fetch('awards.json');
      if (awardsResponse.ok) {
        const allAwards = await awardsResponse.json();
        const playerAwards = allAwards.filter(award => 
          award.Player && award.Player.trim() === playerName
        );
        if (playerAwards.length > 0) {
          populatePlayerAwards(playerAwards);
        }
      }
    } catch (error) {
      console.log('Awards data not available');
    }

    // Filter and clean data for this player
    const playerData = allPlayers
      .filter(p => p.name && p.name.trim() === playerName)
      .map(p => ({
        ...p,
        name: p.name.trim(),
        team: p.team.trim(),
        year: p.year,
        season: p.season.trim(),
        games: Number(p.games) || 0,
        atBats: Number(p.atBats) || 0,
        hits: Number(p.hits) || 0,
        runs: Number(p.runs) || 0,
        walks: Number(p.walks) || 0,
        AcesWar: p.AcesWar === "N/A" || !p.AcesWar ? "N/A" : Number(p.AcesWar),
        Sub: p.Sub || p.sub || ""
      }));

    if (playerData.length === 0) {
      document.body.innerHTML = `
        <h1>Player "${playerName}" not found</h1>
        <p><a href="index.html">Return to main page</a></p>
      `;
      return;
    }

    // Separate regular and substitute seasons
    const regularSeasons = playerData.filter(p => {
      const subStatus = String(p.Sub || "").toLowerCase().trim();
      return subStatus !== "yes";
    });

    const subSeasons = playerData.filter(p => {
      const subStatus = String(p.Sub || "").toLowerCase().trim();
      return subStatus === "yes";
    });

    // Sort by year (most recent first), then by season
const sortedRegular = regularSeasons.sort((a, b) => {
  if (b.year !== a.year) return b.year - a.year;
  const seasonOrder = { 'Fall': 1, 'Summer': 2 };
  const orderA = seasonOrder[a.season] || 999;
  const orderB = seasonOrder[b.season] || 999;
  return orderA - orderB;
});

const sortedSub = subSeasons.sort((a, b) => {
  if (b.year !== a.year) return b.year - a.year;
  const seasonOrder = { 'Fall': 1, 'Summer': 2 };
  const orderA = seasonOrder[a.season] || 999;
  const orderB = seasonOrder[b.season] || 999;
  return orderA - orderB;
});

    // Render tables
    renderSeasonTable(sortedRegular, 'regularStatsTable');
    renderSeasonTable(sortedSub, 'subStatsTable');
    renderCareerStats(playerData);

    // Update player details if no player info was loaded
    if (!playerInfo) {
      populateBasicPlayerDetails(playerData);
    }

  } catch (err) {
    console.error("Error loading player data:", err);
    document.body.innerHTML = `
      <h1>Error loading player data</h1>
      <p>Could not load player statistics. Please check that data.json is available.</p>
      <p><a href="index.html">Return to main page</a></p>
    `;
  }
}

function populatePlayerInfo(info) {
  // Set player number
  if (info.number) {
    const numberElement = document.getElementById('playerNumber');
    numberElement.textContent = `#${info.number}`;
    numberElement.style.display = 'flex';
  }

  // Set nickname
  if (info.nickname) {
    const nicknameElement = document.getElementById('playerNickname');
    nicknameElement.textContent = `"${info.nickname}"`;
    nicknameElement.style.display = 'block';
  }

  // Set captain badge
  if (info.captain === true || info.captain === "true" || info.captain === "yes") {
    const nameSection = document.querySelector('.player-name-section');
    const captainBadge = document.createElement('div');
    captainBadge.className = 'captain-badge';
    captainBadge.textContent = 'Captain';
    nameSection.appendChild(captainBadge);
  }

  // Set player photo
  if (info.photo) {
    const photoElement = document.getElementById('playerPhoto');
    photoElement.src = info.photo;
    photoElement.classList.add('loaded');
  }

  // Create player details
  const detailsContainer = document.getElementById('playerDetails');
  detailsContainer.innerHTML = '';

  // Bats/Throws
  if (info.bats || info.throws) {
    // Convert single letters to full words
    const batsDisplay = convertHandedness(info.bats);
    const throwsDisplay = convertHandedness(info.throws);
    
    // Create combined display
    let combinedDisplay = '';
    if (info.bats && info.throws) {
      combinedDisplay = `${batsDisplay}/${throwsDisplay}`;
    } else if (info.bats) {
      combinedDisplay = `Bats: ${batsDisplay}`;
    } else if (info.throws) {
      combinedDisplay = `Throws: ${throwsDisplay}`;
    }
    
    const batsThrowsHTML = `
      <div class="detail-item">
        <div class="detail-label">Bats/Throws</div>
        <div class="detail-value">${combinedDisplay}</div>
      </div>
    `;
    detailsContainer.innerHTML += batsThrowsHTML;
  }

  // Position (if available)
  if (info.position) {
    detailsContainer.innerHTML += `
      <div class="detail-item">
        <div class="detail-label">Position</div>
        <div class="detail-value">${info.position}</div>
      </div>
    `;
  }

  // Height/Weight (if available)
  if (info.height || info.weight) {
    const physicalInfo = [];
    if (info.height) physicalInfo.push(info.height);
    if (info.weight) physicalInfo.push(info.weight);
    
    detailsContainer.innerHTML += `
      <div class="detail-item">
        <div class="detail-label">Physical</div>
        <div class="detail-value">${physicalInfo.join(' / ')}</div>
      </div>
    `;
  }
}

function populateBasicPlayerDetails(playerData) {
  // If no player info file, show basic details from stats
  const detailsContainer = document.getElementById('playerDetails');
  
  const uniqueTeams = [...new Set(playerData.map(p => p.team))];
  const years = [...new Set(playerData.map(p => p.year))].sort((a, b) => a - b);
  const totalSeasons = new Set(playerData.map(p => `${p.year}-${p.season}`)).size;

  detailsContainer.innerHTML = `
    <div class="detail-item">
      <div class="detail-label">Teams</div>
      <div class="detail-value">${uniqueTeams.join(', ')}</div>
    </div>
    <div class="detail-item">
      <div class="detail-label">Years Active</div>
      <div class="detail-value">${years[0]} - ${years[years.length - 1]}</div>
    </div>
    <div class="detail-item">
      <div class="detail-label">Total Seasons</div>
      <div class="detail-value">${totalSeasons}</div>
    </div>
  `;
}

function populatePlayerAwards(awards) {
  const awardsSection = document.getElementById('awardsSection');
  const awardsGrid = document.getElementById('awardsGrid');
  
  if (awards.length === 0) {
    return; // Keep section hidden if no awards
  }
  
  // Group awards by type and count them
  const awardGroups = {};
  awards.forEach(award => {
    const awardType = award.Award.trim();
    if (!awardGroups[awardType]) {
      awardGroups[awardType] = {
        name: awardType,
        count: 0,
        seasons: []
      };
    }
    awardGroups[awardType].count++;
    awardGroups[awardType].seasons.push(`${award.Year} ${award.Season}`);
  });
  
  // Define award icons mapping to PNG files
  const awardIcons = {
    'Team MVP': 'team_mvp.png',
    'All Aces': 'all_aces.png',
    'Gold Glove': 'gold_glove.png',
    'Team of the Year': 'team_of_the_year.png',
    'Rookie of the Year': 'rookie_of_the_year.png',
    'Most Improved Ace': 'most_improved_ace.png',
    'Comeback Player of the Year': 'comeback_player.png',
    'Slugger of the Year': 'slugger_of_the_year.png',
    'Pitcher of the Year': 'pitcher_of_the_year.png',
    'Captain of the Year': 'captain_of_the_year.png',
    'Al Pineda Good Guy Award': 'al_pineda_good_guy_award.png',
    'Iron Man Award': 'iron_man_award.png',
    'Sub of the Year': 'sub_of_the_year.png',
    'Andrew Streaman Boner Award': 'andrew_streaman_boner_award.png',
    'Erik Lund Perservenance Award': 'erik_lund_perservenance_award.png',
    'Mr. Streaman Award for Excellence': 'mr_streaman_award_for_excellence.png'
  };
  
  // Fallback emoji for awards without PNG files
  const fallbackEmojis = {
    'Team MVP': 'üëë',
    'All Aces': '‚≠ê',
    'Gold Glove': 'ü•á',
    'Team of the Year': 'üèÜ',
    'Rookie of the Year': 'üåü',
    'Most Improved Ace': 'üìà',
    'Comeback Player of the Year': 'üîÑ',
    'Slugger of the Year': 'üí™',
    'Pitcher of the Year': 'ü•é',
    'Captain of the Year': 'üéñÔ∏è',
    'Al Pineda Good Guy Award': 'ü§ù',
    'Iron Man Award': 'üíØ',
    'Sub of the Year': 'üèÖ',
    'Andrew Streaman Boner Award': 'üé™',
    'Erik Lund Perservenance Award': '‚ö°',
    'Mr. Streaman Award for Excellence': 'üåü'
  };
  
  // Sort awards by importance/rarity
  const awardOrder = [
    'Team MVP', 'All Aces', 'Gold Glove', 'Team of the Year',
    'Rookie of the Year', 'Most Improved Ace', 'Comeback Player of the Year',
    'Slugger of the Year', 'Pitcher of the Year', 'Captain of the Year',
    'Al Pineda Good Guy Award', 'Iron Man Award', 'Sub of the Year',
    'Andrew Streaman Boner Award', 'Erik Lund Perservenance Award',
    'Mr. Streaman Award for Excellence'
  ];
  
  // Sort award groups by order, then alphabetically
  const sortedAwards = Object.values(awardGroups).sort((a, b) => {
    const aIndex = awardOrder.indexOf(a.name);
    const bIndex = awardOrder.indexOf(b.name);
    
    if (aIndex !== -1 && bIndex !== -1) return aIndex - bIndex;
    if (aIndex !== -1) return -1;
    if (bIndex !== -1) return 1;
    return a.name.localeCompare(b.name);
  });
  
  // Generate award items
  awardsGrid.innerHTML = '';
  sortedAwards.forEach(award => {
    const iconFileName = awardIcons[award.name];
    const fallbackEmoji = fallbackEmojis[award.name] || 'üèÖ';
    const seasonsText = award.seasons.length <= 3 ? 
      award.seasons.join(', ') : 
      `${award.seasons.slice(0, 2).join(', ')}, +${award.seasons.length - 2} more`;
    
    const awardHTML = `
      <div class="award-item">
        <div class="award-icon-container">
          ${iconFileName ? 
            `<img src="awards/${iconFileName}" alt="${award.name}" class="award-icon" style="display: block;" onerror="this.style.display='none'; this.nextElementSibling.style.display='inline';">
             <span class="award-icon fallback" style="display: none;">${fallbackEmoji}</span>` :
            `<span class="award-icon fallback">${fallbackEmoji}</span>`
          }
        </div>
        <div class="award-details">
          <div class="award-name">${award.name}</div>
          <div class="award-season">${seasonsText}</div>
        </div>
        ${award.count > 1 ? `<span class="award-count">${award.count}√ó</span>` : ''}
      </div>
    `;
    
    awardsGrid.innerHTML += awardHTML;
  });
  
  // Show the awards section
  awardsSection.style.display = 'block';
}

function renderSeasonTable(data, tableId) {
  const tbody = document.querySelector(`#${tableId} tbody`);
  tbody.innerHTML = "";
  
  if (data.length === 0) {
    tbody.innerHTML = '<tr><td colspan="12">No data available</td></tr>';
    return;
  }

  data.forEach(p => {
    const BA = p.atBats > 0 ? (p.hits / p.atBats).toFixed(3) : ".000";
    const OBP = (p.atBats + p.walks) > 0
      ? ((p.hits + p.walks) / (p.atBats + p.walks)).toFixed(3)
      : ".000";
    const AcesWar = p.AcesWar !== "N/A" && !isNaN(p.AcesWar)
      ? Number(p.AcesWar).toFixed(2)
      : "N/A";
    const subStatus = String(p.Sub || "").toLowerCase().trim() === "yes" ? "Yes" : "No";

    const row = `<tr>
      <td>${p.year}</td>
      <td>${p.season}</td>
      <td><a href="team.html?team=${encodeURIComponent(p.team)}">${p.team}</a></td>
      <td>${p.games}</td>
      <td>${p.atBats}</td>
      <td>${p.hits}</td>
      <td>${p.runs}</td>
      <td>${p.walks}</td>
      <td>${AcesWar}</td>
      <td>${BA}</td>
      <td>${OBP}</td>
      <td>${subStatus}</td>
    </tr>`;
    tbody.innerHTML += row;
  });
}

function renderCareerStats(data) {
  const tbody = document.querySelector('#careerStatsTable tbody');
  tbody.innerHTML = "";

  if (data.length === 0) {
    tbody.innerHTML = '<tr><td colspan="8">No data available</td></tr>';
    return;
  }

  // Separate regular and substitute seasons for career calculations
  const regularSeasons = data.filter(p => {
    const subStatus = String(p.Sub || "").toLowerCase().trim();
    return subStatus !== "yes";
  });

  const subSeasons = data.filter(p => {
    const subStatus = String(p.Sub || "").toLowerCase().trim();
    return subStatus === "yes";
  });

  // Calculate career totals for different categories
  function calculateTotals(seasonData, label) {
    const totals = {
      games: seasonData.reduce((sum, p) => sum + p.games, 0),
      atBats: seasonData.reduce((sum, p) => sum + p.atBats, 0),
      hits: seasonData.reduce((sum, p) => sum + p.hits, 0),
      runs: seasonData.reduce((sum, p) => sum + p.runs, 0),
      walks: seasonData.reduce((sum, p) => sum + p.walks, 0)
    };

    const validAcesWar = seasonData.filter(p => p.AcesWar !== "N/A" && !isNaN(p.AcesWar));
    const avgAcesWar = validAcesWar.length > 0
      ? (validAcesWar.reduce((sum, p) => sum + Number(p.AcesWar), 0) / validAcesWar.length).toFixed(2)
      : "N/A";

    const BA = totals.atBats > 0 ? (totals.hits / totals.atBats).toFixed(3) : ".000";
    const OBP = (totals.atBats + totals.walks) > 0
      ? ((totals.hits + totals.walks) / (totals.atBats + totals.walks)).toFixed(3)
      : ".000";

    return `<tr>
      <td><strong>${label}</strong></td>
      <td>${totals.games}</td>
      <td>${totals.atBats}</td>
      <td>${totals.hits}</td>
      <td>${totals.runs}</td>
      <td>${totals.walks}</td>
      <td>${avgAcesWar}</td>
      <td>${BA}</td>
      <td>${OBP}</td>
    </tr>`;
  }

  // Add career totals
  tbody.innerHTML = calculateTotals(data, "Career Total");
  
  if (regularSeasons.length > 0) {
    tbody.innerHTML += calculateTotals(regularSeasons, "Regular Seasons");
  }
  
  if (subSeasons.length > 0) {
    tbody.innerHTML += calculateTotals(subSeasons, "Substitute Seasons");
  }
}

function goBack() {
  if (window.history.length > 1) {
    window.history.back();
  } else {
    window.location.href = 'index.html';
  }
}

function convertHandedness(code) {
  if (!code) return '';
  
  const upperCode = code.toString().toUpperCase();
  
  switch (upperCode) {
    case 'R':
      return 'Right';
    case 'L':
      return 'Left';
    case 'S':
      return 'Switch';
    case 'B':
      return 'Both'; // Alternative for switch hitting
    default:
      return code; // Return original if not recognized
  }
}
</script>
</body>
</html>

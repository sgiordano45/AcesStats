<!DOCTYPE html>
<html lang="en">
<head>
<link rel="manifest" href="/manifest.json">
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="theme-color" content="#2d5016">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="apple-mobile-web-app-title" content="Mountainside Aces">
<title>Mountainside Aces - Softball Statistics Hub</title>
<link rel="stylesheet" href="mobile-enhancements.css">
<link rel="stylesheet" href="nav-styles.css">
<link rel="stylesheet" href="style.css">

<style>
  :root {
    --primary-color: #2d5016;
    --secondary-color: #1a6b4a;
    --accent-color: #ffd700;
    --card-bg: #ffffff;
    --text-dark: #2d3748;
    --text-light: #718096;
    --border-color: #e2e8f0;
    --shadow-sm: 0 2px 8px rgba(0,0,0,0.08);
    --shadow-md: 0 4px 16px rgba(0,0,0,0.12);
    --shadow-lg: 0 12px 32px rgba(0,0,0,0.16);
  }

  * {
    box-sizing: border-box;
  }

  body {
    font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
    margin: 0;
    padding: 0;
    background: linear-gradient(135deg, #f7fafc 0%, #edf2f7 100%);
    min-height: 100vh;
    color: var(--text-dark);
  }
  
  /* Softball-themed loading spinner */
  .loading-overlay {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(255,255,255,0.95);
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 9999;
    opacity: 1;
    transition: opacity 0.5s ease;
  }

  .loading-overlay.hidden {
    opacity: 0;
    pointer-events: none;
  }

  .softball-spinner {
    width: 80px;
    height: 80px;
    position: relative;
    animation: spin 1.5s ease-in-out infinite;
  }

  .softball-spinner::before {
    content: '‚öæ';
    font-size: 80px;
    position: absolute;
    top: 0;
    left: 0;
  }

  @keyframes spin {
    0%, 100% { transform: rotate(0deg) scale(1); }
    50% { transform: rotate(180deg) scale(1.1); }
  }

  /* Top Navigation Bar */
  .top-nav-bar {
    background: white;
    box-shadow: var(--shadow-sm);
    position: sticky;
    top: 0;
    z-index: 1000;
    border-bottom: 1px solid var(--border-color);
  }

  .top-nav-content {
    max-width: 1400px;
    margin: 0 auto;
    padding: 1rem 2rem;
    display: flex;
    justify-content: space-between;
    align-items: center;
  }

  .nav-logo {
    font-size: 1.2rem;
    font-weight: 700;
    color: var(--primary-color);
    display: flex;
    align-items: center;
    gap: 0.5rem;
  }

  .auth-section {
    display: flex;
    gap: 1rem;
    align-items: center;
  }

  .auth-button {
    padding: 0.6rem 1.5rem;
    border: 2px solid var(--primary-color);
    background: white;
    color: var(--primary-color);
    text-decoration: none;
    border-radius: 8px;
    font-weight: 600;
    font-size: 0.9rem;
    transition: all 0.3s ease;
    cursor: pointer;
    display: flex;
    align-items: center;
    gap: 0.5rem;
  }

  .auth-button:hover {
    background: var(--primary-color);
    color: white;
    transform: translateY(-2px);
    box-shadow: var(--shadow-md);
  }

  .auth-button.primary {
    background: var(--primary-color);
    color: white;
  }

  .auth-button.primary:hover {
    background: var(--secondary-color);
  }

  .user-profile-nav {
    display: flex;
    align-items: center;
    gap: 1rem;
  }

  .user-avatar {
    width: 36px;
    height: 36px;
    border-radius: 50%;
    object-fit: cover;
    border: 2px solid var(--primary-color);
  }

  .user-name {
    font-weight: 600;
    color: var(--text-dark);
  }

  /* Header with softball pattern */
  .header {
    background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
    color: white;
    text-align: center;
    padding: 4rem 2rem;
    box-shadow: var(--shadow-lg);
    position: relative;
    overflow: hidden;
  }

  .header::before {
    content: '';
    position: absolute;
    top: -50%;
    right: -10%;
    width: 400px;
    height: 400px;
    background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%);
    border-radius: 50%;
  }

  .header::after {
    content: '‚öæ';
    position: absolute;
    bottom: -30px;
    left: 10%;
    font-size: 120px;
    opacity: 0.15;
    transform: rotate(-15deg);
  }
  
  .header h1 {
    margin: 0;
    font-size: 3.5rem;
    font-weight: 800;
    text-shadow: 2px 4px 8px rgba(0,0,0,0.2);
    letter-spacing: -0.5px;
    position: relative;
    z-index: 1;
  }
  
  .header p {
    margin: 1rem 0 0 0;
    font-size: 1.3rem;
    opacity: 0.95;
    font-weight: 300;
    position: relative;
    z-index: 1;
  }

  /* This Week Module */
  .this-week-module {
    background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
    color: white;
    padding: 1.5rem 2rem;
    position: relative;
    overflow: hidden;
  }

  .this-week-module::before {
    content: 'üìÖ';
    position: absolute;
    right: 20px;
    top: 50%;
    transform: translateY(-50%);
    font-size: 80px;
    opacity: 0.1;
  }

  .this-week-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 1rem;
    position: relative;
    z-index: 1;
  }

  .this-week-title {
    font-size: 1.25rem;
    font-weight: 700;
    display: flex;
    align-items: center;
    gap: 0.5rem;
  }

  .this-week-link {
    color: var(--accent-color);
    text-decoration: none;
    font-weight: 600;
    font-size: 0.9rem;
    display: flex;
    align-items: center;
    gap: 0.25rem;
    transition: opacity 0.2s;
  }

  .this-week-link:hover {
    opacity: 0.8;
  }

  .this-week-games {
    display: flex;
    gap: 1rem;
    overflow-x: auto;
    padding-bottom: 0.5rem;
    position: relative;
    z-index: 1;
    scrollbar-width: thin;
    scrollbar-color: rgba(255,255,255,0.3) transparent;
  }

  .this-week-games::-webkit-scrollbar {
    height: 6px;
  }

  .this-week-games::-webkit-scrollbar-track {
    background: rgba(255,255,255,0.1);
    border-radius: 3px;
  }

  .this-week-games::-webkit-scrollbar-thumb {
    background: rgba(255,255,255,0.3);
    border-radius: 3px;
  }

  .week-game-card {
    background: rgba(255,255,255,0.15);
    backdrop-filter: blur(10px);
    border-radius: 12px;
    padding: 1rem 1.25rem;
    min-width: 200px;
    flex-shrink: 0;
    transition: all 0.2s ease;
    cursor: pointer;
    text-decoration: none;
    color: white;
    border: 1px solid rgba(255,255,255,0.2);
  }

  .week-game-card:hover {
    background: rgba(255,255,255,0.25);
    transform: translateY(-2px);
  }

  .week-game-date {
    font-size: 0.75rem;
    opacity: 0.8;
    margin-bottom: 0.5rem;
    font-weight: 500;
  }

  .week-game-matchup {
    font-weight: 700;
    font-size: 1rem;
    margin-bottom: 0.25rem;
  }

  .week-game-time {
    font-size: 0.85rem;
    opacity: 0.9;
  }

  .week-game-record {
    font-size: 0.75rem;
    opacity: 0.7;
    margin-top: 0.5rem;
  }

  .this-week-empty {
    text-align: center;
    padding: 1rem;
    opacity: 0.8;
    font-style: italic;
  }

  @media (max-width: 768px) {
    .this-week-module {
      padding: 1rem;
    }
    
    .this-week-header {
      flex-direction: column;
      align-items: flex-start;
      gap: 0.5rem;
    }
    
    .week-game-card {
      min-width: 160px;
      padding: 0.75rem 1rem;
    }
  }

  /* Scrolling News Banner */
  .news-banner {
    background: linear-gradient(135deg, #ff6b6b 0%, #ee5a24 100%);
    color: white;
    overflow: hidden;
    white-space: nowrap;
    position: relative;
    box-shadow: 0 4px 12px rgba(238,90,36,0.3);
    border-bottom: 3px solid #c23616;
  }

  .news-content {
    display: inline-block;
    padding: 14px 0;
    animation: scroll-left 60s linear infinite;
    font-weight: 600;
    font-size: 1.1rem;
  }

  .news-item {
    display: inline-block;
    margin-right: 50px;
    padding: 0 20px;
    position: relative;
  }

  .news-item::after {
    content: "‚öæ";
    position: absolute;
    right: -25px;
    top: 0;
    font-size: 1rem;
  }

  .news-announcement {
    color: #ffd700;
    font-weight: bold;
  }

  .news-score {
    color: #ffffff;
  }

  .news-winner {
    color: #00ff88;
    font-weight: bold;
  }

  .news-upcoming {
    color: #87ceeb;
    font-weight: 600;
  }

  @keyframes scroll-left {
    0% { transform: translateX(25%); }
    100% { transform: translateX(-100%); }
  }

  .news-banner:hover .news-content {
    animation-play-state: paused;
  }
  
  .dashboard-container {
    max-width: 1400px;
    margin: 3rem auto;
    padding: 0 2rem;
  }
  
  .section {
    margin-bottom: 4rem;
  }
  
  /* Modern section titles */
  .section-title {
    font-size: 2rem;
    font-weight: 700;
    color: var(--text-dark);
    margin-bottom: 2rem;
    display: flex;
    align-items: center;
    gap: 1rem;
    position: relative;
  }
  
  .section-title::before {
    content: "";
    display: inline-block;
    width: 8px;
    height: 36px;
    background: linear-gradient(180deg, var(--primary-color) 0%, var(--secondary-color) 100%);
    border-radius: 4px;
  }

  .section-title::after {
    content: '';
    flex: 1;
    height: 2px;
    background: linear-gradient(90deg, var(--border-color) 0%, transparent 100%);
    margin-left: 1rem;
  }

  /* Milestone Watch Styles */
  .milestone-watch-container {
    background: white;
    border-radius: 12px;
    padding: 2rem;
    box-shadow: var(--shadow-sm);
    border: 1px solid var(--border-color);
  }

  .milestone-loading {
    text-align: center;
    color: var(--text-light);
    padding: 2rem;
    font-size: 1rem;
  }

  .milestone-section {
    margin-bottom: 2rem;
  }

  .milestone-section:last-child {
    margin-bottom: 0;
  }

  .milestone-section-header {
    font-size: 1.3rem;
    font-weight: 700;
    color: var(--text-dark);
    margin-bottom: 1rem;
    display: flex;
    align-items: center;
    gap: 0.75rem;
    padding-bottom: 0.75rem;
    border-bottom: 2px solid var(--border-color);
  }

  .milestone-list {
    list-style: none;
    padding: 0;
    margin: 0;
  }

  .milestone-item {
    padding: 0.875rem 0;
    border-bottom: 1px solid var(--border-color);
    display: flex;
    align-items: center;
    transition: background 0.2s ease;
  }

  .milestone-item:last-child {
    border-bottom: none;
  }

  .milestone-item:hover {
    background: #f7fafc;
    padding-left: 0.5rem;
    margin-left: -0.5rem;
    padding-right: 0.5rem;
    margin-right: -0.5rem;
    border-radius: 6px;
  }

  .milestone-player-name {
    color: var(--primary-color);
    font-weight: 600;
    text-decoration: none;
    transition: color 0.2s ease;
  }

  .milestone-player-name:hover {
    color: var(--secondary-color);
    text-decoration: underline;
  }

  .milestone-team {
    color: var(--text-light);
    font-size: 0.9rem;
    margin-left: 0.5rem;
  }

  .milestone-stat {
    color: var(--text-dark);
    margin-left: 0.5rem;
  }

  .milestone-gap {
    color: #d97706;
    font-weight: 700;
  }

  .milestone-target {
    color: var(--text-light);
  }

  .milestone-empty {
    text-align: center;
    color: var(--text-light);
    padding: 2rem;
    font-size: 1rem;
    font-style: italic;
  }
  
  /* Modern card grid with better spacing */
  .cards-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
    gap: 2rem;
    margin-top: 2rem;
  }
  
  /* Enhanced modern cards */
  .card {
    background: var(--card-bg);
    border-radius: 16px;
    padding: 2rem;
    box-shadow: var(--shadow-sm);
    transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    border: 1px solid var(--border-color);
    position: relative;
    overflow: hidden;
    cursor: pointer;
  }

  /* Gradient accent bar */
  .card::before {
    content: "";
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 5px;
    background: linear-gradient(90deg, var(--primary-color) 0%, var(--secondary-color) 100%);
    opacity: 0;
    transition: opacity 0.4s ease;
  }

  .card:hover::before {
    opacity: 1;
  }

  /* Subtle background pattern on hover */
  .card::after {
    content: '‚öæ';
    position: absolute;
    bottom: -20px;
    right: -20px;
    font-size: 120px;
    opacity: 0;
    transition: all 0.4s ease;
    color: var(--primary-color);
  }
  
  .card:hover {
    transform: translateY(-8px);
    box-shadow: var(--shadow-lg);
    border-color: var(--primary-color);
  }

  .card:hover::after {
    opacity: 0.05;
    bottom: -10px;
    right: -10px;
  }
  
  .card-link {
    text-decoration: none;
    color: inherit;
    display: block;
  }
  
  .card-icon {
    font-size: 3rem;
    margin-bottom: 1.25rem;
    display: inline-block;
    transition: transform 0.4s ease;
  }

  .card:hover .card-icon {
    transform: scale(1.15) rotate(5deg);
  }
  
  .card-title {
    font-size: 1.5rem;
    font-weight: 700;
    color: var(--text-dark);
    margin-bottom: 0.75rem;
    letter-spacing: -0.3px;
  }
  
  .card-description {
    color: var(--text-light);
    font-size: 1rem;
    line-height: 1.7;
    margin-bottom: 1.5rem;
  }
  
  .card-stats {
    padding-top: 1rem;
    border-top: 1px solid var(--border-color);
    color: var(--text-light);
    font-size: 0.9rem;
  }

  .card-stats div {
    margin: 0.5rem 0;
  }

  /* Seasonal highlight cards */
  .seasonal-card {
    background: linear-gradient(135deg, #ff7b7b 0%, #ff6b6b 100%);
    color: white;
    box-shadow: var(--shadow-md);
  }

  .seasonal-card::before {
    background: linear-gradient(90deg, var(--accent-color) 0%, #ffed4e 100%);
    opacity: 1;
  }

  .seasonal-card::after {
    color: white;
  }
  
  .seasonal-card .card-title,
  .seasonal-card .card-description,
  .seasonal-card .card-stats {
    color: white;
  }
  
  .seasonal-card .card-stats {
    border-top-color: rgba(255,255,255,0.3);
  }

  /* Deep Winter Navy Card */
  .midnight-card {
    background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
    color: white;
    box-shadow: var(--shadow-md);
  }

  .midnight-card::before {
    background: linear-gradient(90deg, #5f9ea0 0%, #4682b4 100%);
    opacity: 1;
  }

  .midnight-card::after {
    content: 'üåô';
    color: white;
  }

  .midnight-card .card-title,
  .midnight-card .card-description,
  .midnight-card .card-stats {
    color: white;
  }

  .midnight-card .card-stats {
    border-top-color: rgba(255,255,255,0.3);
  }

  .note {
    background: white;
    padding: 20px;
    border-radius: 12px;
    margin-top: 30px;
    box-shadow: var(--shadow-sm);
  }

  .note h3 {
    color: var(--text-dark);
    margin-top: 0;
  }

  .note code {
    background: #f7fafc;
    padding: 2px 6px;
    border-radius: 4px;
    font-family: 'Courier New', monospace;
    color: #e53e3e;
  }

    /* üçÇ CHAMP CARDS */
    .championship-card {
      background: linear-gradient(135deg, #d4a012 0%, #b8860b 100%);
      color: white;
      box-shadow: 0 8px 24px rgba(255,215,0,0.3);
    }

    .championship-card::before {
      background: linear-gradient(90deg, #ffd700 0%, #ffec80 100%);
      opacity: 1;
    }

    .championship-card::after {
      content: 'üèÜ';
      color: white;
    }

    .championship-card .card-title,
    .championship-card .card-description,
    .championship-card .card-stats {
      color: white;
    }

    .championship-card .card-stats {
      border-top-color: rgba(255,255,255,0.3);
    }
/* üçÇ FALL THEMED CARDS */

  /* Autumn Orange Card */
  .autumn-card {
    background: linear-gradient(135deg, #ff6b35 0%, #f7931e 100%);
    color: white;
    box-shadow: var(--shadow-md);
  }

  .autumn-card::before {
    background: linear-gradient(90deg, #ffaa5a 0%, #ffd89b 100%);
    opacity: 1;
  }

  .autumn-card::after {
    content: 'üçÇ';
    color: white;
  }

  .autumn-card .card-title,
  .autumn-card .card-description,
  .autumn-card .card-stats {
    color: white;
  }

  .autumn-card .card-stats {
    border-top-color: rgba(255,255,255,0.3);
  }

  /* Harvest Gold Card */
  .harvest-card {
    background: linear-gradient(135deg, #d4a373 0%, #e6c68d 100%);
    color: #3e2723;
    box-shadow: var(--shadow-md);
  }

  .harvest-card::before {
    background: linear-gradient(90deg, #f0d5a8 0%, #fceabb 100%);
    opacity: 1;
  }

  .harvest-card::after {
    content: 'üåæ';
    color: #d4a373;
  }

  .harvest-card .card-title {
    color: #3e2723;
  }

  .harvest-card .card-description,
  .harvest-card .card-stats {
    color: #5d4037;
  }

  .harvest-card .card-stats {
    border-top-color: rgba(62,39,35,0.2);
  }

  /* Crimson Maple Card */
  .maple-card {
    background: linear-gradient(135deg, #c62828 0%, #e53935 100%);
    color: white;
    box-shadow: var(--shadow-md);
  }

  .maple-card::before {
    background: linear-gradient(90deg, #ef5350 0%, #ff6f60 100%);
    opacity: 1;
  }

  .maple-card::after {
    content: 'üçÅ';
    color: white;
  }

  .maple-card .card-title,
  .maple-card .card-description,
  .maple-card .card-stats {
    color: white;
  }

  .maple-card .card-stats {
    border-top-color: rgba(255,255,255,0.3);
  }

  /* Pumpkin Spice Card */
  .pumpkin-card {
    background: linear-gradient(135deg, #d84315 0%, #ff6f00 100%);
    color: white;
    box-shadow: var(--shadow-md);
  }

  .pumpkin-card::before {
    background: linear-gradient(90deg, #ff8a50 0%, #ffb74d 100%);
    opacity: 1;
  }

  .pumpkin-card::after {
    content: 'üéÉ';
    color: white;
  }

  .pumpkin-card .card-title,
  .pumpkin-card .card-description,
  .pumpkin-card .card-stats {
    color: white;
  }

  .pumpkin-card .card-stats {
    border-top-color: rgba(255,255,255,0.3);
  }

  /* Rustic Brown Card */
  .rustic-card {
    background: linear-gradient(135deg, #6d4c41 0%, #8d6e63 100%);
    color: white;
    box-shadow: var(--shadow-md);
  }

  .rustic-card::before {
    background: linear-gradient(90deg, #a1887f 0%, #bcaaa4 100%);
    opacity: 1;
  }

  .rustic-card::after {
    content: 'üå∞';
    color: white;
  }

  .rustic-card .card-title,
  .rustic-card .card-description,
  .rustic-card .card-stats {
    color: white;
  }

  .rustic-card .card-stats {
    border-top-color: rgba(255,255,255,0.3);
  }

  /* Twilight Amber Card */
  .twilight-card {
    background: linear-gradient(135deg, #bf360c 0%, #ff5722 100%);
    color: white;
    box-shadow: var(--shadow-md);
  }

  .twilight-card::before {
    background: linear-gradient(90deg, #ff7043 0%, #ff8a65 100%);
    opacity: 1;
  }

  .twilight-card::after {
    content: 'üåÖ';
    color: white;
  }

  .twilight-card .card-title,
  .twilight-card .card-description,
  .twilight-card .card-stats {
    color: white;
  }

  .twilight-card .card-stats {
    border-top-color: rgba(255,255,255,0.3);
  }
  /* Frosty Silver Card */
  .frost-card {
    background: linear-gradient(135deg, #b8c6db 0%, #f5f7fa 100%);
    color: #2c3e50;
    box-shadow: var(--shadow-md);
  }

  .frost-card::before {
    background: linear-gradient(90deg, #dfe9f3 0%, #ffffff 100%);
    opacity: 1;
  }

  .frost-card::after {
    content: '‚ùÑÔ∏è';
    color: #b8c6db;
  }

  .frost-card .card-title {
    color: #2c3e50;
  }

  .frost-card .card-description,
  .frost-card .card-stats {
    color: #34495e;
  }

  .frost-card .card-stats {
    border-top-color: rgba(44,62,80,0.2);
  }
  .note {
    background: white;
    padding: 20px;
    border-radius: 12px;
    margin-top: 30px;
    box-shadow: var(--shadow-sm);
  }

  .note h3 {
    color: var(--text-dark);
    margin-top: 0;
  }

  .note code {
    background: #f7fafc;
    padding: 2px 6px;
    border-radius: 4px;
    font-family: 'Courier New', monospace;
    color: #e53e3e;
  }
  
  /* Northern Lights Card */
  .aurora-card {
    background: linear-gradient(135deg, #134e5e 0%, #71b280 100%);
    color: white;
    box-shadow: var(--shadow-md);
  }

  .aurora-card::before {
    background: linear-gradient(90deg, #00d2ff 0%, #3a7bd5 100%);
    opacity: 1;
  }

  .aurora-card::after {
    content: 'üåå';
    color: white;
  }

  .aurora-card .card-title,
  .aurora-card .card-description,
  .aurora-card .card-stats {
    color: white;
  }

  .aurora-card .card-stats {
    border-top-color: rgba(255,255,255,0.3);
  }

  /* Games card with vibrant purple/pink theme */
  .games-card {
    background: linear-gradient(135deg, #7c3aed 0%, #ec4899 100%);
    color: white;
    box-shadow: var(--shadow-md);
  }

  .games-card::before {
    background: linear-gradient(90deg, #ec4899 0%, #f472b6 100%);
    opacity: 1;
  }

  .games-card::after {
    content: 'üéÆ';
    color: white;
  }

  .games-card .card-icon,
  .games-card .card-title,
  .games-card .card-description,
  .games-card .card-stats {
    color: white;
  }

  .games-card .card-stats {
    border-top-color: rgba(255,255,255,0.3);
  }


  /* Main stats cards with forest green theme */
  .main-stats-card {
    background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
    color: white;
    box-shadow: var(--shadow-md);
  }

  .main-stats-card::before {
    background: linear-gradient(90deg, var(--accent-color) 0%, #ffed4e 100%);
    opacity: 1;
  }

  .main-stats-card::after {
    color: white;
  }
  
  .main-stats-card .card-icon,
  .main-stats-card .card-title,
  .main-stats-card .card-description,
  .main-stats-card .card-stats {
    color: white;
  }
  
  .main-stats-card .card-stats {
    border-top-color: rgba(255,255,255,0.3);
  }

  /* Pitching card with teal theme */
  .pitching-card {
    background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
    color: white;
    box-shadow: var(--shadow-md);
  }

  .pitching-card::before {
    background: linear-gradient(90deg, #38ef7d 0%, #4ade80 100%);
    opacity: 1;
  }

  .pitching-card::after {
    color: white;
  }
  
  .pitching-card .card-icon,
  .pitching-card .card-title,
  .pitching-card .card-description,
  .pitching-card .card-stats {
    color: white;
  }
  
  .pitching-card .card-stats {
    border-top-color: rgba(255,255,255,0.3);
  }

  /* Purple themed card for personalization */
  .purple-card {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    box-shadow: var(--shadow-md);
  }

  .purple-card::before {
    background: linear-gradient(90deg, #f093fb 0%, #f5576c 100%);
    opacity: 1;
  }

  .purple-card::after {
    color: white;
  }
  
  .purple-card .card-icon,
  .purple-card .card-title,
  .purple-card .card-description,
  .purple-card .card-stats {
    color: white;
  }
  
  .purple-card .card-stats {
    border-top-color: rgba(255,255,255,0.3);
  }

  /* Color-coded category cards */
  .card.batting {
    border-left: 4px solid #f56565;
  }

  .card.batting .card-icon {
    color: #f56565;
  }

  .card.pitching {
    border-left: 4px solid #4299e1;
  }

  .card.pitching .card-icon {
    color: #4299e1;
  }

  .card.teams {
    border-left: 4px solid #48bb78;
  }

  .card.teams .card-icon {
    color: #48bb78;
  }

  .card.awards {
    border-left: 4px solid #ed8936;
  }

  .card.awards .card-icon {
    color: #ed8936;
  }

  .card.media {
    border-left: 4px solid #9f7aea;
  }

  .card.media .card-icon {
    color: #9f7aea;
  }

  /* Quick access navigation */
  .quick-access {
    background: var(--card-bg);
    border-radius: 16px;
    padding: 2.5rem;
    box-shadow: var(--shadow-sm);
    border: 1px solid var(--border-color);
  }
  
  .quick-nav {
    display: flex;
    flex-wrap: wrap;
    gap: 1rem;
    align-items: center;
  }
  
  .nav-btn {
    padding: 1rem 1.75rem;
    border: 2px solid var(--primary-color);
    background: white;
    color: var(--primary-color);
    text-decoration: none;
    border-radius: 12px;
    font-weight: 600;
    font-size: 0.95rem;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    display: flex;
    align-items: center;
    gap: 0.75rem;
    position: relative;
    overflow: hidden;
  }

  .nav-btn::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: var(--primary-color);
    transform: translateX(-100%);
    transition: transform 0.3s ease;
    z-index: -1;
  }
  
  .nav-btn:hover {
    color: white;
    transform: translateY(-2px);
    box-shadow: var(--shadow-md);
  }

  .nav-btn:hover::before {
    transform: translateX(0);
  }

  .nav-btn.primary {
    background: var(--primary-color);
    color: white;
  }
  
  .nav-btn.primary:hover {
    background: var(--secondary-color);
  }

  /* Spade Link Styles */
  .spade-link-container {
    text-align: center;
    padding: 2rem 0 1rem;
  }

  .spade-link {
    font-size: 3rem;
    color: #000;
    text-decoration: none;
    display: inline-block;
    transition: all 0.3s ease;
    opacity: 0.7;
  }

  .spade-link:hover {
    transform: scale(1.2);
    opacity: 1;
    text-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
  }
  
  /* Responsive Design */
  @media (max-width: 768px) {
    .top-nav-content {
      padding: 1rem;
    }

    .nav-logo {
      font-size: 1rem;
    }

    .auth-button {
      padding: 0.5rem 1rem;
      font-size: 0.85rem;
    }

    .user-name {
      display: none;
    }

    .header h1 {
      font-size: 2.5rem;
    }

    .header::after {
      font-size: 80px;
      bottom: -20px;
    }
    
    .section-title {
      font-size: 1.6rem;
    }

    .section-title::after {
      display: none;
    }
    
    .cards-grid {
      grid-template-columns: 1fr;
      gap: 1.5rem;
    }
    
    .quick-nav {
      flex-direction: column;
    }
    
    .nav-btn {
      width: 100%;
      justify-content: center;
    }

    .dashboard-container {
      margin: 2rem auto;
      padding: 0 1.25rem;
    }
  }

  /* Smooth scroll behavior */
  html {
    scroll-behavior: smooth;
  }

  /* Fade in animation for cards */
  @keyframes fadeInUp {
    from {
      opacity: 0;
      transform: translateY(30px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  .card {
    animation: fadeInUp 0.6s ease backwards;
  }

  .card:nth-child(1) { animation-delay: 0.1s; }
  .card:nth-child(2) { animation-delay: 0.2s; }
  .card:nth-child(3) { animation-delay: 0.3s; }
  .card:nth-child(4) { animation-delay: 0.4s; }
  .card:nth-child(5) { animation-delay: 0.5s; }
  .card:nth-child(6) { animation-delay: 0.6s; }

  /* ========================================
     OFFSEASON PHOTO GALLERY CAROUSEL
     ======================================== */
  .photo-gallery-section {
    max-width: 1400px;
    margin: 0 auto 2rem auto;
    padding: 0 2rem;
  }

  .photo-gallery-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-bottom: 1rem;
  }

  .photo-gallery-title {
    font-size: 1.5rem;
    font-weight: 700;
    color: var(--text-dark);
    display: flex;
    align-items: center;
    gap: 0.75rem;
    margin: 0;
  }

  .photo-gallery-title::before {
    content: "";
    display: inline-block;
    width: 6px;
    height: 28px;
    background: linear-gradient(180deg, var(--primary-color) 0%, var(--secondary-color) 100%);
    border-radius: 3px;
  }

  .photo-gallery-link {
    color: var(--primary-color);
    text-decoration: none;
    font-weight: 600;
    font-size: 0.9rem;
    display: flex;
    align-items: center;
    gap: 0.5rem;
    transition: all 0.2s ease;
  }

  .photo-gallery-link:hover {
    color: var(--secondary-color);
    transform: translateX(3px);
  }

  .photo-carousel-container {
    position: relative;
    overflow: hidden;
    border-radius: 16px;
    background: var(--card-bg);
    box-shadow: var(--shadow-md);
    border: 1px solid var(--border-color);
  }

  .photo-carousel-track {
    display: flex;
    transition: transform 0.8s cubic-bezier(0.25, 0.46, 0.45, 0.94);
  }

  .photo-carousel-slide {
    min-width: 100%;
    position: relative;
    aspect-ratio: 16 / 7;
    overflow: hidden;
  }

  .photo-carousel-slide img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    transition: transform 0.5s ease;
  }

  .photo-carousel-slide:hover img {
    transform: scale(1.02);
  }

  .photo-carousel-caption {
    position: absolute;
    bottom: 0;
    left: 0;
    right: 0;
    padding: 2rem 1.5rem 1rem;
    background: linear-gradient(transparent, rgba(0,0,0,0.7));
    color: white;
  }

  .photo-carousel-caption h4 {
    margin: 0 0 0.25rem 0;
    font-size: 1.1rem;
    font-weight: 600;
    text-shadow: 1px 1px 2px rgba(0,0,0,0.5);
  }

  .photo-carousel-caption p {
    margin: 0;
    font-size: 0.85rem;
    opacity: 0.9;
  }

  /* Carousel Navigation Arrows */
  .photo-carousel-nav {
    position: absolute;
    top: 50%;
    transform: translateY(-50%);
    background: rgba(255,255,255,0.95);
    border: none;
    width: 44px;
    height: 44px;
    border-radius: 50%;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.25rem;
    color: var(--text-dark);
    box-shadow: var(--shadow-md);
    transition: all 0.2s ease;
    z-index: 10;
  }

  .photo-carousel-nav:hover {
    background: white;
    transform: translateY(-50%) scale(1.1);
    box-shadow: var(--shadow-lg);
  }

  .photo-carousel-nav.prev {
    left: 1rem;
  }

  .photo-carousel-nav.next {
    right: 1rem;
  }

  /* Carousel Dots/Indicators */
  .photo-carousel-dots {
    display: flex;
    justify-content: center;
    gap: 0.5rem;
    padding: 1rem;
    background: var(--card-bg);
    border-top: 1px solid var(--border-color);
  }

  .photo-carousel-dot {
    width: 10px;
    height: 10px;
    border-radius: 50%;
    background: var(--border-color);
    border: none;
    cursor: pointer;
    transition: all 0.3s ease;
    padding: 0;
  }

  .photo-carousel-dot:hover {
    background: var(--text-light);
  }

  .photo-carousel-dot.active {
    background: var(--primary-color);
    width: 28px;
    border-radius: 5px;
  }

  /* Loading/Empty States */
  .photo-gallery-loading,
  .photo-gallery-empty {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    padding: 4rem 2rem;
    color: var(--text-light);
    text-align: center;
  }

  .photo-gallery-loading .spinner {
    font-size: 2.5rem;
    animation: spin 1.5s ease-in-out infinite;
    margin-bottom: 1rem;
  }

  .photo-gallery-empty .empty-icon {
    font-size: 3rem;
    margin-bottom: 1rem;
    opacity: 0.5;
  }

  /* Mobile Responsiveness */
  @media (max-width: 768px) {
    .photo-gallery-section {
      padding: 0 1rem;
      margin-bottom: 1.5rem;
    }

    .photo-gallery-header {
      flex-direction: column;
      align-items: flex-start;
      gap: 0.5rem;
    }

    .photo-gallery-title {
      font-size: 1.25rem;
    }

    .photo-carousel-slide {
      aspect-ratio: 16 / 9;
    }

    .photo-carousel-nav {
      width: 36px;
      height: 36px;
      font-size: 1rem;
    }

    .photo-carousel-nav.prev {
      left: 0.5rem;
    }

    .photo-carousel-nav.next {
      right: 0.5rem;
    }

    .photo-carousel-caption {
      padding: 1.5rem 1rem 0.75rem;
    }

    .photo-carousel-caption h4 {
      font-size: 1rem;
    }

    .photo-carousel-caption p {
      font-size: 0.8rem;
    }
  }
</style>
</head>
<body>

  <!-- Loading Spinner -->
  <div class="loading-overlay" id="loadingOverlay">
    <div class="softball-spinner"></div>
  </div>


  <!-- Top Navigation Bar -->
  <div class="top-nav-bar">
    <div class="top-nav-content">
      <div class="nav-logo">
        <span>‚öæ</span>
        <span>Mountainside Aces</span>
      </div>
      <div class="auth-section" id="authSection">
        <!-- Auth buttons will be dynamically inserted here by auth.js -->
        <a href="signin.html" class="auth-button">Sign In</a>
        <a href="signup.html" class="auth-button primary">Sign Up</a>
      </div>
    </div>
  </div>

  <!-- Scrolling News Banner -->
  <div class="news-banner">
    <div class="news-content" id="newsContent">
      <!-- Content will be dynamically loaded -->
    </div>
  </div>

  <!-- Header -->
  <header class="header">
    <h1>‚öæÔ∏è Mountainside Aces</h1>
    <p>Softball Statistics Hub</p>
  </header>

  <!-- This Week Module -->
  <div class="this-week-module" id="thisWeekModule" style="display: none;">
    <div class="this-week-header">
      <div class="this-week-title">üìÖ This Week's Games</div>
      <a href="weekend-preview.html" class="this-week-link">Full Preview ‚Üí</a>
    </div>
    <div class="this-week-games" id="thisWeekGames">
      <div class="this-week-empty">Loading games...</div>
    </div>
  </div>

  <!-- Global Search Bar -->
  <div class="global-search-container">
    <div class="search-wrapper">
      <div class="search-icon">üîç</div>
      <input 
        type="text" 
        class="global-search-input" 
        placeholder="Search players, teams, seasons..."
        id="globalSearch"
        autocomplete="off"
      >
      <button class="clear-search" id="clearSearch">‚úï</button>
    </div>
    <div class="search-results" id="searchResults">
      <!-- Results will be populated here -->
    </div>
  </div>

  <!-- Offseason Photo Gallery -->
  <section class="photo-gallery-section" id="photoGallerySection">
    <div class="photo-gallery-header">
      <h2 class="photo-gallery-title">üì∏ League Photos</h2>
      <a href="pictures.html" class="photo-gallery-link">
        View All Photos ‚Üí
      </a>
    </div>
    <div class="photo-carousel-container" id="photoCarousel">
      <div class="photo-gallery-loading" id="galleryLoading">
        <div class="spinner">üì∑</div>
        <p>Loading photos...</p>
      </div>
      <div class="photo-carousel-track" id="carouselTrack" style="display: none;">
        <!-- Slides will be dynamically inserted -->
      </div>
      <button class="photo-carousel-nav prev" id="carouselPrev" style="display: none;">‚Äπ</button>
      <button class="photo-carousel-nav next" id="carouselNext" style="display: none;">‚Ä∫</button>
    </div>
    <div class="photo-carousel-dots" id="carouselDots" style="display: none;">
      <!-- Dots will be dynamically inserted -->
    </div>
  </section>

  <!-- Dashboard -->
  <div class="dashboard-container">
    
    <!-- Current Season Section -->
    <section class="section">
      <h2 class="section-title">Current Season</h2>
      <div class="cards-grid">
        <a href="current-season.html" class="card-link">
          <div class="card autumn-card">
            <div class="card-icon">üçÇ</div>
            <h3 class="card-title">2025 Fall Season</h3>
            <p class="card-description">View current standings, upcoming schedule, past results, and projected playoff bracket</p>
            <div class="card-stats">
              <div>üìä Live standings & playoff tracker</div>
              <div>üìÖ Complete schedule & results</div>
              <div>üèÜ Season Hitting Leaders</div>
            </div>
          </div>
        </a>
        <a href="championship-preview.html" class="card-link">
          <div class="card championship-card">
            <div class="card-icon">üèÜ</div>
            <h3 class="card-title">Championship Preview</h3>
            <p class="card-description">See the full head to head comparison of this year's championship contenders</p>
            <div class="card-stats">
                <div>üõ§Ô∏è Seasons Journey</div>
                <div>‚≠ê Best Hitters & Pitchers</div>
                <div>üèÜ Team MVPs</div>
            </div>
          </div>
        </a>
        <a href="recap.html" class="card-link">
          <div class="card midnight-card">
            <div class="card-icon">üìñ</div>
            <h3 class="card-title">Year In Review</h3>
            <p class="card-description">See the full year in review for both summer and fall</p>
            <div class="card-stats">
              <div>üìä Final Standings and League Champs</div>
              <div>‚≠ê Top Hitters & Pitchers</div>
              <div>üèÜ Top Rookies</div>
            </div>
          </div>
        </a>
        <a href="champions.html" class="card-link">
          <div class="card midnight-card">
            <div class="card-icon">üèÜ</div>
            <h3 class="card-title">CHAMPIONS</h3>
            <p class="card-description">Full Summary of the Aces Champions Seasons</p>
            <div class="card-stats">
              <div>üõ§Ô∏è Seasons Journey</div>
              <div>‚≠ê Best Hitters & Pitchers</div>
              <div>üèÜ Team MVPs</div>
            </div>
          </div>
        </a>
        <a href="weekend-preview.html" class="card-link">
          <div class="card maple-card">
            <div class="card-icon">üîÆ</div>
            <h3 class="card-title">Weekend Preview</h3>
            <p class="card-description">High-level overview of upcoming weekend games with matchup analysis and betting odds</p>
            <div class="card-stats">
              <div>‚öîÔ∏è Team matchups & records</div>
              <div>üéØ Game previews & predictions</div>
              <div>üÉè Odds and analysis</div>
            </div>
          </div>
        </a>

        <a href="league-rules.html" class="card-link">
          <div class="card rustic-card">
            <div class="card-icon">‚öñÔ∏è</div>
            <h3 class="card-title">Game and Roster Rules</h3>
            <p class="card-description">Official league rules, game formats, and player eligibility requirements</p>
            <div class="card-stats">
              <div>üìã Roster Rules</div>
              <div>üõ°Ô∏è General Game and Scheduling Rules</div>
            </div>
          </div>
        </a>
        <a href="rule-proposals.html" class="card-link">
          <div class="card rustic-card">
            <div class="card-icon">‚öñÔ∏è</div>
            <h3 class="card-title">Submit Rule Proposals for 2026</h3>
            <p class="card-description">Submit any rule proposals for the rule committee to consider for the upcoming seasons</p>
            <div class="card-stats">
              <div>üìã Changes to Roster Rules</div>
              <div>üõ°Ô∏è Changes to Gameplay</div>
            </div>
          </div>
        </a>
        
		<a href="playoffs.html" class="card-link">
          <div class="card twilight-card">
            <div class="card-icon">ü•á</div>
            <h3 class="card-title">Playoff Bracket</h3>
            <p class="card-description">Follow along with the playoff bracket through the playoffs</p>
            <div class="card-stats">
              <div>üîÆ See the future and predict the final standings</div>
              <div>üëª Simulate thousands of possible season outcomes</div>
            </div>
          </div>
        </a>
 		<a href="playoff-clinching.html" class="card-link">
          <div class="card pumpkin-card">
            <div class="card-icon">üîí</div>
            <h3 class="card-title">Playoff Clinching Scenarios</h3>
            <p class="card-description">Learn what your team needs to do to clinch their playoff seed</p>
            <div class="card-stats">
              <div>üóùÔ∏è Understand what happens should you win or lose</div>
              <div>‚ûï Try and decipher the tie breakers scenarios!</div>
            </div>
          </div>
        </a>       
         <!-- Removing now that playoffs are about to start. Loading Clinching Scenario instead
		<a href="projections.html" class="card-link">
          <div class="card pumpkin-card">
            <div class="card-icon">üé±</div>
            <h3 class="card-title">Playoff Predictor</h3>
            <p class="card-description">Use your crystal ball and simulate the rest of the season to see the expected playoff bracket</p>
            <div class="card-stats">
              <div>üîÆ See the future and predict the final standings</div>
              <div>üëª Simulate thousands of possible season outcomes</div>
            </div>
          </div>
        </a>  -->
		 <a href="bracket.html" class="card-link">
          <div class="card autumn-card">
            <div class="card-icon">üî≠</div>
            <h3 class="card-title">Fill out your own playoff bracket</h3>
            <p class="card-description">Make your predictions for who you think will take the 2025 Fall Title</p>

          </div>
        </a> 

        <a href="games.html" class="card-link">
          <div class="card games-card">
            <div class="card-icon">üéÆ</div>
            <h3 class="card-title">Daily Games</h3>
            <p class="card-description">Test your Aces knowledge with daily puzzles and challenges</p>
            <div class="card-stats">
              <div>üéØ Aces Grid & Connections</div>
              <div>üî§ Wordle & Who Am I?</div>
              <div>‚è±Ô∏è Player Recall & More</div>
            </div>
          </div>
        </a>
		
      </div>
    </section>

    <!-- Milestone Watch Section -->
    <section class="section" id="milestoneWatchSection">
      <h2 class="section-title">üéØ Milestone Watch</h2>
      <div class="milestone-watch-container">
        <div id="milestoneWatchContent">
          <div class="milestone-loading">Loading milestone data...</div>
        </div>
      </div>
    </section>

<!-- Sign Up Guide Card (Shown for non-authenticated users only) -->
    <section class="section" id="signupGuideSection" style="display: none;">
      <h2 class="section-title">Get Started</h2>
      <div class="cards-grid">
        <a href="mountainside-aces-signup-guide.html" class="card-link">
          <div class="card purple-card">
            <div class="card-icon">üìñ</div>
            <h3 class="card-title">Learn How to Sign Up</h3>
            <p class="card-description">New to the site? Check out our guide to create your account and get started!</p>
            <div class="card-stats">
              <div>üöÄ Quick account setup</div>
              <div>üë§ Link your player profile</div>
              <div>‚≠ê Access personalized features</div>
            </div>
          </div>
        </a>
      </div>
    </section>

    <!-- My Aces Section (Hidden by default, shown when user is signed in) -->
    <section class="section" id="personalizationSection" style="display: none;">
      <h2 class="section-title">My Aces</h2>
      <div class="cards-grid">
        
        <!-- Dashboard Card - Always visible for authenticated users -->
        <a href="my-dashboard.html" class="card-link">
          <div class="card main-stats-card">
            <div class="card-icon">üìã</div>
            <h3 class="card-title">My Dashboard</h3>
            <p class="card-description">Your personal hub for games, RSVPs, stats, and quick actions</p>
            <div class="card-stats">
              <div>üéØ Next game & RSVP</div>
              <div>üìä Quick stats overview</div>
              <div>‚≠ê Your favorites</div>
            </div>
          </div>
        </a>
        
        <!-- Profile Card - Always visible for authenticated users -->
        <a href="profile.html" class="card-link">
          <div class="card aurora-card">
            <div class="card-icon">üë§</div>
            <h3 class="card-title">My Profile</h3>
            <p class="card-description">Manage your account settings, notifications, and preferences</p>
            <div class="card-stats">
              <div>‚öôÔ∏è Account settings</div>
              <div>üîî Notification preferences</div>
              <div>üîó Linked player profile</div>
            </div>
          </div>
        </a>
        
        <!-- Directory Card - Visible for authenticated users -->
        <a href="aces-directory.html" class="card-link" id="directoryCard" style="display: none;">
          <div class="card midnight-card">
            <div class="card-icon">üìá</div>
            <h3 class="card-title">Aces Directory</h3>
            <p class="card-description">Connect with fellow Mountainside Aces members</p>
          </div>
        </a>
        
        <!-- Submit Scores Card - Captains/Staff only -->
        <a href="submit-score.html" class="card-link" id="submitScoresCard" style="display: none;">
          <div class="card twilight-card">
            <div class="card-icon">üî¢</div>
            <h3 class="card-title">Submit Scores</h3>
            <p class="card-description">Submit final scores after each game</p>
          </div>
        </a>
        
        <!-- Submit Stats Card - Captains/Staff only -->
        <a href="submit-stats.html" class="card-link" id="submitStatsCard" style="display: none;">
          <div class="card frost-card">
            <div class="card-icon">üßÆ</div>
            <h3 class="card-title">Submit Game Stats</h3>
            <p class="card-description">Submit player stats after each game</p>
          </div>
        </a>
        
        <!-- Upload Photos Card - Captains/Staff only -->
        <a href="photo-upload.html" class="card-link" id="uploadsCard" style="display: none;">
          <div class="card maple-card">
            <div class="card-icon">üì§</div>
            <h3 class="card-title">Upload Photos</h3>
            <p class="card-description">Share photos from games and events</p>
          </div>
        </a>
        
        <!-- Offseason Hub Card - Captains/Staff only -->
        <a href="offseason.html" class="card-link" id="offseasonCard" style="display: none;">
          <div class="card pumpkin-card">
            <div class="card-icon">üé£</div>
            <h3 class="card-title">Offseason Hub</h3>
            <p class="card-description">Manage rosters and review proposed schedules</p>
          </div>
        </a>
        
        <!-- Aces Shop Card - Always visible for authenticated users -->
        <a href="https://acesmountainside.com/" class="card-link" target="_blank" rel="noopener noreferrer">
          <div class="card aurora-card">
            <div class="card-icon">üõí</div>
            <h3 class="card-title">Aces Shop</h3>
            <p class="card-description">Get your official Mountainside Aces gear and merchandise</p>
          </div>
        </a>
        
      </div>
    </section>

    <!-- Statistics Section -->
    <section class="section">
      <h2 class="section-title">Statistics</h2>
      <div class="cards-grid">
        <a href="batting.html" class="card-link">
          <div class="card main-stats-card">
            <div class="card-icon">‚öæ</div>
            <h3 class="card-title">Batting Statistics</h3>
            <p class="card-description">Complete batting statistics for all players across all seasons</p>
            <div class="card-stats">
              <div>üìä Advanced metrics & career leaders</div>
              <div>üèÜ Filter by season, team, or player</div>
            </div>
          </div>
        </a>
        
        <a href="pitching.html" class="card-link">
          <div class="card pitching-card">
            <div class="card-icon">ü•é</div>
            <h3 class="card-title">Pitching Statistics</h3>
            <p class="card-description">Comprehensive pitching stats and analytics</p>
            <div class="card-stats">
              <div>üìà ERA, strikeouts, innings pitched</div>
              <div>üéØ Advanced pitching metrics</div>
            </div>
          </div>
        </a>
      </div>
    </section>

    <!-- Teams & Players Section -->
    <section class="section">
      <h2 class="section-title">Teams & Players</h2>
      <div class="cards-grid">
        <a href="teams.html" class="card-link">
          <div class="card">
            <div class="card-icon">üèÜ</div>
            <h3 class="card-title">All Teams</h3>
            <p class="card-description">Team profiles, rosters, and championship history</p>
            <div class="card-stats">
              <div>üéñÔ∏è Championship records</div>
              <div>üë• Complete roster information</div>
            </div>
          </div>
        </a>
        
        <a href="players.html" class="card-link">
          <div class="card">
            <div class="card-icon">üë•</div>
            <h3 class="card-title">All Players</h3>
            <p class="card-description">Individual player profiles and career statistics</p>
            <div class="card-stats">
              <div>üìà Career progression tracking</div>
              <div>üèÖ Awards and achievements</div>
            </div>
          </div>
        </a>
        
        <a href="h2h_grid.html" class="card-link">
          <div class="card">
            <div class="card-icon">‚öîÔ∏è</div>
            <h3 class="card-title">Head to Head Grid</h3>
            <p class="card-description">Summary of Head to Head Aces Match-Up</p>
            <div class="card-stats">
              <div>üÜö Summary of Head to Head Performance</div>
              <div>üèÖ Rivalry Stats and Records</div>
            </div>
          </div>
        </a>
		<a href="league-history.html" class="card-link">
          <div class="card">
            <div class="card-icon">üìú</div>
            <h3 class="card-title">League Progression</h3>
            <p class="card-description">Summary of the growth of the Aces League</p>
            <div class="card-stats">
              <div>üìà Growth by Seasons</div>
              <div>üë• See When New Teams Joined the League</div>
            </div>
          </div>
        </a>
      </div>
    </section>

    <!-- League Information Section -->
    <section class="section">
      <h2 class="section-title">League Information</h2>
      <div class="cards-grid">
        <a href="seasons.html" class="card-link">
          <div class="card">
            <div class="card-icon">üìÖ</div>
            <h3 class="card-title">All Seasons</h3>
            <p class="card-description">Browse statistics and results by season and year</p>
            <div class="card-stats">
              <div>üìä Historical season data</div>
              <div>üèÜ Championship results</div>
            </div>
          </div>
        </a>
        
        <a href="awards.html" class="card-link">
          <div class="card">
            <div class="card-icon">üèÖ</div>
            <h3 class="card-title">League Awards</h3>
            <p class="card-description">MVP, batting champions, and special recognitions</p>
            <div class="card-stats">
              <div>üèÜ Seasonal award winners</div>
              <div>‚≠ê Special achievements</div>
            </div>
          </div>
        </a>
        
        <a href="leaders.html" class="card-link">
          <div class="card">
            <div class="card-icon">üëë</div>
            <h3 class="card-title">Career Leaders</h3>
            <p class="card-description">All-time statistical leaders and records</p>
            <div class="card-stats">
              <div>üìà Batting & pitching leaders</div>
              <div>üéØ League records</div>
            </div>
          </div>
        </a>
        
        <a href="milestones.html" class="card-link">
          <div class="card">
            <div class="card-icon">üéØ</div>
            <h3 class="card-title">Batting Milestones</h3>
            <p class="card-description">Career milestones for players who have reached significant thresholds</p>
            <div class="card-stats">
              <div>üéØ Hits</div>
              <div>üèÉ Runs</div>
              <div>üö∂ Walks</div>
            </div>
          </div>
        </a>
        
        <a href="pictures.html" class="card-link">
          <div class="card">
            <div class="card-icon">üì∑</div>
            <h3 class="card-title">Aces Media Gallery</h3>
            <p class="card-description">See the photos & videos of the Aces over the years!</p>
            <div class="card-stats">
              <div>üé• Photos & Videos from over the years</div>
              <div>üé¨ Game Day Action Shots</div>
              <div>üé≠ Off the Field Memories</div>
            </div>
          </div>
        </a>
      </div>
    </section>
    
    <!-- Tools Section -->
    <section class="section">
      <h2 class="section-title">Tools</h2>
      <div class="cards-grid">
	          <a href="query-stats.html" class="card-link">
          <div class="card">
            <div class="card-icon">üîç</div>
            <h3 class="card-title">Advanced Statistical Searches</h3>
            <p class="card-description">Search for players by batting or pitching statistics with custom filters</p>
            <div class="card-stats">
              <div>üéñÔ∏è Career Stats</div>
              <div>üìà Season Comparisons</div>
              <div>üìä Batting & Pitching</div>
            </div>
          </div>
        </a>
        <a href="compare.html" class="card-link">
          <div class="card">
            <div class="card-icon">üîÄ</div>
            <h3 class="card-title">Player Comparisons</h3>
            <p class="card-description">Side-by-side comparison tool for analyzing player performance across careers or specific seasons.</p>
            <div class="card-stats">
              <div>üéñÔ∏è Career comparisons</div>
              <div>üìà Season analysis</div>
              <div>üÜö Head-to-head stats</div>
            </div>
          </div>
        </a>
        
        <a href="team_compare.html" class="card-link">
          <div class="card">
            <div class="card-icon">üÜö</div>
            <h3 class="card-title">Team Comparisons</h3>
            <p class="card-description">Side-by-side comparison tool for analyzing team performance across careers or specific seasons</p>
            <div class="card-stats">
              <div>üÜö Head to Head Record</div>
              <div>üìä Team Synopsis</div>
              <div>üèÖ Award Summary</div>
            </div>
          </div>
        </a>
        
        <a href="charts.html" class="card-link">
          <div class="card">
            <div class="card-icon">üìä</div>
            <h3 class="card-title">Performance Charts</h3>
            <p class="card-description">Interactive charts and visualizations showing team performance comparisons, win/loss records, batting statistics, and season standings with export capabilities.</p>
            <div class="card-stats">
              <div>üìà Team and Player Charts</div>
              <div>üñºÔ∏è Data Visualization</div>
              <div>üíæ Export Functionality</div>
            </div>
          </div>
        </a>
      </div>
    </section>

    <!-- Quick Access Section -->
    <section class="section">
      <div class="quick-access">
        <h3 style="margin-bottom: 1.5rem; color: #333;">Quick Access</h3>
        <div class="quick-nav">
          <a href="current-season.html" class="nav-btn primary">üçÇ Current Season</a>
          <a href="weekend-preview.html" class="nav-btn">üîÆ Weekend Preview</a>
          <a href="league-rules.html" class="nav-btn">‚öñÔ∏è Rules</a>
          <a href="batting.html" class="nav-btn">‚öæ Batting Stats</a>
          <a href="pitching.html" class="nav-btn">ü•é Pitching Stats</a>
          <a href="teams.html" class="nav-btn">üèÜ Teams</a>
          <a href="players.html" class="nav-btn">üë• Players</a>
          <a href="seasons.html" class="nav-btn">üìÖ Seasons</a>
          <a href="https://acesmountainside.com/" class="nav-btn" target="_blank" rel="noopener noreferrer">üõí ACES SHOP</a>
        </div>
      </div>
    </section>

    <!-- Spade Link to Boxes Pool -->
    <div class="spade-link-container">
      <a href="boxes-pool.html" class="spade-link" title="Boxes Pool">‚ô†</a>
    </div>
  </div>

  <script>
    // Hide loading spinner after page loads
    window.addEventListener('load', function() {
      setTimeout(function() {
        document.getElementById('loadingOverlay').classList.add('hidden');
      }, 800);
    });
  </script>

  <script src="mobile-enhancements.js"></script>
  
  <!-- Auth State Management -->


 <!-- Replace the auth state change handler in index.html (around line 1106-1230) with this: -->

<!-- Replace the auth state change handler in index.html (around line 1106-1230) with this: -->

<script type="module">
  import { auth, onAuthChange, getUserProfile, USER_ROLES } from './firebase-auth.js';
  import { isImpersonating, getEffectiveUserProfile, injectImpersonationBanner } from './admin-impersonate.js';

  const authSection = document.getElementById('authSection');
  const personalizationSection = document.getElementById('personalizationSection');
  
  // Mobile auth is handled by nav-component.js, not directly here

  // Listen for auth state changes
  onAuthChange(async (user) => {
    console.log('üîç Auth state changed:', user ? user.email : 'No user');
    
    if (user) {
      // User is signed in
      console.log('‚úÖ User signed in:', user.email);
      
      let displayName = user.displayName || user.email.split('@')[0];
      let profile = null;
      
      try {
        const profileResult = await getUserProfile(user.uid);
        if (profileResult.success && profileResult.data) {
          profile = profileResult.data;
          // Check for impersonation mode
          if (isImpersonating()) {
            profile = getEffectiveUserProfile(profile);
            console.log('üé≠ Impersonation active - viewing as:', profile?.displayName);
          }
          injectImpersonationBanner();

          if (profile.preferredDisplayName) {
            displayName = profile.preferredDisplayName;
            console.log('‚úÖ Using preferred display name:', displayName);
          }
        }
      } catch (error) {
        console.error('‚ö†Ô∏è Could not load user profile:', error);
      }
      
      // Show personalization section, hide signup guide
      const signupGuideSection = document.getElementById('signupGuideSection');
      if (personalizationSection) {
        personalizationSection.style.display = 'block';
        
        // Update sections based on profile
        if (profile) {
          updateDirectoryCard(profile);
          updateScoreSubmissionCard(profile);
          updateStatSubmissionCard(profile);
          updateUploadsCard(profile);
          updateOffseasonCard(profile);
        }
      }
      
      // Hide signup guide for authenticated users
      if (signupGuideSection) {
        signupGuideSection.style.display = 'none';
      }
      
      // Update desktop auth section
      authSection.innerHTML = `
        <div class="user-profile-nav">
          <a href="profile.html" class="auth-button">
            <span>üë§</span>
            <span class="user-name">${displayName}</span>
          </a>
          <a href="favorites.html" class="auth-button">
            <span>‚≠ê</span>
            <span>Favorites</span>
          </a>
          <button class="auth-button" id="signOutBtn">Sign Out</button>
        </div>
      `;
      
      // ‚≠ê KEY FIX: Add event listeners AFTER creating the buttons
      // Use setTimeout to ensure DOM is fully updated
      setTimeout(() => {
        const signOutBtn = document.getElementById('signOutBtn');
        
        if (signOutBtn) {
          signOutBtn.addEventListener('click', handleSignOut);
          console.log('‚úÖ Desktop sign-out button listener attached');
        } else {
          console.error('‚ùå Could not find signOutBtn');
        }
      }, 0);
      
    } else {
      // User is signed out
      const signupGuideSection = document.getElementById('signupGuideSection');
      
      if (personalizationSection) {
        personalizationSection.style.display = 'none';
      }
      
      // Show signup guide for non-authenticated users
      if (signupGuideSection) {
        signupGuideSection.style.display = 'block';
      }
      
      authSection.innerHTML = `
        <a href="signin.html" class="auth-button">Sign In</a>
        <a href="signup.html" class="auth-button primary">Sign Up</a>
      `;
    }
  });

  // ‚≠ê Separate sign-out handler function
  async function handleSignOut() {
    console.log('üö™ Sign out clicked');
    try {
      await auth.signOut();
      console.log('‚úÖ User signed out successfully');
      window.location.reload();
    } catch (error) {
      console.error('‚ùå Sign out error:', error);
      alert('Error signing out. Please try again.');
    }
  }

  // Helper functions for updating cards
  function updateDirectoryCard(profile) {
  const directoryCard = document.getElementById('directoryCard');
  if (!directoryCard) return;
  
  const userRole = profile.userRole;
  const canApprove = userRole === USER_ROLES.ADMIN ||
                     userRole === USER_ROLES.LEAGUE_STAFF ||
                        userRole === USER_ROLES.CAPTAIN ||
                        userRole === USER_ROLES.PLAYER ||
                        userRole === USER_ROLES.TEAM_STAFF;
                        
  
  const isCaptainViaTeamRoles = profile.teamRoles &&
    Object.values(profile.teamRoles).some(
      teamRole => teamRole.role === USER_ROLES.CAPTAIN && teamRole.status === 'active'
    );
  
  const isCaptainLegacy = profile.isCaptain === true;
  
  if (canApprove || isCaptainViaTeamRoles || isCaptainLegacy) {
    directoryCard.style.display = 'block';
  } else {
    directoryCard.style.display = 'none';
  }
}

    function updateOffseasonCard(profile) {
    const offseasonCard = document.getElementById('offseasonCard');
    if (!offseasonCard) return;
    
    const userRole = profile.userRole;
    const canApprove = userRole === USER_ROLES.ADMIN || 
                       userRole === USER_ROLES.LEAGUE_STAFF || 
                       userRole === USER_ROLES.CAPTAIN;
    
    const isCaptainViaTeamRoles = profile.teamRoles && 
      Object.values(profile.teamRoles).some(
        teamRole => teamRole.role === USER_ROLES.CAPTAIN && teamRole.status === 'active'
      );
    
    const isCaptainLegacy = profile.isCaptain === true;
    
    if (canApprove || isCaptainViaTeamRoles || isCaptainLegacy) {
      offseasonCard.style.display = 'block';
    } else {
      offseasonCard.style.display = 'none';
    }
  }
      function updateScoreSubmissionCard(profile) {
    const submitScoresCard = document.getElementById('submitScoresCard');
    if (!submitScoresCard) return;
    
    const userRole = profile.userRole;
    const canApprove = userRole === USER_ROLES.ADMIN || 
                       userRole === USER_ROLES.LEAGUE_STAFF || 
					   userRole === USER_ROLES.TEAM_STAFF || 
                       userRole === USER_ROLES.CAPTAIN;
    
    const isCaptainViaTeamRoles = profile.teamRoles && 
      Object.values(profile.teamRoles).some(
        teamRole => teamRole.role === USER_ROLES.CAPTAIN && teamRole.status === 'active'
      );
    
    const isCaptainLegacy = profile.isCaptain === true;
    
    if (canApprove || isCaptainViaTeamRoles || isCaptainLegacy) {
      submitScoresCard.style.display = 'block';
    } else {
      submitScoresCard.style.display = 'none';
    }
  }
 function updateStatSubmissionCard(profile) {
    const submitStatsCard = document.getElementById('submitStatsCard');
    if (!submitStatsCard) return;
    
    const userRole = profile.userRole;
    const canApprove = userRole === USER_ROLES.ADMIN || 
                       userRole === USER_ROLES.LEAGUE_STAFF || 
					   userRole === USER_ROLES.TEAM_STAFF || 
                       userRole === USER_ROLES.CAPTAIN;
    
    const isCaptainViaTeamRoles = profile.teamRoles && 
      Object.values(profile.teamRoles).some(
        teamRole => teamRole.role === USER_ROLES.CAPTAIN && teamRole.status === 'active'
      );
    
    const isCaptainLegacy = profile.isCaptain === true;
    
    if (canApprove || isCaptainViaTeamRoles || isCaptainLegacy) {
      submitStatsCard.style.display = 'block';
    } else {
      submitStatsCard.style.display = 'none';
    }
  }
      function updateUploadsCard(profile) {
    const uploadsCard = document.getElementById('uploadsCard');
    if (!uploadsCard) return;
    
    const userRole = profile.userRole;
    const canApprove = userRole === USER_ROLES.ADMIN || 
                       userRole === USER_ROLES.LEAGUE_STAFF || 
                       userRole === USER_ROLES.CAPTAIN;
    
    const isCaptainViaTeamRoles = profile.teamRoles && 
      Object.values(profile.teamRoles).some(
        teamRole => teamRole.role === USER_ROLES.CAPTAIN && teamRole.status === 'active'
      );
    
    const isCaptainLegacy = profile.isCaptain === true;
    
    if (canApprove || isCaptainViaTeamRoles || isCaptainLegacy) {
      uploadsCard.style.display = 'block';
    } else {
      uploadsCard.style.display = 'none';
    }
  }
</script>

<!-- Photo Gallery Carousel Script -->
<script type="module">
  import { getPhotosByFolder } from './firebase-storage.js';
  import { db, doc, getDoc } from './firebase-config.js';

  class PhotoCarousel {
    constructor() {
      this.photos = [];
      this.currentIndex = 0;
      this.autoScrollInterval = null;
      this.autoScrollDelay = 6000; // 6 seconds between slides
      this.isPaused = false;
      
      // DOM Elements
      this.section = document.getElementById('photoGallerySection');
      this.loading = document.getElementById('galleryLoading');
      this.track = document.getElementById('carouselTrack');
      this.prevBtn = document.getElementById('carouselPrev');
      this.nextBtn = document.getElementById('carouselNext');
      this.dotsContainer = document.getElementById('carouselDots');
      this.container = document.getElementById('photoCarousel');
      
      if (!this.section) {
        console.log('üì∑ Photo gallery section not found');
        return;
      }
      
      this.checkVisibilityAndInit();
    }
    
    async checkVisibilityAndInit() {
      try {
        // Check Firebase for gallery visibility toggle
        // Path: siteConfig/features/photoGallery { enabled: true/false }
        const featureDoc = await getDoc(doc(db, 'siteConfig', 'features'));
        
        if (featureDoc.exists()) {
          const features = featureDoc.data();
          
          // Check if gallery is explicitly disabled
          if (features.photoGallery === false || features.photoGalleryEnabled === false) {
            console.log('üì∑ Photo gallery disabled in Firebase');
            this.section.style.display = 'none';
            return;
          }
        }
        
        // Gallery is enabled (default) - proceed with initialization
        this.init();
        
      } catch (error) {
        // If we can't check Firebase, default to showing the gallery
        console.warn('üì∑ Could not check gallery visibility, defaulting to visible:', error.message);
        this.init();
      }
    }
    
    async init() {
      console.log('üì∑ Initializing photo gallery...');
      
      try {
        // Load photos from the 'league' folder
        this.photos = await getPhotosByFolder('league');
        
        // Filter to only images (not videos) for the carousel
        this.photos = this.photos.filter(photo => photo.type === 'image');
        
        console.log(`üì∑ Found ${this.photos.length} league photos`);
        
        if (this.photos.length === 0) {
          this.showEmptyState();
          return;
        }
        
        this.renderSlides();
        this.renderDots();
        this.bindEvents();
        this.showCarousel();
        this.startAutoScroll();
        
      } catch (error) {
        console.error('‚ùå Error loading photos:', error);
        this.showEmptyState();
      }
    }
    
    renderSlides() {
      this.track.innerHTML = this.photos.map((photo, index) => `
        <div class="photo-carousel-slide" data-index="${index}">
          <img 
            src="${photo.url}" 
            alt="${photo.name || 'League photo'}"
            loading="${index === 0 ? 'eager' : 'lazy'}"
          />
          <div class="photo-carousel-caption">
            <h4>${photo.name || 'League Photo'}</h4>
            <p>${this.formatDate(photo.createdAt)}${photo.uploadedByName ? ' ‚Ä¢ ' + photo.uploadedByName : ''}</p>
          </div>
        </div>
      `).join('');
    }
    
    renderDots() {
      // Only show dots if we have multiple photos (max 15 dots for cleaner UI)
      const maxDots = Math.min(this.photos.length, 15);
      
      if (this.photos.length <= 1) {
        this.dotsContainer.style.display = 'none';
        return;
      }
      
      this.dotsContainer.innerHTML = this.photos.slice(0, maxDots).map((_, index) => `
        <button class="photo-carousel-dot ${index === 0 ? 'active' : ''}" data-index="${index}"></button>
      `).join('');
      
      if (this.photos.length > maxDots) {
        this.dotsContainer.innerHTML += `<span style="color: var(--text-light); font-size: 0.8rem; margin-left: 0.5rem;">+${this.photos.length - maxDots} more</span>`;
      }
    }
    
    showCarousel() {
      this.loading.style.display = 'none';
      this.track.style.display = 'flex';
      this.dotsContainer.style.display = 'flex';
      
      if (this.photos.length > 1) {
        this.prevBtn.style.display = 'flex';
        this.nextBtn.style.display = 'flex';
      }
    }
    
    showEmptyState() {
      this.loading.innerHTML = `
        <div class="photo-gallery-empty">
          <div class="empty-icon">üì∑</div>
          <p>No league photos yet</p>
          <a href="photo-upload.html" style="color: var(--primary-color); text-decoration: none; font-weight: 600;">Upload the first photo ‚Üí</a>
        </div>
      `;
    }
    
    bindEvents() {
      // Navigation buttons
      this.prevBtn.addEventListener('click', () => {
        this.goToSlide(this.currentIndex - 1);
        this.resetAutoScroll();
      });
      
      this.nextBtn.addEventListener('click', () => {
        this.goToSlide(this.currentIndex + 1);
        this.resetAutoScroll();
      });
      
      // Dot navigation
      this.dotsContainer.addEventListener('click', (e) => {
        if (e.target.classList.contains('photo-carousel-dot')) {
          const index = parseInt(e.target.dataset.index);
          this.goToSlide(index);
          this.resetAutoScroll();
        }
      });
      
      // Pause on hover
      this.container.addEventListener('mouseenter', () => {
        this.isPaused = true;
      });
      
      this.container.addEventListener('mouseleave', () => {
        this.isPaused = false;
      });
      
      // Touch/swipe support
      let touchStartX = 0;
      let touchEndX = 0;
      
      this.track.addEventListener('touchstart', (e) => {
        touchStartX = e.changedTouches[0].screenX;
      }, { passive: true });
      
      this.track.addEventListener('touchend', (e) => {
        touchEndX = e.changedTouches[0].screenX;
        this.handleSwipe(touchStartX, touchEndX);
      }, { passive: true });
      
      // Keyboard navigation (when focused)
      this.container.setAttribute('tabindex', '0');
      this.container.addEventListener('keydown', (e) => {
        if (e.key === 'ArrowLeft') {
          this.goToSlide(this.currentIndex - 1);
          this.resetAutoScroll();
        } else if (e.key === 'ArrowRight') {
          this.goToSlide(this.currentIndex + 1);
          this.resetAutoScroll();
        }
      });
    }
    
    handleSwipe(startX, endX) {
      const threshold = 50;
      const diff = startX - endX;
      
      if (Math.abs(diff) > threshold) {
        if (diff > 0) {
          // Swiped left - go to next
          this.goToSlide(this.currentIndex + 1);
        } else {
          // Swiped right - go to previous
          this.goToSlide(this.currentIndex - 1);
        }
        this.resetAutoScroll();
      }
    }
    
    goToSlide(index) {
      // Handle wrap-around
      if (index < 0) {
        index = this.photos.length - 1;
      } else if (index >= this.photos.length) {
        index = 0;
      }
      
      this.currentIndex = index;
      this.track.style.transform = `translateX(-${index * 100}%)`;
      
      // Update dots
      const dots = this.dotsContainer.querySelectorAll('.photo-carousel-dot');
      dots.forEach((dot, i) => {
        dot.classList.toggle('active', i === index);
      });
    }
    
    startAutoScroll() {
      this.autoScrollInterval = setInterval(() => {
        if (!this.isPaused) {
          this.goToSlide(this.currentIndex + 1);
        }
      }, this.autoScrollDelay);
    }
    
    resetAutoScroll() {
      clearInterval(this.autoScrollInterval);
      this.startAutoScroll();
    }
    
    formatDate(timestamp) {
      if (!timestamp) return '';
      
      try {
        const date = timestamp.toDate ? timestamp.toDate() : new Date(timestamp);
        return date.toLocaleDateString('en-US', { 
          month: 'short', 
          day: 'numeric',
          year: 'numeric'
        });
      } catch {
        return '';
      }
    }
  }
  
  // Initialize on DOM ready
  document.addEventListener('DOMContentLoaded', () => {
    new PhotoCarousel();
  });
</script>
  
  <script type="module">
  // Global Search Functionality - CONVERTED TO FIREBASE
  import {
    getAllPlayerStatsOptimized,
    getCurrentSeason,
    getSeasonGames,
    getAllSeasons
  } from './firebase-data.js';

  class GlobalSearch {
    constructor() {
      this.searchInput = document.getElementById('globalSearch');
      this.searchResults = document.getElementById('searchResults');
      this.clearButton = document.getElementById('clearSearch');
      
      if (!this.searchInput || !this.searchResults || !this.clearButton) {
        console.warn('Global search elements not found');
        return;
      }
      
      this.allData = [];
      this.allTeams = [];
      this.allSeasons = [];
      this.currentHighlight = -1;
      this.searchTimeout = null;
      
      this.init();
    }
    
    async init() {
      await this.loadData();
      this.bindEvents();
    }
    
    async loadData() {
      try {
        console.log('üîç Loading search data from Firebase...');
        
        const capitalize = (str) => str ? str.charAt(0).toUpperCase() + str.slice(1) : "";
        
        const [allPlayerStats, seasons] = await Promise.all([
          getAllPlayerStatsOptimized(),
          getAllSeasons()
        ]);
        
        console.log(`‚úÖ Loaded ${allPlayerStats.length} players, ${seasons.length} seasons`);
        
        let awardsData = [];
        try {
          const { db, collection, getDocs } = await import('./firebase-config.js');
          const awardsSnapshot = await getDocs(collection(db, 'awards'));
          
          awardsSnapshot.forEach(doc => {
            const data = doc.data();
            awardsData.push({
              Player: data.playerName || data.Player,
              Award: data.category || data.Award,
              Year: data.year || (data.seasonId ? data.seasonId.split('-')[0] : ''),
              Season: data.season || (data.seasonId ? data.seasonId.split('-')[1] : '')
            });
          });
          
          console.log(`‚úÖ Loaded ${awardsData.length} awards from Firebase`);
        } catch (error) {
          console.warn('Could not load awards from Firebase:', error);
          awardsData = [];
        }
        
        const gamePromises = seasons.map(async (season) => {
          try {
            const seasonGames = await getSeasonGames(season.id);
            return seasonGames.map(g => {
              let dateString = "";
              try {
                if (g.date && g.date.seconds) {
                  const dateObj = new Date(g.date.seconds * 1000);
                  const month = dateObj.getMonth() + 1;
                  const day = dateObj.getDate();
                  const year = dateObj.getFullYear();
                  dateString = `${month}/${day}/${year}`;
                } else if (g.date) {
                  dateString = g.date;
                }
              } catch (dateError) {
                console.warn('Date parsing error:', dateError);
                dateString = "";
              }
              
              return {
                "home team": g.homeTeamName || capitalize(g.homeTeamId) || "",
                "away team": g.awayTeamName || capitalize(g.awayTeamId) || "",
                "home score": g.homeScore !== undefined ? g.homeScore : null,
                "away score": g.awayScore !== undefined ? g.awayScore : null,
                winner: capitalize(g.winner || ""),
                game_type: g.gameType || "Regular",
                date: dateString,
                year: season.year.toString(),
                season: capitalize(season.season || "")
              };
            });
          } catch (err) {
            console.warn(`Could not load games for season ${season.id}:`, err);
            return [];
          }
        });
        
        const allSeasonGames = await Promise.all(gamePromises);
        const gamesData = allSeasonGames.flat();
        
        console.log(`‚úÖ Loaded ${gamesData.length} total games`);
        
        this.allData = this.processPlayerData(allPlayerStats, awardsData);
        this.allTeams = this.processTeamData(allPlayerStats, gamesData);
        this.allSeasons = this.processSeasonData(seasons, gamesData);
        
        console.log('‚úÖ Search data processed:', {
          players: this.allData.length,
          teams: this.allTeams.length,
          seasons: this.allSeasons.length
        });
        
      } catch (error) {
        console.error('‚ùå Error loading search data:', error);
        console.error('Error stack:', error.stack);
        this.allData = [];
        this.allTeams = [];
        this.allSeasons = [];
      }
    }
    
    processPlayerData(allPlayerStats, awardsData) {
      const playerMap = {};
      
      allPlayerStats.forEach(player => {
        const name = player.playerName || player.name || player.id;
        if (!name) return;
        
        if (!playerMap[name]) {
          playerMap[name] = {
            name: name,
            teams: new Set(),
            games: 0,
            atBats: 0,
            hits: 0,
            runs: 0,
            walks: 0,
            mostRecentTeam: player.currentTeam || "",
            awards: 0
          };
        }
        
        const p = playerMap[name];
        
        if (player.currentTeam) {
          p.teams.add(player.currentTeam);
          p.mostRecentTeam = player.currentTeam;
        }
        
        p.games += Number(player.careerGames || 0);
        p.atBats += Number(player.careerAtBats || 0);
        p.hits += Number(player.careerHits || 0);
        p.runs += Number(player.careerRuns || 0);
        p.walks += Number(player.careerWalks || 0);
        
        if (p.games === 0 && player.seasons) {
          Object.values(player.seasons).forEach(season => {
            p.games += Number(season.games || 0);
            p.atBats += Number(season.atBats || 0);
            p.hits += Number(season.hits || 0);
            p.runs += Number(season.runs || 0);
            p.walks += Number(season.walks || 0);
          });
        }
      });
      
      awardsData.forEach(award => {
        if (!award.Player) return;
        const name = award.Player.trim();
        if (playerMap[name]) {
          playerMap[name].awards++;
        }
      });
      
      return Object.values(playerMap).map(player => ({
        ...player,
        team: player.mostRecentTeam,
        avg: player.atBats > 0 ? (player.hits / player.atBats) : 0,
        teamCount: player.teams.size,
        type: 'player'
      }));
    }
    
    processTeamData(allPlayerStats, gamesData) {
      const teamStats = {};
      
      allPlayerStats.forEach(player => {
        const team = player.currentTeam;
        if (!team) return;
        
        if (!teamStats[team]) {
          teamStats[team] = {
            name: team,
            players: new Set(),
            totalGames: 0,
            wins: 0,
            losses: 0,
            type: 'team'
          };
        }
        teamStats[team].players.add(player.playerName || player.name || player.id);
      });
      
      gamesData.forEach(game => {
        const homeTeam = game["home team"];
        const awayTeam = game["away team"];
        const winner = game.winner;
        
        if (teamStats[homeTeam]) {
          teamStats[homeTeam].totalGames++;
          if (winner === homeTeam) {
            teamStats[homeTeam].wins++;
          } else if (winner !== "Tie" && winner) {
            teamStats[homeTeam].losses++;
          }
        }
        
        if (teamStats[awayTeam]) {
          teamStats[awayTeam].totalGames++;
          if (winner === awayTeam) {
            teamStats[awayTeam].wins++;
          } else if (winner !== "Tie" && winner) {
            teamStats[awayTeam].losses++;
          }
        }
      });
      
      return Object.values(teamStats).map(team => ({
        ...team,
        pct: (team.wins + team.losses) > 0 ? team.wins / (team.wins + team.losses) : 0,
        playerCount: team.players.size
      }));
    }
    
    processSeasonData(seasons, gamesData) {
      const seasonStats = {};
      
      seasons.forEach(season => {
        const key = `${season.year}_${season.season}`;
        seasonStats[key] = {
          year: season.year,
          season: season.season,
          teams: new Set(),
          players: new Set(),
          games: 0,
          type: 'season'
        };
      });
      
      gamesData.forEach(game => {
        const key = `${game.year}_${game.season}`;
        if (seasonStats[key]) {
          seasonStats[key].games++;
          seasonStats[key].teams.add(game["home team"]);
          seasonStats[key].teams.add(game["away team"]);
        }
      });
      
      return Object.values(seasonStats).map(season => ({
        ...season,
        teamCount: season.teams.size,
        playerCount: 0
      }));
    }
    
    bindEvents() {
      this.searchInput.addEventListener('input', (e) => {
        this.handleSearch(e.target.value);
      });
      
      this.searchInput.addEventListener('keydown', (e) => {
        this.handleKeyNavigation(e);
      });
      
      this.searchInput.addEventListener('focus', () => {
        if (this.searchInput.value.trim()) {
          this.showResults();
        }
      });
      
      this.clearButton.addEventListener('click', () => {
        this.clearSearch();
      });
      
      document.addEventListener('click', (e) => {
        if (!this.searchInput.contains(e.target) && !this.searchResults.contains(e.target)) {
          this.hideResults();
        }
      });
    }
    
    handleSearch(query) {
      if (this.searchTimeout) {
        clearTimeout(this.searchTimeout);
      }
      
      this.clearButton.classList.toggle('show', query.length > 0);
      
      if (query.trim().length === 0) {
        this.hideResults();
        return;
      }
      
      this.searchTimeout = setTimeout(() => {
        this.performSearch(query.trim());
      }, 150);
    }
    
    performSearch(query) {
      const results = {
        players: this.searchPlayers(query),
        teams: this.searchTeams(query),
        seasons: this.searchSeasons(query)
      };
      
      const shouldPrioritizeTeams = this.shouldPrioritizeTeams(query, results);
      this.displayResults(results, query, shouldPrioritizeTeams);
    }
    
    shouldPrioritizeTeams(query, results) {
      const q = query.toLowerCase().trim();
      
      return results.teams.some(team => {
        const teamName = team.name.toLowerCase();
        return teamName === q || teamName.startsWith(q) || q.startsWith(teamName);
      });
    }
    
    searchPlayers(query) {
      const q = query.toLowerCase();
      return this.allData
        .filter(player =>
          player.name.toLowerCase().includes(q) ||
          player.team.toLowerCase().includes(q)
        )
        .slice(0, 8)
        .map(player => ({
          ...player,
          type: 'player'
        }));
    }
    
    searchTeams(query) {
      const q = query.toLowerCase();
      return this.allTeams
        .filter(team => team.name.toLowerCase().includes(q))
        .slice(0, 5)
        .map(team => ({
          ...team,
          type: 'team'
        }));
    }
    
    searchSeasons(query) {
      const q = query.toLowerCase();
      return this.allSeasons
        .filter(season =>
          season.year.toString().includes(query) ||
          season.season.toLowerCase().includes(q) ||
          `${season.year} ${season.season}`.toLowerCase().includes(q)
        )
        .sort((a, b) => {
          if (a.year !== b.year) {
            return b.year - a.year;
          }
          if (a.season === b.season) return 0;
          return a.season === 'Fall' ? -1 : 1;
        })
        .slice(0, 6)
        .map(season => ({
          ...season,
          type: 'season'
        }));
    }
    
    displayResults(results, query, prioritizeTeams = false) {
      const totalResults = results.players.length + results.teams.length + results.seasons.length;
      
      if (totalResults === 0) {
        this.searchResults.innerHTML = `
          <div class="no-results">
            No results found for "${query}"
          </div>
        `;
        this.showResults();
        return;
      }
      
      let html = '';
      
      if (prioritizeTeams) {
        if (results.teams.length > 0) {
          html += this.renderTeamsSection(results.teams, query);
        }
        if (results.players.length > 0) {
          html += this.renderPlayersSection(results.players, query);
        }
      } else {
        if (results.players.length > 0) {
          html += this.renderPlayersSection(results.players, query);
        }
        if (results.teams.length > 0) {
          html += this.renderTeamsSection(results.teams, query);
        }
      }
      
      if (results.seasons.length > 0) {
        html += this.renderSeasonsSection(results.seasons, query);
      }
      
      this.searchResults.innerHTML = html;
      this.showResults();
      this.bindResultEvents();
    }
    
    renderPlayersSection(players, query) {
      return `
        <div class="search-category">
          <div class="category-header">Players</div>
          ${players.map(player => `
            <div class="search-item" data-type="player" data-name="${player.name}" data-team="${player.team}">
              <div class="search-item-icon">üë§</div>
              <div class="search-item-content">
                <div class="search-item-title">${this.highlightMatch(player.name, query)}</div>
               <div class="search-item-subtitle">  <span class="team-badge-${player.team.toLowerCase()}">${player.team}</span> ‚Ä¢ ${player.games} games </div>
              </div>
              <div class="search-item-stats">
                ${player.atBats > 0 ? `.${player.avg.toFixed(3).substring(2)} AVG<br>${player.hits} hits` : `${player.runs} runs`}
              </div>
            </div>
          `).join('')}
        </div>
      `;
    }
    
    renderTeamsSection(teams, query) {
      return `
        <div class="search-category">
          <div class="category-header">Teams</div>
          ${teams.map(team => `
            <div class="search-item" data-type="team" data-name="${team.name}">
              <div class="search-item-icon">üèÜ</div>
              <div class="search-item-content">
                <div class="search-item-title team-text-${team.name.toLowerCase()}">  ${this.highlightMatch(team.name, query)}</div>
                <div class="search-item-subtitle">${team.wins}-${team.losses} record ‚Ä¢ ${team.playerCount} players</div>
              </div>
              <div class="search-item-stats">
                ${team.wins + team.losses > 0 ? `.${team.pct.toFixed(3).substring(2)} PCT` : 'New team'}
              </div>
            </div>
          `).join('')}
        </div>
      `;
    }
    
    renderSeasonsSection(seasons, query) {
      return `
        <div class="search-category">
          <div class="category-header">Seasons</div>
          ${seasons.map(season => `
            <div class="search-item" data-type="season" data-year="${season.year}" data-season="${season.season}">
              <div class="search-item-icon">üìÖ</div>
              <div class="search-item-content">
                <div class="search-item-title">${this.highlightMatch(`${season.year} ${season.season}`, query)}</div>
                <div class="search-item-subtitle">${season.teamCount} teams ‚Ä¢ ${season.games} games</div>
              </div>
              <div class="search-item-stats">
                ${season.games} games
              </div>
            </div>
          `).join('')}
        </div>
      `;
    }
    
    highlightMatch(text, query) {
      const regex = new RegExp(`(${query.replace(/[.*+?^${}()|[\]\\]/g, '\\$&')})`, 'gi');
      return text.replace(regex, '<span class="highlight">$1</span>');
    }
    
    bindResultEvents() {
      const items = this.searchResults.querySelectorAll('.search-item');
      items.forEach((item, index) => {
        item.addEventListener('click', () => {
          this.selectResult(item);
        });
        
        item.addEventListener('mouseenter', () => {
          this.currentHighlight = index;
          this.updateHighlight();
        });
      });
    }
    
    selectResult(item) {
      const type = item.dataset.type;
      
      switch(type) {
        case 'player':
          const playerName = item.dataset.name;
          window.location.href = `player.html?name=${encodeURIComponent(playerName)}`;
          break;
          
        case 'team':
          const team = item.dataset.name;
          window.location.href = `team.html?team=${encodeURIComponent(team)}`;
          break;
          
        case 'season':
          const year = item.dataset.year;
          const season = item.dataset.season;
          window.location.href = `season.html?year=${year}&season=${encodeURIComponent(season)}`;
          break;
      }
      
      this.hideResults();
      this.clearSearch();
    }
    
    handleKeyNavigation(e) {
      const items = this.searchResults.querySelectorAll('.search-item');
      
      switch(e.key) {
        case 'ArrowDown':
          e.preventDefault();
          this.currentHighlight = Math.min(this.currentHighlight + 1, items.length - 1);
          this.updateHighlight();
          break;
          
        case 'ArrowUp':
          e.preventDefault();
          this.currentHighlight = Math.max(this.currentHighlight - 1, -1);
          this.updateHighlight();
          break;
          
        case 'Enter':
          e.preventDefault();
          if (this.currentHighlight >= 0 && items[this.currentHighlight]) {
            this.selectResult(items[this.currentHighlight]);
          }
          break;
          
        case 'Escape':
          this.hideResults();
          this.searchInput.blur();
          break;
      }
    }
    
    updateHighlight() {
      const items = this.searchResults.querySelectorAll('.search-item');
      items.forEach((item, index) => {
        item.classList.toggle('highlighted', index === this.currentHighlight);
      });
    }
    
    showResults() {
      this.searchResults.classList.add('show');
      this.currentHighlight = -1;
    }
    
    hideResults() {
      this.searchResults.classList.remove('show');
      this.currentHighlight = -1;
    }
    
    clearSearch() {
      this.searchInput.value = '';
      this.clearButton.classList.remove('show');
      this.hideResults();
      this.searchInput.focus();
    }
  }

  document.addEventListener('DOMContentLoaded', () => {
    new GlobalSearch();
  });
  </script>

  <script type="module">
  // News Banner - CONVERTED TO FIREBASE
  import {
    getCurrentSeason,
    getSeasonGames,
    getSeasonPreviews  // ADD THIS IMPORT
  } from './firebase-data.js';

  // Banner messages are now loaded from Firebase instead of hardcoded
  let announcements = [];

  let recentScores = [];
  let upcomingSchedule = [];

  /**
   * Load active banner messages from Firebase
   * Checks the 'bannerMessages' collection for active messages
   * Sorts by priority and filters by date range if specified
   */
  async function loadBannerMessages() {
    try {
      console.log('üì¢ Loading banner messages from Firebase...');
      
      const { db } = await import('./firebase-config.js');
      const { collection, query, where, getDocs, orderBy } = await import('https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js');
      
      const bannersRef = collection(db, 'bannerMessages');
      const q = query(
        bannersRef,
        where('isActive', '==', true),
        orderBy('priority', 'asc')
      );
      
      const snapshot = await getDocs(q);
      const now = new Date();
      
      announcements = [];
      
      snapshot.forEach(doc => {
        const data = doc.data();
        
        // Check date range if specified
        let isInDateRange = true;
        
        if (data.startDate) {
          const startDate = data.startDate.toDate ? data.startDate.toDate() : new Date(data.startDate);
          if (now < startDate) {
            isInDateRange = false;
          }
        }
        
        if (data.endDate) {
          const endDate = data.endDate.toDate ? data.endDate.toDate() : new Date(data.endDate);
          if (now > endDate) {
            isInDateRange = false;
          }
        }
        
        if (isInDateRange && data.message) {
          announcements.push({
            type: 'announcement',
            text: data.message,
            className: 'news-announcement'
          });
        }
      });
      
      console.log(`‚úÖ Loaded ${announcements.length} active banner messages`);
      
      // If no messages found, show default welcome message
      if (announcements.length === 0) {
        announcements.push({
          type: 'announcement',
          text: 'üèÜ Welcome to Mountainside Aces Statistics Hub!',
          className: 'news-announcement'
        });
      }
      
    } catch (error) {
      console.error('‚ùå Error loading banner messages:', error);
      // Fallback to default message on error
      announcements = [{
        type: 'announcement',
        text: 'üèÜ Welcome to Mountainside Aces Statistics Hub!',
        className: 'news-announcement'
      }];
    }
  }

  async function loadRecentScores() {
    try {
      console.log('üì∞ Loading news banner data from Firebase...');
      
      // Load banner messages from Firebase first
      await loadBannerMessages();
      
      const capitalize = (str) => str ? str.charAt(0).toUpperCase() + str.slice(1) : "";
      
      const currentSeasonData = await getCurrentSeason();
      const [seasonGames, previews] = await Promise.all([
        getSeasonGames(currentSeasonData.id),
        getSeasonPreviews(currentSeasonData.id)  // USE FIREBASE FUNCTION
      ]);
      
      console.log(`‚úÖ Loaded ${seasonGames.length} games and ${previews.length} previews for banner`);
      
      const today = new Date();
      today.setHours(0, 0, 0, 0);
      
      const mappedGames = seasonGames.map(g => {
        let dateString = "";
        if (g.date && g.date.seconds) {
          const dateObj = new Date(g.date.seconds * 1000);
          dateString = dateObj.toLocaleDateString('en-US');
        } else if (g.date) {
          dateString = g.date;
        }
        
        // Handle team names - playoff games use "home team" and "away team" fields
        const homeTeam = g.homeTeamName || g["home team"] || capitalize(g.homeTeamId) || "";
        const awayTeam = g.awayTeamName || g["away team"] || capitalize(g.awayTeamId) || "";
        
        return {
          "home team": homeTeam,
          "away team": awayTeam,
          "home score": g.homeScore !== undefined ? g.homeScore : null,
          "away score": g.awayScore !== undefined ? g.awayScore : null,
          winner: capitalize(g.winner || ""),
          date: dateString,
          year: currentSeasonData.year.toString(),
          season: capitalize(currentSeasonData.season)
        };
      });
      
      const completedGames = mappedGames
        .filter(game => {
          const gameDate = new Date(game.date);
          return game.winner &&
                 game.winner.trim() !== "" &&
                 gameDate < today;
        })
        .sort((a, b) => new Date(b.date) - new Date(a.date))
        .slice(0, 5);

      recentScores = completedGames.map(game => ({
        type: 'score',
        text: formatGameResult(game),
        className: 'news-score'
      }));
      
      // Filter previews for upcoming games
      const upcomingGames = previews
        .filter(preview => {
          const gameDate = new Date(preview.date);
          return gameDate >= today;
        })
        .sort((a, b) => new Date(a.date) - new Date(b.date))
        .slice(0, 5);

      upcomingSchedule = upcomingGames.map(game => ({
        type: 'upcoming',
        text: formatUpcomingGame(game),
        className: 'news-upcoming'
      }));
      
      console.log(`‚úÖ Banner loaded: ${recentScores.length} scores, ${upcomingSchedule.length} upcoming`);
      
    } catch (error) {
      console.log('Could not load games data:', error);
      recentScores = [
        { type: 'score', text: 'üèÜ Blue defeats Orange 12-8 in thriller!', className: 'news-score' }
      ];
      upcomingSchedule = [
        { type: 'upcoming', text: 'üìÖ Gold @ Silver - Oct 15 7:00 PM', className: 'news-upcoming' }
      ];
    }
    
    updateNewsBanner();
  }

  function formatGameResult(game) {
    const homeTeam = game["home team"];
    const awayTeam = game["away team"];
    const homeScore = game["home score"];
    const awayScore = game["away score"];
    const winner = game.winner;
    
    let scoreText;
    
    // Handle tie games
    if (winner === "Tie" && homeScore !== null && awayScore !== null) {
      scoreText = `${homeTeam} ties ${awayTeam} ${homeScore}-${awayScore}`;
    } 
    // Handle games with scores and winner
    else if (winner && homeScore !== null && awayScore !== null) {
      const winnerTeam = winner;
      const loserTeam = winner === homeTeam ? awayTeam : homeTeam;
      
      let winnerScore, loserScore;
      if (winner === homeTeam) {
        winnerScore = homeScore;
        loserScore = awayScore;
      } else {
        winnerScore = awayScore;
        loserScore = homeScore;
      }
      
      scoreText = `${winnerTeam} defeats ${loserTeam} ${winnerScore}-${loserScore}`;
    }
    // Fallback - just show winner if scores aren't available
    else if (winner) {
      const loserTeam = winner === homeTeam ? awayTeam : homeTeam;
      scoreText = `${winner} defeats ${loserTeam}`;
    }
    // Last resort fallback
    else {
      scoreText = `${homeTeam} vs ${awayTeam}`;
    }
    
    return `‚öæ ${scoreText}`;
  }

  function formatUpcomingGame(game) {
    const homeTeam = game["home team"];
    const awayTeam = game["away team"];
    const gameDate = game.date;
    const gameTime = game.time || "TBD";
    
    const dateObj = new Date(gameDate);
    const formattedDate = dateObj.toLocaleDateString('en-US', {
      month: 'short',
      day: 'numeric'
    });
    
    const timeDisplay = gameTime && gameTime.trim() !== "" ? ` ${gameTime}` : "";
    
    return `üìÖ ${awayTeam} @ ${homeTeam} - ${formattedDate}${timeDisplay}`;
  }

  function updateNewsBanner() {
    const newsContent = document.getElementById('newsContent');
    const allNews = [...announcements, ...recentScores, ...upcomingSchedule];
    
    if (allNews.length === 0) {
      newsContent.innerHTML = '<span class="news-item news-announcement">üèÜ Welcome to Mountainside Aces Statistics Hub!</span>';
      return;
    }
    
    const newsHTML = allNews.map(item =>
      `<span class="news-item ${item.className}">${item.text}</span>`
    ).join('');
    
    newsContent.innerHTML = newsHTML;
  }

  // This Week Module - Shows upcoming games for the week
  async function loadThisWeekGames() {
    try {
      console.log('üìÖ Loading This Week games...');
      
      const currentSeasonData = await getCurrentSeason();
      const seasonGames = await getSeasonGames(currentSeasonData.id);
      
      const today = new Date();
      today.setHours(0, 0, 0, 0);
      
      // Get games for the next 7 days
      const nextWeek = new Date(today);
      nextWeek.setDate(nextWeek.getDate() + 7);
      
      const capitalize = (str) => str ? str.charAt(0).toUpperCase() + str.slice(1) : "";
      
      // Get all upcoming games (no winner yet)
      const allUpcomingGames = seasonGames
        .map(g => {
          let gameDate = null;
          if (g.date && g.date.seconds) {
            gameDate = new Date(g.date.seconds * 1000);
          } else if (g.date) {
            gameDate = new Date(g.date);
          }
          
          const homeTeam = g.homeTeamName || g["home team"] || capitalize(g.homeTeamId) || "";
          const awayTeam = g.awayTeamName || g["away team"] || capitalize(g.awayTeamId) || "";
          
          return {
            homeTeam,
            awayTeam,
            date: gameDate,
            time: g.time || '',
            gameId: g.id || g.gameId,
            winner: g.winner
          };
        })
        .filter(g => {
          if (!g.date) return false;
          const gameDate = new Date(g.date);
          gameDate.setHours(0, 0, 0, 0);
          return gameDate >= today && !g.winner;
        })
        .sort((a, b) => a.date - b.date);
      
      // Games this week
      const thisWeekGamesList = allUpcomingGames
        .filter(g => {
          const gameDate = new Date(g.date);
          gameDate.setHours(0, 0, 0, 0);
          return gameDate <= nextWeek;
        })
        .slice(0, 8);
      
      const thisWeekModule = document.getElementById('thisWeekModule');
      const thisWeekGamesContainer = document.getElementById('thisWeekGames');
      const thisWeekTitle = thisWeekModule.querySelector('.this-week-title');
      
      thisWeekModule.style.display = 'block';
      
      const daysOfWeek = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
      const months = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
      
      // Case 1: Games this week
      if (thisWeekGamesList.length > 0) {
        thisWeekTitle.textContent = "üìÖ This Week's Games";
        
        const gamesHTML = thisWeekGamesList.map(game => {
          const dayName = daysOfWeek[game.date.getDay()];
          const monthName = months[game.date.getMonth()];
          const dayNum = game.date.getDate();
          const dateStr = `${dayName}, ${monthName} ${dayNum}`;
          const timeStr = game.time || 'TBD';
          
          return `
            <a href="game-preview.html?home=${encodeURIComponent(game.homeTeam)}&away=${encodeURIComponent(game.awayTeam)}&date=${game.date.toISOString().split('T')[0]}" class="week-game-card">
              <div class="week-game-date">${dateStr}</div>
              <div class="week-game-matchup">${game.awayTeam} @ ${game.homeTeam}</div>
              <div class="week-game-time">üïê ${timeStr}</div>
            </a>
          `;
        }).join('');
        
        thisWeekGamesContainer.innerHTML = gamesHTML;
        console.log(`‚úÖ This Week loaded: ${thisWeekGamesList.length} games`);
      }
      // Case 2: No games this week, but future games exist
      else if (allUpcomingGames.length > 0) {
        const nextGame = allUpcomingGames[0];
        const dayName = daysOfWeek[nextGame.date.getDay()];
        const monthName = months[nextGame.date.getMonth()];
        const dayNum = nextGame.date.getDate();
        const dateStr = `${dayName}, ${monthName} ${dayNum}`;
        const timeStr = nextGame.time || 'TBD';
        
        thisWeekTitle.textContent = "üìÖ Next Game";
        
        thisWeekGamesContainer.innerHTML = `
          <a href="game-preview.html?home=${encodeURIComponent(nextGame.homeTeam)}&away=${encodeURIComponent(nextGame.awayTeam)}&date=${nextGame.date.toISOString().split('T')[0]}" class="week-game-card">
            <div class="week-game-date">${dateStr}</div>
            <div class="week-game-matchup">${nextGame.awayTeam} @ ${nextGame.homeTeam}</div>
            <div class="week-game-time">üïê ${timeStr}</div>
          </a>
        `;
        console.log(`‚úÖ Next Game loaded: ${nextGame.awayTeam} @ ${nextGame.homeTeam}`);
      }
      // Case 3: No future games at all
      else {
        thisWeekTitle.textContent = "üìÖ Schedule";
        thisWeekGamesContainer.innerHTML = `
          <div class="this-week-empty">No games scheduled. Check back soon!</div>
        `;
        console.log('‚ÑπÔ∏è No upcoming games found');
      }
      
    } catch (error) {
      console.error('‚ùå Error loading This Week games:', error);
      document.getElementById('thisWeekModule').style.display = 'none';
    }
  }

  document.addEventListener('DOMContentLoaded', function() {
    loadRecentScores();
    loadThisWeekGames();
    loadMilestoneWatch();
  });

  setInterval(loadRecentScores, 5 * 60 * 1000);

  // Milestone Watch functionality
  async function loadMilestoneWatch() {
    try {
      console.log('üéØ Loading milestone watch data...');
      
      const { getAllPlayerStatsOptimized } = await import('./firebase-data.js');
      
      const players = await getAllPlayerStatsOptimized();
      
      console.log(`‚úÖ Loaded ${players.length} players for milestone watch`);
      
      // Debug: Log first player to see structure
      if (players.length > 0) {
        console.log('Sample player data:', players[0]);
        if (players[0].career) {
          console.log('Career stats structure:', players[0].career);
        }
      }
      
      const milestones = {
        hits: [100, 200, 300, 400],
        runs: [50, 100, 150, 200]
      };
      
      const hitsApproaching = [];
      const runsApproaching = [];
      
      players.forEach(player => {
        const playerName = player.playerName || player.name || player.displayName;
        const team = player.currentTeam || player.team || '';
        
        // Access career stats from nested career object
        const careerStats = player.career || {};
        const hits = Number(careerStats.hits || 0);
        const runs = Number(careerStats.runs || 0);
        
        // Debug: Log players close to milestones
        if (hits >= 90 || runs >= 45) {
          console.log(`Player close to milestone: ${playerName} - ${hits} hits, ${runs} runs (Team: ${team})`);
        }
        
        // Check hits milestones
        for (const milestone of milestones.hits) {
          const threshold = Math.ceil(milestone * 0.95); // 5% threshold
          if (hits >= threshold && hits < milestone) {
            const gap = milestone - hits;
            hitsApproaching.push({
              name: playerName,
              team: team,
              current: hits,
              milestone: milestone,
              gap: gap
            });
            break; // Only track next milestone
          }
        }
        
        // Check runs milestones
        for (const milestone of milestones.runs) {
          const threshold = Math.ceil(milestone * 0.95); // 5% threshold
          if (runs >= threshold && runs < milestone) {
            const gap = milestone - runs;
            runsApproaching.push({
              name: playerName,
              team: team,
              current: runs,
              milestone: milestone,
              gap: gap
            });
            break; // Only track next milestone
          }
        }
      });
      
      console.log(`Found ${hitsApproaching.length} players approaching hit milestones:`, hitsApproaching);
      console.log(`Found ${runsApproaching.length} players approaching run milestones:`, runsApproaching);
      
      // Sort by gap (closest first)
      hitsApproaching.sort((a, b) => a.gap - b.gap);
      runsApproaching.sort((a, b) => a.gap - b.gap);
      
      // Limit to 10 each
      const displayHits = hitsApproaching.slice(0, 10);
      const displayRuns = runsApproaching.slice(0, 10);
      
      renderMilestoneWatch(displayHits, displayRuns);
      
    } catch (error) {
      console.error('‚ùå Error loading milestone watch:', error);
      document.getElementById('milestoneWatchContent').innerHTML = 
        '<div class="milestone-empty">Unable to load milestone data</div>';
    }
  }
  
  function renderMilestoneWatch(hitsData, runsData) {
    const container = document.getElementById('milestoneWatchContent');
    
    if (hitsData.length === 0 && runsData.length === 0) {
      container.innerHTML = '<div class="milestone-empty">No players currently close to milestones</div>';
      return;
    }
    
    let html = '';
    
    // Hits section
    if (hitsData.length > 0) {
      html += `
        <div class="milestone-section">
          <div class="milestone-section-header">
            <span>ü•é Hits</span>
          </div>
          <ul class="milestone-list">
            ${hitsData.map(player => `
              <li class="milestone-item">
                <a href="player.html?name=${encodeURIComponent(player.name)}" class="milestone-player-name">
                  ${player.name}
                </a>
                <span class="milestone-team">(${player.team})</span>
                <span class="milestone-stat"> - 
                  <span class="milestone-gap">${player.gap}</span> 
                  <span class="milestone-target">from ${player.milestone}</span>
                </span>
              </li>
            `).join('')}
          </ul>
        </div>
      `;
    }
    
    // Runs section
    if (runsData.length > 0) {
      html += `
        <div class="milestone-section">
          <div class="milestone-section-header">
            <span>üèÉ Runs</span>
          </div>
          <ul class="milestone-list">
            ${runsData.map(player => `
              <li class="milestone-item">
                <a href="player.html?name=${encodeURIComponent(player.name)}" class="milestone-player-name">
                  ${player.name}
                </a>
                <span class="milestone-team">(${player.team})</span>
                <span class="milestone-stat"> - 
                  <span class="milestone-gap">${player.gap}</span> 
                  <span class="milestone-target">from ${player.milestone}</span>
                </span>
              </li>
            `).join('')}
          </ul>
        </div>
      `;
    }
    
    container.innerHTML = html;
  }
  </script>
<script type="module">
  import { NavigationComponent } from './nav-component.js';
  // Navigation auto-initializes on load!
</script>

<!-- Firebase Visibility Filter for Index Page Cards -->
<script type="module">
  import { loadPageVisibility, isPageVisible } from './nav-config.js';
  
  // Map of page IDs to their card link hrefs
  const PAGE_CARD_MAP = {
    // Primary pages
    'current-season': 'current-season.html',
    'league-rules': 'league-rules.html',
    'batting': 'batting.html',
    'pitching': 'pitching.html',
    'teams': 'teams.html',
    'players': 'players.html',
    // Secondary pages
    'weekend-preview': 'weekend-preview.html',
    'playoffs': 'playoffs.html',
    'projections': 'projections.html',
    'clinching': 'playoff-clinching.html',
    'bracket': 'bracket.html',
    'seasons': 'seasons.html',
    'champions': 'champions.html',
    'recap': 'recap.html',
    'leaders': 'leaders.html',
    'awards': 'awards.html',
    'games': 'games.html',
    'trophy-case': 'trophy-case.html',
    // Tertiary pages
    'milestones': 'milestones.html',
    'compare': 'compare.html',
    'team-compare': 'team_compare.html',
    'h2h': 'h2h_grid.html',
    'history': 'league-history.html',
    'charts': 'charts.html',
    'query-stats': 'query-stats.html',
    'pictures': 'pictures.html',
    'rule-proposal': 'rule-proposals.html',
    'champ-preview': 'championship-preview.html',
    'playoff-history': 'playoff-history.html',
    'rule-review': 'rule-review.html',
    // Auth pages
    'dashboard': 'my-dashboard.html',
    'profile': 'profile.html',
    'contributor': 'contributor.html',
    'favorites': 'favorites.html',
    'roster-management': 'roster-management.html',
    'notifications': 'notifications.html',
    'directory': 'aces-directory.html',
    'submit-score': 'submit-score.html',
    'submit-stats': 'submit-stats.html',
    'photo-upload': 'photo-upload.html',
    'offseason-hub': 'offseason.html',
    'aces-wrapped': 'aces-wrapped.html'
  };
  
  // Wait for page to load
  window.addEventListener('DOMContentLoaded', async () => {
    console.log('üîç Loading page visibility config for index.html...');
    
    // Load visibility config from Firebase
    await loadPageVisibility();
    
    // Find and hide cards for invisible pages
    Object.entries(PAGE_CARD_MAP).forEach(([pageId, href]) => {
      if (!isPageVisible(pageId)) {
        // Find all links with this href
        const cardLinks = document.querySelectorAll(`a.card-link[href="${href}"]`);
        cardLinks.forEach(link => {
          console.log(`üö´ Hiding card for: ${pageId} (${href})`);
          link.style.display = 'none';
        });
      }
    });
    
    console.log('‚úÖ Index page cards filtered by visibility');
  });
</script>

<!-- Online/Offline Status Indicator -->
<!-- Service Worker registration handled by mobile-enhancements.js -->

<script>
// Show online/offline status indicator
function updateOnlineStatus() {
  const existingIndicator = document.getElementById('onlineStatusIndicator');
  if (existingIndicator) {
    existingIndicator.remove();
  }

  if (!navigator.onLine) {
    const indicator = document.createElement('div');
    indicator.id = 'onlineStatusIndicator';
    indicator.className = 'online-status-indicator offline';
    indicator.innerHTML = `
      <span class="status-icon">üì°</span>
      <span class="status-text">Offline Mode</span>
    `;

    if (!document.getElementById('online-status-styles')) {
      const styles = document.createElement('style');
      styles.id = 'online-status-styles';
      styles.textContent = `
        .online-status-indicator {
          position: fixed;
          top: 20px;
          right: 20px;
          background: #1e293b;
          color: white;
          padding: 10px 16px;
          border-radius: 8px;
          font-size: 14px;
          font-weight: 500;
          z-index: 9998;
          display: flex;
          align-items: center;
          gap: 8px;
          box-shadow: 0 4px 12px rgba(0,0,0,0.15);
          animation: fadeIn 0.3s ease;
        }
        .online-status-indicator.offline {
          background: #dc2626;
        }
        @keyframes fadeIn {
          from { opacity: 0; transform: translateY(-10px); }
          to { opacity: 1; transform: translateY(0); }
        }
        @media (max-width: 768px) {
          .online-status-indicator {
            top: 10px;
            right: 10px;
            font-size: 12px;
            padding: 8px 12px;
          }
        }
      `;
      document.head.appendChild(styles);
    }

    document.body.appendChild(indicator);
  }
}

// Listen for online/offline events
window.addEventListener('online', () => {
  console.log('üåê Connection restored');
  updateOnlineStatus();
});

window.addEventListener('offline', () => {
  console.log('üì° Connection lost - offline mode active');
  updateOnlineStatus();
});

// Check status on load
updateOnlineStatus();
</script>

<!-- Load offline queue manager -->
<script src="/offline-queue.js"></script>

<!-- Load offline-aware Firebase wrapper -->
<script src="/firebase-offline-wrapper.js"></script>
</body>
</html>

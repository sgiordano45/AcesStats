<!DOCTYPE html>
<html lang="en">
<head>
<link rel="manifest" href="/manifest.json">
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Aces Wrapped 2025</title>
<meta name="theme-color" content="#2d5016">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<link rel="stylesheet" href="mobile-enhancements.css">
<link rel="stylesheet" href="nav-styles.css">
<style>
  * {
    box-sizing: border-box;
    margin: 0;
    padding: 0;
  }

  body {
    font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
    margin: 0;
    padding: 0;
    overflow-x: hidden;
  }

  /* Loading Overlay */
  .loading-overlay {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(255, 255, 255, 0.95);
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 9999;
    transition: opacity 0.3s ease;
  }

  .loading-overlay.hidden {
    opacity: 0;
    pointer-events: none;
  }

  .softball-spinner::before {
    content: '‚öæ';
    font-size: 80px;
    display: block;
    animation: spin 1.5s ease-in-out infinite;
    margin-bottom: 20px;
  }

  .softball-spinner::after {
    content: 'Loading your season...';
    display: block;
    font-size: 1.2rem;
    color: #4a5568;
    font-weight: 600;
  }

  @keyframes spin {
    0%, 100% { transform: rotate(0deg) scale(1); }
    50% { transform: rotate(180deg) scale(1.1); }
  }

  /* Wrapped Container */
  .wrapped-container {
    width: 100vw;
    height: 100vh;
    overflow: hidden;
    position: relative;
  }

  /* Card */
  .wrapped-card {
    width: 100%;
    height: 100%;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    padding: 2rem;
    text-align: center;
    position: absolute;
    top: 0;
    left: 0;
    transition: opacity 0.3s ease;
  }

  .wrapped-card.hidden {
    opacity: 0;
    pointer-events: none;
  }

  .wrapped-card h1 {
    font-size: clamp(2rem, 8vw, 5rem);
    font-weight: 800;
    margin-bottom: 1rem;
    color: white;
  }

  .wrapped-card h2 {
    font-size: clamp(1.5rem, 5vw, 4rem);
    font-weight: 700;
    margin-bottom: 0.5rem;
    color: white;
  }

  .wrapped-card h3 {
    font-size: clamp(1.2rem, 4vw, 3rem);
    font-weight: 600;
    color: rgba(255, 255, 255, 0.9);
  }

  .wrapped-card p {
    font-size: clamp(1rem, 3vw, 1.5rem);
    color: rgba(255, 255, 255, 0.8);
    max-width: 800px;
  }

  /* Stats Display */
  .big-number {
    font-size: clamp(4rem, 15vw, 10rem);
    font-weight: 900;
    color: #14b8a6;
    line-height: 1;
    margin: 1rem 0;
  }

  .stat-label {
    font-size: clamp(1rem, 3vw, 2rem);
    color: rgba(255, 255, 255, 0.9);
    font-weight: 500;
  }

  /* Progress Bar */
  .progress-container {
    width: 100%;
    max-width: 500px;
    margin: 2rem auto;
  }

  .progress-label {
    display: flex;
    justify-content: space-between;
    color: rgba(255, 255, 255, 0.8);
    font-size: 0.9rem;
    margin-bottom: 0.5rem;
  }

  .progress-bar {
    width: 100%;
    height: 40px;
    background: rgba(255, 255, 255, 0.2);
    border-radius: 20px;
    overflow: hidden;
    position: relative;
  }

  .progress-fill {
    height: 100%;
    background: linear-gradient(90deg, #10b981 0%, #14b8a6 100%);
    border-radius: 20px;
    transition: width 1s ease;
    display: flex;
    align-items: center;
    justify-content: flex-end;
    padding-right: 15px;
    color: white;
    font-weight: 700;
  }

  /* Stats Grid */
  .stats-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
    gap: 2rem;
    max-width: 800px;
    margin: 2rem auto;
  }

  .stat-item {
    text-align: center;
  }

  .stat-value {
    font-size: clamp(2.5rem, 8vw, 5rem);
    font-weight: 800;
    color: #14b8a6;
  }

  .stat-name {
    font-size: clamp(0.9rem, 2vw, 1.2rem);
    color: rgba(255, 255, 255, 0.9);
    margin-top: 0.5rem;
  }

  /* Milestone Cards */
  .milestones-list {
    max-width: 600px;
    margin: 2rem auto;
    display: flex;
    flex-direction: column;
    gap: 1rem;
  }

  .milestone-item {
    background: rgba(255, 255, 255, 0.15);
    backdrop-filter: blur(10px);
    padding: 1.5rem;
    border-radius: 16px;
    display: flex;
    align-items: center;
    gap: 1rem;
    text-align: left;
    border: 2px solid rgba(255, 255, 255, 0.2);
  }

  .milestone-icon {
    font-size: 2rem;
    flex-shrink: 0;
  }

  .milestone-text {
    color: white;
    font-size: clamp(1rem, 2.5vw, 1.3rem);
    font-weight: 600;
  }

  /* Navigation */
  .nav-dots {
    position: fixed;
    bottom: 2rem;
    left: 50%;
    transform: translateX(-50%);
    display: flex;
    gap: 0.5rem;
    z-index: 100;
  }

  .nav-dot {
    width: 10px;
    height: 10px;
    border-radius: 50%;
    background: rgba(255, 255, 255, 0.3);
    cursor: pointer;
    transition: all 0.3s ease;
  }

  .nav-dot.active {
    width: 30px;
    border-radius: 5px;
    background: rgba(255, 255, 255, 0.9);
  }

  /* Navigation Buttons */
  .nav-button {
    position: fixed;
    top: 50%;
    transform: translateY(-50%);
    width: 60px;
    height: 60px;
    border-radius: 50%;
    background: rgba(255, 255, 255, 0.2);
    backdrop-filter: blur(10px);
    border: 2px solid rgba(255, 255, 255, 0.3);
    color: white;
    font-size: 1.5rem;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: all 0.3s ease;
    z-index: 100;
  }

  .nav-button:hover {
    background: rgba(255, 255, 255, 0.3);
    transform: translateY(-50%) scale(1.1);
  }

  .nav-button.prev {
    left: 2rem;
  }

  .nav-button.next {
    right: 2rem;
  }

  /* Instructions */
  .instructions {
    position: fixed;
    top: 1rem;
    right: 1rem;
    color: rgba(255, 255, 255, 0.6);
    font-size: 0.9rem;
    z-index: 100;
  }

  /* Replay Button */
  .replay-button {
    padding: 1rem 2rem;
    background: #14b8a6;
    color: white;
    border: none;
    border-radius: 50px;
    font-size: 1.2rem;
    font-weight: 700;
    cursor: pointer;
    transition: all 0.3s ease;
    margin-top: 2rem;
  }

  .replay-button:hover {
    background: #0d9488;
    transform: scale(1.05);
  }

  /* Share Button */
  .share-button {
    position: fixed;
    top: 1rem;
    left: 1rem;
    padding: 0.75rem 1.5rem;
    background: rgba(255, 255, 255, 0.2);
    backdrop-filter: blur(10px);
    color: white;
    border: 2px solid rgba(255, 255, 255, 0.3);
    border-radius: 50px;
    font-size: 1rem;
    font-weight: 700;
    cursor: pointer;
    transition: all 0.3s ease;
    z-index: 100;
    display: flex;
    align-items: center;
    gap: 0.5rem;
  }

  .share-button:hover {
    background: rgba(255, 255, 255, 0.3);
    transform: scale(1.05);
  }

  /* Share Modal */
  .share-modal {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(0, 0, 0, 0.8);
    display: none;
    align-items: center;
    justify-content: center;
    z-index: 10000;
    padding: 2rem;
  }

  .share-modal.active {
    display: flex;
  }

  .share-modal-content {
    background: white;
    border-radius: 20px;
    padding: 2rem;
    max-width: 500px;
    width: 100%;
    position: relative;
  }

  .share-modal-close {
    position: absolute;
    top: 1rem;
    right: 1rem;
    background: none;
    border: none;
    font-size: 1.5rem;
    cursor: pointer;
    color: #666;
    transition: color 0.3s ease;
  }

  .share-modal-close:hover {
    color: #000;
  }

  .share-modal h3 {
    color: var(--text-dark, #2d3748);
    margin-bottom: 1.5rem;
    font-size: 1.5rem;
  }

  .share-link-container {
    background: #f7fafc;
    border: 2px solid #e2e8f0;
    border-radius: 12px;
    padding: 1rem;
    margin-bottom: 1.5rem;
    display: flex;
    gap: 0.5rem;
    align-items: center;
  }

  .share-link-input {
    flex: 1;
    background: transparent;
    border: none;
    font-size: 0.9rem;
    color: #2d3748;
    overflow: hidden;
    text-overflow: ellipsis;
  }

  .share-link-input:focus {
    outline: none;
  }

  .copy-link-btn {
    padding: 0.5rem 1rem;
    background: #14b8a6;
    color: white;
    border: none;
    border-radius: 8px;
    font-weight: 600;
    cursor: pointer;
    transition: background 0.3s ease;
    white-space: nowrap;
  }

  .copy-link-btn:hover {
    background: #0d9488;
  }

  .copy-link-btn.copied {
    background: #10b981;
  }

  .share-buttons {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
    gap: 1rem;
  }

  .share-platform-btn {
    padding: 1rem;
    border: 2px solid #e2e8f0;
    border-radius: 12px;
    background: white;
    cursor: pointer;
    transition: all 0.3s ease;
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 0.5rem;
    text-decoration: none;
    color: #2d3748;
  }

  .share-platform-btn:hover {
    border-color: #14b8a6;
    background: #f0fdfa;
    transform: translateY(-2px);
  }

  .share-platform-icon {
    font-size: 2rem;
  }

  .share-platform-name {
    font-size: 0.9rem;
    font-weight: 600;
  }

  /* Best Game Card */
  .best-game-card {
    background: rgba(255, 255, 255, 0.15);
    backdrop-filter: blur(10px);
    padding: 2rem;
    border-radius: 20px;
    max-width: 600px;
    margin: 2rem auto;
    border: 2px solid rgba(255, 255, 255, 0.2);
  }

  .best-game-opponent {
    font-size: clamp(1.2rem, 3vw, 1.8rem);
    color: rgba(255, 255, 255, 0.9);
    margin-bottom: 1rem;
  }

  .best-game-stats {
    font-size: clamp(2rem, 5vw, 3rem);
    font-weight: 800;
    color: #14b8a6;
    margin: 1rem 0;
  }

  .best-game-result {
    font-size: clamp(1rem, 2.5vw, 1.5rem);
    color: #10b981;
    font-weight: 700;
  }

  /* Team Stats */
  .team-record {
    display: flex;
    gap: 3rem;
    justify-content: center;
    margin: 2rem 0;
  }

  .record-item {
    text-align: center;
  }

  .record-number {
    font-size: clamp(3rem, 10vw, 6rem);
    font-weight: 900;
    line-height: 1;
  }

  .wins { color: #10b981; }
  .losses { color: #ef4444; }

  @media (max-width: 768px) {
    .nav-button {
      width: 50px;
      height: 50px;
    }

    .nav-button.prev {
      left: 1rem;
    }

    .nav-button.next {
      right: 1rem;
    }

    .instructions {
      display: none;
    }
  }
</style>
</head>
<body>

<!-- Loading Overlay -->
<div id="loadingOverlay" class="loading-overlay">
  <div class="softball-spinner"></div>
</div>

<!-- Navigation Component -->
<nav-component></nav-component>

<!-- Wrapped Container -->
<div id="wrappedContainer" class="wrapped-container" style="display: none;">
  <!-- Cards will be generated dynamically -->
</div>

<!-- Navigation Dots -->
<div id="navDots" class="nav-dots" style="display: none;"></div>

<!-- Navigation Buttons -->
<button id="prevButton" class="nav-button prev" style="display: none;">‚Üê</button>
<button id="nextButton" class="nav-button next" style="display: none;">‚Üí</button>

<!-- Instructions -->
<div class="instructions" id="instructions" style="display: none;">
  Use arrow keys or click to navigate
</div>

<!-- Share Button -->
<button id="shareButton" class="share-button" style="display: none;">
  <span>üì§</span> Share
</button>

<!-- Share Modal -->
<div id="shareModal" class="share-modal">
  <div class="share-modal-content">
    <button class="share-modal-close" onclick="closeShareModal()">‚úï</button>
    <h3>Share Your Aces Wrapped</h3>
    
    <div class="share-link-container">
      <input type="text" class="share-link-input" id="shareLink" readonly>
      <button class="copy-link-btn" id="copyLinkBtn" onclick="copyShareLink()">
        Copy Link
      </button>
    </div>

    <div class="share-buttons">
      <a id="shareWhatsApp" class="share-platform-btn" target="_blank">
        <div class="share-platform-icon">üí¨</div>
        <div class="share-platform-name">WhatsApp</div>
      </a>
      <a id="shareText" class="share-platform-btn" target="_blank">
        <div class="share-platform-icon">üí¨</div>
        <div class="share-platform-name">Text Message</div>
      </a>
      <a id="shareTwitter" class="share-platform-btn" target="_blank">
        <div class="share-platform-icon">üê¶</div>
        <div class="share-platform-name">Twitter</div>
      </a>
      <a id="shareFacebook" class="share-platform-btn" target="_blank">
        <div class="share-platform-icon">üìò</div>
        <div class="share-platform-name">Facebook</div>
      </a>
    </div>
  </div>
</div>

<script type="module">
import { db, collection, doc, getDoc, getDocs } from './firebase-config.js';
import { getCurrentUser } from './firebase-auth.js';

// Team colors mapping
const teamColors = {
  'Black': { primary: '#1a1a1a', gradient: 'linear-gradient(135deg, #1a1a1a 0%, #3a3a3a 100%)' },
  'Green': { primary: '#2d7d32', gradient: 'linear-gradient(135deg, #2d7d32 0%, #1b5e20 100%)' },
  'Red': { primary: '#d32f2f', gradient: 'linear-gradient(135deg, #d32f2f 0%, #b71c1c 100%)' },
  'Blue': { primary: '#1976d2', gradient: 'linear-gradient(135deg, #1976d2 0%, #0d47a1 100%)' },
  'White': { primary: '#f5f5f5', gradient: 'linear-gradient(135deg, #f5f5f5 0%, #e0e0e0 100%)' },
  'Orange': { primary: '#f57c00', gradient: 'linear-gradient(135deg, #f57c00 0%, #e65100 100%)' },
  'Silver': { primary: '#757575', gradient: 'linear-gradient(135deg, #757575 0%, #616161 100%)' },
  'Purple': { primary: '#7b1fa2', gradient: 'linear-gradient(135deg, #7b1fa2 0%, #4a148c 100%)' },
  'Gold': { primary: '#CFB53B', gradient: 'linear-gradient(135deg, #CFB53B 0%, #b89b2f 100%)' },
  'Carolina': { primary: '#4b9cd3', gradient: 'linear-gradient(135deg, #4b9cd3 0%, #2980b9 100%)' },
  'Army': { primary: '#654321', gradient: 'linear-gradient(135deg, #654321 0%, #4a2f17 100%)' }
};

// State
let currentCardIndex = 0;
let cards = [];
let isAnimating = false;

// Get player ID from URL or use current user
const urlParams = new URLSearchParams(window.location.search);
const playerIdParam = urlParams.get('id');

async function loadPlayerData() {
  try {
    let playerId = playerIdParam;
    
    // If no ID in URL, try to get current user
    if (!playerId) {
      const user = await getCurrentUser();
      if (user?.linkedPlayer) {
        playerId = user.linkedPlayer;
      } else if (user) {
        // Try to find player by email
        playerId = user.uid;
      } else {
        throw new Error('Please sign in to view your Aces Wrapped');
      }
    }

    // Fetch player data from aggregatedPlayerStats
    const playerRef = doc(db, 'aggregatedPlayerStats', playerId);
    const playerSnap = await getDoc(playerRef);

    if (!playerSnap.exists() || playerSnap.data().migrated) {
      throw new Error('Player data not found');
    }

    const playerData = { id: playerSnap.id, ...playerSnap.data() };
    
    // Generate cards with player data
    await generateCards(playerData);
    
    // Show wrapped container
    document.getElementById('loadingOverlay').classList.add('hidden');
    document.getElementById('wrappedContainer').style.display = 'block';
    document.getElementById('navDots').style.display = 'flex';
    document.getElementById('instructions').style.display = 'block';
    document.getElementById('shareButton').style.display = 'flex';
    
    // Setup sharing
    setupSharing(playerData);
    
    // Show first card
    showCard(0);
    
  } catch (error) {
    console.error('Error loading player data:', error);
    document.getElementById('loadingOverlay').innerHTML = `
      <div style="text-align: center; padding: 2rem;">
        <h2 style="color: #ef4444; margin-bottom: 1rem;">Unable to Load Aces Wrapped</h2>
        <p style="color: #666;">${error.message}</p>
        <a href="index.html" style="display: inline-block; margin-top: 1rem; padding: 0.5rem 1rem; background: #2d7d32; color: white; text-decoration: none; border-radius: 8px;">Return to Home</a>
      </div>
    `;
  }
}

async function generateCards(playerData) {
  const container = document.getElementById('wrappedContainer');
  const dotsContainer = document.getElementById('navDots');
  
  // Get 2025 season data (Summer + Fall combined)
  const season2025Data = getCombined2025Stats(playerData);
  const teamColor = getPlayerTeamColor(playerData);
  
  // Generate card data
  const cardData = [
    generateWelcomeCard(playerData, teamColor),
    generateGamesCard(season2025Data, teamColor),
    generateBattingCard(season2025Data, playerData, teamColor),
    generateStatsCard(season2025Data, teamColor),
    ...generateMilestoneCards(playerData, teamColor),
    generateTeamCard(season2025Data, playerData, teamColor),
    generateSummaryCard(season2025Data, playerData, teamColor)
  ];

  cards = cardData;

  // Render cards
  cardData.forEach((card, index) => {
    const cardEl = document.createElement('div');
    cardEl.className = 'wrapped-card hidden';
    cardEl.id = `card-${index}`;
    cardEl.style.background = card.background;
    cardEl.innerHTML = card.html;
    container.appendChild(cardEl);

    // Add dot
    const dot = document.createElement('div');
    dot.className = 'nav-dot';
    dot.onclick = () => showCard(index);
    dotsContainer.appendChild(dot);
  });
}

function getCombined2025Stats(playerData) {
  const stats = {
    games: 0,
    hits: 0,
    walks: 0,
    atBats: 0,
    team: '',
    teamRecord: { wins: 0, losses: 0 },
    bestGame: null
  };

  if (!playerData.seasons) return stats;

  // Combine summer and fall 2025
  Object.keys(playerData.seasons).forEach(seasonKey => {
    if (seasonKey.startsWith('2025-summer') || seasonKey.startsWith('2025-fall')) {
      const season = playerData.seasons[seasonKey];
      stats.games += season.games || 0;
      stats.hits += season.hits || 0;
      stats.walks += season.walks || 0;
      stats.atBats += season.atBats || 0;
      
      if (!stats.team && season.team) {
        stats.team = season.team;
      }
    }
  });

  return stats;
}

function getPlayerTeamColor(playerData) {
  const team = playerData.currentTeam || '';
  return teamColors[team] || teamColors['Green'];
}

function calculatePercentile(avg, allAverages) {
  const sorted = allAverages.sort((a, b) => a - b);
  const index = sorted.findIndex(a => a >= avg);
  return Math.round((index / sorted.length) * 100);
}

function generateWelcomeCard(playerData, teamColor) {
  return {
    background: teamColor.gradient,
    html: `
      <div style="max-width: 800px;">
        <h1>Mountainside Aces</h1>
        <h2 style="font-size: clamp(3rem, 10vw, 6rem); color: #14b8a6; margin: 2rem 0;">
          Wrapped 2025
        </h2>
        <h3>${playerData.name || playerData.displayName}'s Season in Review</h3>
        <p style="margin-top: 2rem; opacity: 0.8;">
          ‚öæ Summer & Fall 2025
        </p>
      </div>
    `
  };
}

function generateGamesCard(stats, teamColor) {
  return {
    background: teamColor.gradient,
    html: `
      <h2>You showed up</h2>
      <div class="big-number">${stats.games}</div>
      <p class="stat-label">games played</p>
      <p style="margin-top: 2rem; font-size: 1.5rem;">That's dedication! ‚öæ</p>
    `
  };
}

function generateBattingCard(stats, playerData, teamColor) {
  const avg = stats.atBats > 0 ? (stats.hits / stats.atBats) : 0;
  const avgDisplay = avg.toFixed(3).replace(/^0/, '');
  
  // Calculate percentile (this would ideally compare against all players)
  const percentile = 75; // Placeholder - you could calculate this from all players
  
  return {
    background: teamColor.gradient,
    html: `
      <h2>Your batting average</h2>
      <div class="big-number">${avgDisplay}</div>
      <p class="stat-label">${stats.hits} hits in ${stats.games} games</p>
      
      <div class="progress-container">
        <div class="progress-label">
          <span>League Average (.290)</span>
          <span>You</span>
        </div>
        <div class="progress-bar">
          <div class="progress-fill" style="width: ${percentile}%"></div>
        </div>
      </div>

      <h3 style="color: #fbbf24; margin-top: 2rem;">
        Top ${100 - percentile}% in the league
      </h3>
    `
  };
}

function generateStatsCard(stats, teamColor) {
  const obp = (stats.atBats + stats.walks) > 0 
    ? ((stats.hits + stats.walks) / (stats.atBats + stats.walks)).toFixed(3).replace(/^0/, '')
    : '.000';

  return {
    background: teamColor.gradient,
    html: `
      <h2>Your 2025 Numbers</h2>
      <div class="stats-grid">
        <div class="stat-item">
          <div class="stat-value">${stats.hits}</div>
          <div class="stat-name">Hits</div>
        </div>
        <div class="stat-item">
          <div class="stat-value">${stats.walks}</div>
          <div class="stat-name">Walks</div>
        </div>
        <div class="stat-item">
          <div class="stat-value">${obp}</div>
          <div class="stat-name">On-Base %</div>
        </div>
      </div>
    `
  };
}

function generateMilestoneCards(playerData, teamColor) {
  const milestones = findMilestones(playerData);
  
  if (milestones.length === 0) return [];

  return [{
    background: teamColor.gradient,
    html: `
      <h2>üèÜ Milestones Unlocked</h2>
      <div class="milestones-list">
        ${milestones.map(m => `
          <div class="milestone-item">
            <div class="milestone-icon">${m.icon}</div>
            <div class="milestone-text">${m.text}</div>
          </div>
        `).join('')}
      </div>
    `
  }];
}

function findMilestones(playerData) {
  const milestones = [];
  
  // Career stats
  const careerHits = playerData.career?.hits || 0;
  const careerRuns = playerData.career?.runs || 0;
  const careerWalks = playerData.career?.walks || 0;

  // Check hits milestones
  if (careerHits >= 300) milestones.push({ icon: 'üèÜ', text: 'Reached 300 career hits!' });
  else if (careerHits >= 200) milestones.push({ icon: 'üéØ', text: 'Reached 200 career hits!' });
  else if (careerHits >= 100) milestones.push({ icon: 'üíØ', text: 'Reached 100 career hits!' });

  // Check runs milestones
  if (careerRuns >= 200) milestones.push({ icon: 'üöÄ', text: 'Reached 200 career runs!' });
  else if (careerRuns >= 150) milestones.push({ icon: 'üî•', text: 'Reached 150 career runs!' });
  else if (careerRuns >= 100) milestones.push({ icon: 'üíØ', text: 'Reached 100 career runs!' });

  // Check walks milestones
  if (careerWalks >= 50) milestones.push({ icon: 'üö∂', text: 'Reached 50 career walks!' });
  else if (careerWalks >= 25) milestones.push({ icon: 'üëÅÔ∏è', text: 'Reached 25 career walks!' });

  return milestones;
}

function generateTeamCard(stats, playerData, teamColor) {
  const team = stats.team || playerData.currentTeam || 'Your Team';
  
  return {
    background: teamColor.gradient,
    html: `
      <h2>${team}</h2>
      <p class="stat-label" style="margin-bottom: 2rem;">had a season to remember</p>
      
      <div class="team-record">
        <div class="record-item">
          <div class="record-number wins">--</div>
          <div class="stat-name">Wins</div>
        </div>
        <div class="record-item">
          <div class="record-number losses">--</div>
          <div class="stat-name">Losses</div>
        </div>
      </div>

      <p style="margin-top: 2rem; font-size: 1.2rem; opacity: 0.9;">
        You were part of something special
      </p>
    `
  };
}

function generateSummaryCard(stats, playerData, teamColor) {
  const avg = stats.atBats > 0 ? (stats.hits / stats.atBats).toFixed(3).replace(/^0/, '') : '.000';
  
  return {
    background: teamColor.gradient,
    html: `
      <h2 style="font-size: clamp(2.5rem, 8vw, 5rem);">What a season!</h2>
      <p style="max-width: 700px; font-size: clamp(1.2rem, 3vw, 1.8rem); line-height: 1.6; margin: 2rem 0;">
        You played <strong style="color: #14b8a6;">${stats.games} games</strong>, 
        collected <strong style="color: #14b8a6;">${stats.hits} hits</strong>, 
        and batted <strong style="color: #14b8a6;">${avg}</strong>.
      </p>

      <div style="background: rgba(255,255,255,0.15); backdrop-filter: blur(10px); padding: 2rem; border-radius: 20px; margin: 2rem 0; border: 2px solid rgba(255,255,255,0.2);">
        <h3 style="font-size: clamp(1.5rem, 4vw, 2.5rem); margin-bottom: 1rem;">
          See you in 2026! üèÜ
        </h3>
      </div>

      <button class="replay-button" onclick="window.location.reload()">
        ‚Üª Replay Your Season
      </button>
    `
  };
}

function showCard(index) {
  if (isAnimating || index < 0 || index >= cards.length) return;
  
  isAnimating = true;
  
  // Hide current card
  const currentCard = document.getElementById(`card-${currentCardIndex}`);
  if (currentCard) {
    currentCard.classList.add('hidden');
  }

  // Update index
  currentCardIndex = index;

  // Show new card
  setTimeout(() => {
    const newCard = document.getElementById(`card-${currentCardIndex}`);
    if (newCard) {
      newCard.classList.remove('hidden');
    }

    // Update dots
    document.querySelectorAll('.nav-dot').forEach((dot, i) => {
      dot.classList.toggle('active', i === currentCardIndex);
    });

    // Update button visibility
    document.getElementById('prevButton').style.display = currentCardIndex > 0 ? 'flex' : 'none';
    document.getElementById('nextButton').style.display = currentCardIndex < cards.length - 1 ? 'flex' : 'none';

    isAnimating = false;
  }, 300);
}

function nextCard() {
  if (currentCardIndex < cards.length - 1) {
    showCard(currentCardIndex + 1);
  }
}

function prevCard() {
  if (currentCardIndex > 0) {
    showCard(currentCardIndex - 1);
  }
}

// Event listeners
document.getElementById('prevButton').onclick = prevCard;
document.getElementById('nextButton').onclick = nextCard;

document.addEventListener('keydown', (e) => {
  if (e.key === 'ArrowRight' || e.key === ' ') {
    e.preventDefault();
    nextCard();
  } else if (e.key === 'ArrowLeft') {
    e.preventDefault();
    prevCard();
  }
});

// Swipe support for mobile
let touchStartX = 0;
let touchEndX = 0;

document.getElementById('wrappedContainer').addEventListener('touchstart', (e) => {
  touchStartX = e.changedTouches[0].screenX;
});

document.getElementById('wrappedContainer').addEventListener('touchend', (e) => {
  touchEndX = e.changedTouches[0].screenX;
  handleSwipe();
});

function handleSwipe() {
  if (touchEndX < touchStartX - 50) nextCard();
  if (touchEndX > touchStartX + 50) prevCard();
}

// Sharing functions
function setupSharing(playerData) {
  const playerName = playerData.name || playerData.displayName || 'Player';
  const playerId = playerData.id;
  
  // Generate shareable URL
  const shareUrl = `${window.location.origin}/aces-wrapped.html?id=${encodeURIComponent(playerId)}`;
  const shareText = `Check out ${playerName}'s Mountainside Aces Wrapped 2025! üèÜ‚öæ`;
  
  // Set share link
  document.getElementById('shareLink').value = shareUrl;
  
  // Setup WhatsApp sharing
  document.getElementById('shareWhatsApp').href = 
    `https://wa.me/?text=${encodeURIComponent(shareText + '\n' + shareUrl)}`;
  
  // Setup Text Message sharing (SMS)
  document.getElementById('shareText').href = 
    `sms:?&body=${encodeURIComponent(shareText + '\n' + shareUrl)}`;
  
  // Setup Twitter sharing
  document.getElementById('shareTwitter').href = 
    `https://twitter.com/intent/tweet?text=${encodeURIComponent(shareText)}&url=${encodeURIComponent(shareUrl)}`;
  
  // Setup Facebook sharing
  document.getElementById('shareFacebook').href = 
    `https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(shareUrl)}`;
}

window.openShareModal = function() {
  document.getElementById('shareModal').classList.add('active');
};

window.closeShareModal = function() {
  document.getElementById('shareModal').classList.remove('active');
};

window.copyShareLink = async function() {
  const shareLink = document.getElementById('shareLink');
  const copyBtn = document.getElementById('copyLinkBtn');
  
  try {
    await navigator.clipboard.writeText(shareLink.value);
    copyBtn.textContent = '‚úì Copied!';
    copyBtn.classList.add('copied');
    
    setTimeout(() => {
      copyBtn.textContent = 'Copy Link';
      copyBtn.classList.remove('copied');
    }, 2000);
  } catch (err) {
    // Fallback for older browsers
    shareLink.select();
    document.execCommand('copy');
    copyBtn.textContent = '‚úì Copied!';
    
    setTimeout(() => {
      copyBtn.textContent = 'Copy Link';
    }, 2000);
  }
};

// Share button click handler
document.getElementById('shareButton').onclick = openShareModal;

// Close modal when clicking outside
document.getElementById('shareModal').onclick = function(e) {
  if (e.target === this) {
    closeShareModal();
  }
};

// Initialize
loadPlayerData();
</script>

<script src="nav-component.js" type="module"></script>
<script src="team-colors.js"></script>

</body>
</html>
